<!DOCTYPE plugin [
  <!ENTITY process-metrics SYSTEM "/pdk/plugins/process-metrics.xml">
]>

<plugin>
	<property name="PLUGIN_VERSION" value="5.8.5-000001"/>

	<server name="vSphere Web Client Server">
		<property name="PROC_QUERY"
			value="State.Name.re=(java|vsphere-client),Args.*.re=(vmware-vsphere-client|vSphere.*Web.*Client|vsphere-client-gc)"/>

		<config>
			<option name="process.query"
				default="${PROC_QUERY}"
				description="PTQL for vSphere Web Client Server"/>
		</config>

		<plugin type="autoinventory"
			class="org.hyperic.hq.product.DaemonDetector"/>

		<plugin type="measurement"
			class="org.hyperic.hq.product.MeasurementPlugin"/>

		<property name="AUTOINVENTORY_NAME"
			value="%platform.name% vSphere Web Client Server"/>

		<property name="INVENTORY_ID"
			value="%installpath%-WebClient"/>

		<metric name="Availability"
			template="HTTP:hostname=localhost,port=9443,ssl=true,path=/vsphere-client,method=GET,follow=true:Availability"
			category="AVAILABILITY"
			units="percentage"
			indicator="true"
			collectionType="dynamic"
			defaultOn="true"
			interval="300000"/>

		<metric name="Response Time"
			template="HTTP:hostname=localhost,port=9443,ssl=true,path=/vsphere-client,method=GET,follow=true:ResponseTime"
			category="PERFORMANCE"
			units="ms"
			indicator="true"
			collectionType="dynamic"
			defaultOn="true"
			interval="300000"/>

		<metric name="Response Code"
			template="HTTP:hostname=localhost,port=9443,ssl=true,path=/vsphere-client,method=GET,follow=true:ResponseCode"
			category="PERFORMANCE"
			units="none"
			indicator="true"
			collectionType="dynamic"
			defaultOn="true"
			interval="300000"/>

		<metric name="Process Availability"
			template="sigar:Type=ProcState,Arg=%process.query%:State"
			category="UTILIZATION"
			units="percentage"
			indicator="true"
			collectionType="dynamic"
			defaultOn="true"
			interval="300000"/>

		&process-metrics;
	</server>

	<!-- For vCenter Server 5.5 only -->
	<server name="vSphere Web Client Server WebSocket">
		<property name="PROC_QUERY"
			value="State.Name.eq=java,Args.*.ct=jetty.port=7331,Args.*.ct=websocket"/>

		<config>
			<option name="process.query"
				default="${PROC_QUERY}"
				description="PTQL for vSphere Web Client Server WebSocket"/>
		</config>

		<plugin type="autoinventory"
			class="org.hyperic.hq.product.DaemonDetector"/>

		<plugin type="measurement"
			class="org.hyperic.hq.product.MeasurementPlugin"/>

		<property name="AUTOINVENTORY_NAME"
			value="%platform.name% vSphere Web Client Server WebSocket"/>

		<property name="INVENTORY_ID"
			value="%installpath%-websocket"/>
			
		<metric name="Availability"
			template="sigar:Type=ProcState,Arg=%process.query%:State"
			category="AVAILABILITY"
			units="percentage"
			indicator="true"
			collectionType="dynamic"
			defaultOn="true"
			interval="300000"/>

		&process-metrics;
	</server>
	
	<!-- For vCenter Server 5.x only -->
	<server name="vSphere LogBrowser">
		<property name="PROC_QUERY"
			value="State.Name.eq=java,Args.*.re=vmware.*logbrowser"/>

		<config>
			<option name="process.query"
				default="${PROC_QUERY}"
				description="PTQL for vSphere Log Browser"/>
		</config>

		<plugin type="autoinventory"
			class="org.hyperic.hq.product.DaemonDetector"/>

		<plugin type="measurement"
			class="org.hyperic.hq.product.MeasurementPlugin"/>

		<property name="AUTOINVENTORY_NAME"
			value="%platform.name% vSphere LogBrowser"/>

		<property name="INVENTORY_ID"
			value="%installpath%-Log"/>

		<metric name="Availability"
			template="sigar:Type=ProcState,Arg=%process.query%:State"
			category="AVAILABILITY"
			units="percentage"
			indicator="true"
			collectionType="dynamic"
			defaultOn="true"
			interval="300000"/>

		&process-metrics;
	</server>
</plugin>
