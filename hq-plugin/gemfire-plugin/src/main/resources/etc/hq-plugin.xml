<?xml version="1.0"?>
<!-- standard include for process metrics -->
<!DOCTYPE plugin [
  <!ENTITY process-metrics SYSTEM "/pdk/plugins/process-metrics.xml">
]>
<plugin package="com.vmware.springsource.hyperic.plugin.gemfire">
    <!-- add the jmx libraries to the classpath -->
	<classpath>
		<include name="pdk/lib/mx4j" />
	</classpath>

	<!-- Template for jmx metrics -->
	<filter name="template" value="${OBJECT_NAME}:${alias}" />

	<!-- Custom metrics that we will get from our MBean -->
	<!-- use name="xyz" to get metric xyz from cachePerfStats
	     else use name="category,attribute"  eg: name="distributionStats,processedMessages"
	     collectiontype=TrendsUp -->
	<metrics name="GemFireMetrics">
		<metric name="cacheListenerCallsCompleted" category="UTILIZATION" collectionType="trendsup" indicator="true" interval="60000" />
		<metric name="creates" category="UTILIZATION" collectionType="trendsup" indicator="true" interval="60000" />
		<metric name="puts" category="UTILIZATION" collectionType="trendsup" indicator="true" interval="60000" />
		<metric name="misses" category="UTILIZATION" collectionType="trendsup" indicator="true" interval="60000" />
		<metric name="loadsCompleted" category="UTILIZATION" collectionType="trendsup" indicator="true" interval="60000" />
		<metric name="gets" category="UTILIZATION" collectionType="trendsup" indicator="true" interval="60000" />
		<metric name="entries" category="UTILIZATION" collectionType="trendsup" indicator="true" interval="60000" />
		<metric name="destroys" category="UTILIZATION" collectionType="trendsup" indicator="true" interval="60000" />
		<metric name="distributionStats,deserializations" collectionType="trendsup" category="UTILIZATION" indicator="true" interval="60000" />
	</metrics>

	<!-- Define a server with JMX settings and monitor services -->
	<server name="GemFire" version="6.5">
	
		<!-- Tell HQ where the home directory for this process is -->
	    <property name="PROC_HOME_PROPERTY" value="State.Name.sw=java,Args.*.re=AgentLauncher" />

		<!--
			Tell HQ to look for a file relative to the "PROC_HOME_PROPERTY". If
			the file exists, server will be discovered.  In this case it's JAVA_HOME, 
			so choose a convienent file such as README.html.  Maybe this can be deleted?
		-->
		<property name="VERSION_FILE" value="README.html" />

		<!--
		    Setup JMX server properties and PTQL query for the server
		    The JMX port and tcServer's name should be set to your configuration.
		-->
		<config>
			<option name="jmx.url"
			        description="JMX URL to GemFire Agent"
				    default="service:jmx:rmi://localhost/jndi/rmi://:1099/jmxconnector" />
				    
			<option name="jmx.username"
			        description="JMX username"
				    optional="true" default="" />
				    
			<option name="jmx.password"
			        description="JMX password"
				    optional="true" default="" />
				    
			<option name="process.query"
			        description="PTQL for Java Process"
				    default="State.Name.sw=java,Args.*.re=AgentLauncher" />
		</config>

		<!-- Check to see if server is up -->
		<metric name="Availability" template="sigar:Type=ProcState,Arg=%process.query%:State" indicator="true" />

		<!-- Report on system process metrics (OPTIONAL) -->
		&process-metrics;

		<!-- Required to auto-inventory JMX Beans -->
		<plugin type="autoinventory" class="com.vmware.springsource.hyperic.plugin.gemfire.MxServerDetector" />
		<plugin type="measurement" class="MxMeasurementPlugin" />
		<plugin type="control" class="MxControlPlugin"/>
	
		<!--  Include our Custom Metrics in the Monitoring GUI -->
		<property name="OBJECT_NAME" value="GemFire:type=Agent" />
		<metrics include="GemFireMetrics" />
		
        <property name="PROC_HOME_ENV" value="JAVA_HOME"/>
	</server>
</plugin>

