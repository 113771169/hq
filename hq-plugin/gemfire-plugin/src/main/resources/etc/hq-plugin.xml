<?xml version="1.0"?>
<!-- standard include for process metrics -->
<!DOCTYPE plugin [
  <!ENTITY process-metrics SYSTEM "/pdk/plugins/process-metrics.xml">
]>
<plugin package="com.vmware.springsource.hyperic.plugin.gemfire">
    <classpath>
        <include name="pdk/lib/mx4j" />
    </classpath>

    <!--metrics name="GemFireMetrics">
        <metric name="cacheListenerCallsCompleted" category="UTILIZATION" collectionType="trendsup" indicator="true" interval="60000" />
        <metric name="creates" category="UTILIZATION" collectionType="trendsup" indicator="true" interval="60000" />
        <metric name="puts" category="UTILIZATION" collectionType="trendsup" indicator="true" interval="60000" />
        <metric name="misses" category="UTILIZATION" collectionType="trendsup" indicator="true" interval="60000" />
        <metric name="loadsCompleted" category="UTILIZATION" collectionType="trendsup" indicator="true" interval="60000" />
        <metric name="gets" category="UTILIZATION" collectionType="trendsup" indicator="true" interval="60000" />
        <metric name="entries" category="UTILIZATION" collectionType="trendsup" indicator="true" interval="60000" />
        <metric name="destroys" category="UTILIZATION" collectionType="trendsup" indicator="true" interval="60000" />
        <metric name="distributionStats,deserializations" collectionType="trendsup" category="UTILIZATION" indicator="true" interval="60000" />
    </metrics-->

    <config name="jmx">
        <option name="jmx.url" description="JMX URL to GemFire Agent" default="service:jmx:rmi://localhost/jndi/rmi://:1099/jmxconnector" />
        <option name="jmx.username" description="JMX username" optional="true" default="" />
        <option name="jmx.password" description="JMX password" optional="true" default="" />
    </config>
    <property name="JXMCFG" value="jmx.url=%jmx.url%,jmx.username=%jmx.username%,jmx.password=%jmx.password%"/>


    <platform name="GemFire Distributed System">
        <plugin type="autoinventory" class="GemfirePlatformDetector"/>
        <plugin type="measurement" class="org.hyperic.hq.product.MeasurementPlugin" />
        <plugin type="collector" class="GemfireCollector" />
        <plugin type="livedata" class="GemFireLiveData" />
        <plugin type="log_track" class="AlertsPlugin" />

        <config include="jmx"/>
        <filter name="template" value="GemFire:jmx.url=%jmx.url%:${alias}"/>
        <metrics>
            <metric name="Availability" indicator="true" />
            <metric name="Cache Servers"     alias="n_caches"   indicator="true" />
            <metric name="Applications Peer" alias="n_apps"     indicator="true" />
            <metric name="Gateway Hubs"      alias="n_gateways" indicator="true" />
        </metrics>
        <server name="JMX Agent" version="6.5">
            <plugin type="autoinventory" class="JMXAgentDetector" />
            <plugin type="measurement" class="org.hyperic.hq.product.MeasurementPlugin" />
            <plugin type="collector" class="JMXAgentCollector" />
            <config type="measurement" include="jmx"/>
            <filter name="template" value="collector:${JXMCFG}:${alias}"/>
            <metrics>
                <metric name="Availability"  indicator="true" />
            </metrics>
        </server>
        <server name="Cache Server" version="6.5">
            <plugin type="autoinventory" class="CacheServerDetector" />
            <plugin type="measurement" class="MemberMeasurement" />
            <plugin type="collector" class="MemberCollector" />
            <plugin type="livedata" class="GemFireLiveData" />
            <config type="measurement" include="jmx">
                <option name="memberID" description="Cache Server Id"/>
            </config>
            <properties>
                <property name="id" description="ID"/>
                <property name="type" description="Type"/>
                <property name="host" description="Peer Host"/>
                <property name="port" description="Peer Port"/>
            </properties>
            <filter name="template" value="collector:${JXMCFG},memberID=%memberID%:${alias}"/>
            <property name="OBJECT_NAME" value="GemFire.Statistic:source=%memberID%,uid=3,name=vmStats"/>
            <metrics>
                <metric name="Availability"  indicator="true" />
                <metric name="Used Heap" alias="memory" indicator="true" />
                <metric name="Used CPU" alias="cpu" indicator="true" />
                <metric name="Uptime" alias="uptime" indicator="true" collectionType="static" units="sec"/>
                <metric name="Number of Clients" alias="clients" indicator="true" />
                <!--metric name="Gets" template="${OBJECT_NAME}:threads" ndicator="true"/>
                <metric name="Puts" template="${OBJECT_NAME}:threads" ndicator="true"/>
                <metric name="Cache Misses" template="${OBJECT_NAME}:threads" ndicator="true"/>
                <metric name="Threads" template="${OBJECT_NAME}:threads" ndicator="true"/>
                <metric name="Queue Size" template="${OBJECT_NAME}:threads" ndicator="true"/-->
            </metrics>
            <service name="Region">
                <plugin type="measurement" class="org.hyperic.hq.product.MeasurementPlugin" />
                <plugin type="collector" class="RegionCollector" />
                <config type="measurement">
                    <option name="memberID" description="Cache Server Id"/>
                    <option name="regionID" description="Region Name"/>
                </config>
                <properties>
                    <property description="gemfire.member.id" name="ID"/>
                    <property description="Name" name="name"/>
                    <property description="Path" name="path"/>
                    <property description="Scope" name="scope"/>
                    <property description="Data Policy" name="datapolicy"/>
                    <property description="Inerrest Policy" name="interestpolicy"/>
                    <property description="dik Attributes" name="diskattrs"/>
                </properties>
                <filter name="template" value="GemFire:${JXMCFG},memberID=%memberID%:%regionID%.${alias}"/>
                <metrics>
                    <metric name="Availability"  indicator="true" />
                    <metric name="Entry Count" alias="entry_count" indicator="true" />
                </metrics>
            </service>
        </server>
        <server name="Application Peer" version="6.5" include="Cache Server 6.5">
            <plugin type="autoinventory" class="ApplicationServerDetector" />
        </server>
        <server name="Gateway Hub" version="6.5" include="Cache Server 6.5">
            <plugin type="autoinventory" class="GatewayServerDetector" />
            <service name="Gateway">
                <plugin type="measurement" class="org.hyperic.hq.product.MeasurementPlugin" />
                <plugin type="collector" class="GatewayCollector" />
                <config type="measurement">
                    <option name="memberID" description="Cache Server Id"/>
                    <option name="gatewayID" description="Gateway Id"/>
                </config>
                <filter name="template" value="GemFire:${JXMCFG},memberID=%memberID%,gatewayID=%gatewayID%:${alias}"/>
                <metrics>
                    <metric name="Availability"  indicator="true" />
                    <metric name="Queue size" alias="queuesize" indicator="true" />
                </metrics>
            </service>
        </server>
    </platform>
</plugin>

