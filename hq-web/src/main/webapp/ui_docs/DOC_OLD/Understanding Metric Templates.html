<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
    <head>
        <title>vFabric Hyperic 5.7 : Understanding Metric Templates</title>
	    <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">	    
    </head>

    <body>
<b><a href="vFabric Hyperic 5.7.html" title="vFabric Hyperic 5.7 Documentation Home">vFabric Hyperic 5.7 Documentation Home (Internal)</a>
 - <a href="https://www.vmware.com/support/pubs/vfabric-hyperic.html">vFabric Hyperic 5.7 Documentation Home (Online)</a>
 -  <a href="https://www.vmware.com/support/vfabric-hyperic/doc/vfabric-hyperic-rn-5.0.html">Hyperic 5.7 Release Notes</a> </b>
 <p>
 <p>
	    <table class="pagecontent" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#ffffff">
		    <tr>
			    <td valign="top" class="pagebody">
				    <div class="pageheader">
					    <span class="pagetitle">
                            vFabric Hyperic 5.7 : Understanding Metric Templates
                                                    </span>
				    </div>
				    <div class="pagesubheading">
					    This page last changed on Jan 04, 2012 by <font color="#0050B2">mmcgarry</font>.
				    </div>

				    <p><font color="gray"><em>Topics marked with</em></font> <font color="red">*</font> <font color="gray"><em>relate to features available only in vFabric Hyperic.</em></font></p>


<style type='text/css'>/*<![CDATA[*/
div.rbtoc1325699829442 {margin-left: 1.5em;padding: 0px;}
div.rbtoc1325699829442 ul {list-style: disc;margin-left: 0px;padding-left: 20px;}
div.rbtoc1325699829442 li {margin-left: 0px;padding-left: 0px;}

/*]] >*/</style><div class='rbtoc1325699829442'>
<ul>
    <li><a href='#UnderstandingMetricTemplates-IntroductiontoMetricTemplates'>Introduction to Metric Templates</a></li>
    <li><a href='#UnderstandingMetricTemplates-AnatomyofaMetricTemplate'>Anatomy of a Metric Template</a></li>
    <li><a href='#UnderstandingMetricTemplates-WhataMetricTemplateLooksLike'>What a Metric Template Looks Like</a></li>
    <li><a href='#UnderstandingMetricTemplates-WheretheDataforaMetricTemplateComesFrom'>Where the Data for a Metric Template Comes From</a></li>
    <li><a href='#UnderstandingMetricTemplates-HowaMetric%27s%7B%7Btemplate%7D%7DAttributeisSpecified'>How a Metric's <tt>template</tt> Attribute is Specified</a></li>
    <li><a href='#UnderstandingMetricTemplates-LearnMoreAboutVariablesinPluginDescriptors'>Learn More About Variables in Plugin Descriptors</a></li>
    <li><a href='#UnderstandingMetricTemplates-MetricTemplateRulesforEachCollectionMethod'>Metric Template Rules for Each Collection Method</a></li>
</ul></div>


<h1><a name="UnderstandingMetricTemplates-IntroductiontoMetricTemplates"></a>Introduction to Metric Templates</h1>

<p>This page is a high level introduction to metric templates, their purpose, and how they are defined. Because the content of a metric template varies considerably depending on how a metric is collected, this introduction is general. For information about metric templates for each collection method, see <a href="#UnderstandingMetricTemplates-MetricTemplateRulesforEachCollectionMethod">Metric Template Rules for Each Collection Method</a>.</p>

<h1><a name="UnderstandingMetricTemplates-AnatomyofaMetricTemplate"></a>Anatomy of a Metric Template</h1>

<p>A <em>metric template</em> expresses a request for a specific metric, for a specific resource, in a format that the HQ Agent understands. It identifies the resource instance, a particular metric, and where to get the metric value. A metric template takes this form:</p>

<p><tt>Domain:Properties:Metric:Connection</tt></p>

<p>The content of each segment of the metric template depends on how the metric is obtained - from an MBean server, SIGAR, an HQ measurement class, via SNMP, and so on.&nbsp;</p>
<ul>
	<li><tt>Domain</tt> &#8212; Specifies the management facility that collects the metric. For a JMX metric, <tt>Domain</tt> is a JMX domain. <tt>Domain</tt> may also take values that specify that the metric is collected via SIGAR, SNMP, or the script processing service. For metrics collected by a Java measurement class using a vendor-specific API, <tt>Domain</tt> is not a meaningful segment of a metric template - it has an arbitrary value.</li>
</ul>


<ul>
	<li><tt>Properties</tt> &#8212; Specifies properties that identify the resource for which to collect the metric. For a JMX metric, <tt>Properties</tt> contains one or more key=value pairs that identify an Mbean instance of the type specified by the <tt>Domain</tt>. For other collection methods, <tt>Properties</tt> might identify a specific resource by its type and name, or a SIGAR query to run.</li>
</ul>


<ul>
	<li><tt>Metric</tt> &#8212; Specifies the metric to collect. For a JMX metric, <tt>Metric</tt> is an attribute of the Mbean specified by the <tt>Properties</tt> and <em>Properties</em> segments of the metric template. For other collection methods, <tt>Metric</tt> is the name by which the measurement class or script makes the metric available.</li>
</ul>


<ul>
	<li><tt>Connection</tt> &#8212; Specifies connection properties for the managed resource, for example, JNDI naming properties or JDBC connection properties.</li>
</ul>


<h1><a name="UnderstandingMetricTemplates-WhataMetricTemplateLooksLike"></a>What a Metric Template Looks Like</h1>

<p>Here is an actual metric template, for the "Sequential Scans" metric for a PostgreSQL database table:</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">postgresql:Type=Table,table=eam_action:seq_scan:jdbcUrl=jdbc:postgresql://localhost:9432/hqdb,jdbcUser=hqadmin,jdbcPassword=******</pre>
		</div>
</div></div>

<p>The table below breaks down the metric template and describes each segment.</p>

<div class='table-wrap'>
<table class='confluenceTable'><tbody>
<tr>
<th class='confluenceTh'> Segment </th>
<th class='confluenceTh'> Value </th>
<th class='confluenceTh'> What it Does <br class="atl-forced-newline" /> </th>
</tr>
<tr>
<td class='confluenceTd'> <tt>Domain</tt> </td>
<td class='confluenceTd'> postgresql </td>
<td class='confluenceTd'> Nothing &#8212; in Hyperic database plugins the Domain segment is a dummy string. </td>
</tr>
<tr>
<td class='confluenceTd'> <tt>Properties</tt> </td>
<td class='confluenceTd'> Type=Table,table=eam_action </td>
<td class='confluenceTd'> The resource for which to obtain the metric - the "eam_action" database table. </td>
</tr>
<tr>
<td class='confluenceTd'> <tt>Metric</tt> </td>
<td class='confluenceTd'> seq_scan <br class="atl-forced-newline" /> </td>
<td class='confluenceTd'>Name of the metric, as the measurement class makes it available - "seq_scan". </td>
</tr>
<tr>
<td class='confluenceTd'> <tt>Connection</tt> </td>
<td class='confluenceTd'> jdbcUrl=jdbc:postgresql://localhost:9432/hqdb,jdbcUser=hqadmin,jdbcPassword=***** </td>
<td class='confluenceTd'> The database URL and database user credentials the Hyperic Agent uses to connect to PostgreSQL.</td>
</tr>
</tbody></table>
</div>



<h1><a name="UnderstandingMetricTemplates-WheretheDataforaMetricTemplateComesFrom"></a>Where the Data for a Metric Template Comes From</h1>

<p>When you design a plugin, you determine the appropriate collection method for the resource types it manages, the requirements for accessing or connecting to each type, and the measurements you want to collect. In the plugin descriptor you define these resource and measurement attributes using &lt;option&gt;, &lt;property&gt; and &lt;metric&gt; elements. These data items map to fields that a plugin class either needs (the value is set in descriptor or supplied by user) or discovers.</p>

<p>A metric template codifies connection data, resource properties, and metric attributes as a "metric request" that the Hyperic Agent can fulfill.</p>

<h1><a name="UnderstandingMetricTemplates-HowaMetric%27s%7B%7Btemplate%7D%7DAttributeisSpecified"></a>How a Metric's <tt>template</tt> Attribute is Specified</h1>

<p>A &lt;metric&gt; element's <tt>template</tt> attribute specifies the first three segments of a metric template ---<tt>Domain:Properties:Metric</tt>. (The properties for the <tt>Connection</tt> segment are defined in the plugin descriptor, but do not form a portion of the <tt>template</tt> attribute; the <tt>Connection</tt> segment is appended to the <tt>template</tt> attribute when a metric value is requested.)</p>

<p>Hyperic plugin descriptors typically use variables for resource properties and options in the <tt>template</tt> attribute to make the descriptor easier to write, maintain, and read. Strictly speaking, the <tt>template</tt> attribute, or certainly parts of it, can be defined explicitly, as in this &lt;metric&gt; element for the "Sequential Scans" metric:</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">&lt;metric name="Sequential Scans"
alias="seq_scan"
template="postgresql:Type=Table,table=eam_action:seq_scan"
category="UTILIZATION"
indicator="true"
units="none"
collectionType="trendsup"/&gt;</pre>
		</div>
</div></div>

<p>More typically, <tt>template</tt> is defined as a variable expression - this is easy to do, as the value of each &lt;option&gt; and &lt;property&gt; is available from a variable of the same name. As useful, a plugin developer can also use &lt;filter&gt; elements to define local variables that are meaningful only within the descriptor. </p>

<p>Below, the <tt>template</tt> attribute is simplified by expressing <tt>Domain</tt> by reference to an local variable, and the <tt>table</tt> property by reference to the <tt>%table%</tt> variable that returns the name attribute for the &lt;option&gt; element that defines it, "table".</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">template="${domain}:Type=Table,table=%table%:seq_scan</pre>
		</div>
</div></div>

<p>The use of variables in Hyperic plugin descriptors is widespread, and the way they are used tends to vary from plugin to plugin. Peruse a few Hyperic plugin descriptors, and you will note <tt>&lt;metric&gt;</tt> elements that contain <em>no</em> <tt>template</tt> attribute; instead, a local variable named <tt>template</tt> defines the whole <tt>template</tt> attribute in terms of variables that return attributes from resource-specific elements. Instead of defining <tt>template</tt> explicitly in each &lt;metric&gt; element, a variable is defined once, outside and before the &lt;metric&gt; elements for the resource type.</p>

<p>For example, the <tt>template</tt> variable below defines the <tt>template</tt> attribute for all metrics for all tables. This is similar to the previous definition, but in this case, the <tt>Metric</tt> segment of the <tt>template</tt> attribute for a metric is supplied by the &lt;metric&gt; element's <tt>alias</tt> attribute.</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">&lt;filter name="template"
     value="template="${domain}:Type=Table,table=%table%:${alias}"/&gt;</pre>
		</div>
</div></div>

<p>which expands to:</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">template=postgresql:Type=Table,table=eam_action:seq_scan</pre>
		</div>
</div></div>

<p>When the <tt>Connection</tt> segment is appended to the <tt>template</tt> attribute value, the metric template is complete:</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">template=postgresql:Type=Table,table=eam_action:seq_scan:jdbcUrl=
jdbc:postgresql://localhost:9432/hqdb,jdbcUser=hqadmin,jdbcPassword=******</pre>
		</div>
</div></div>

<p>Along with other &lt;metric&gt; attributes (<tt>category</tt> and <tt>indicator</tt>, for instance), the metric template supplies the values of fields in the <tt>Metric</tt> object that is passed to the measurement class when the metric value is requested. </p>

<h1><a name="UnderstandingMetricTemplates-LearnMoreAboutVariablesinPluginDescriptors"></a>Learn More About Variables in Plugin Descriptors</h1>

<p>This page briefly introduced the use of variables to define metric templates. Using variables is not required, but it simplifies the process of writing a plugin descriptor. For more information, see <a href="Variables in Plugin Descriptors.html" title="Variables in Plugin Descriptors">Variables in Plugin Descriptors</a>.</p>

<h1><a name="UnderstandingMetricTemplates-MetricTemplateRulesforEachCollectionMethod"></a>Metric Template Rules for Each Collection Method</h1>

<p>Because the the rules for for constructing a metric's <tt>template</tt> attribute vary by collection method, see the instructions and examples for the metric collection method you are using.</p>
<ul>
	<li>JMX &#8212; <a href="JMX Metric Templates.html" title="JMX Metric Templates">JMX Metric Templates</a></li>
	<li>script &#8212; <a href="Facts About Script Plugins.html" title="Facts About Script Plugins">Facts About Script Plugins</a></li>
	<li>SQL Query &#8212; <a href="SQL Query Plugin.html#SQLQueryPlugin-SqlQueryMetricTemplate">Metric Template Format for SQL Query Plugins</a></li>
	<li>SNMP &#8212; <a href="Write an SNMP Plugin.html" title="Write an SNMP Plugin">Write an SNMP Plugin</a></li>
</ul>




				    
                    			    </td>
		    </tr>
	    </table>
	    <table border="0" cellpadding="0" cellspacing="0" width="100%">
			<tr>
				<td height="12" background="http://support.hyperic.com/images/border/border_bottom.gif"><img src="images/border/spacer.gif" width="1" height="1" border="0"/></td>
			</tr>
		    <tr>
			    <td align="center"><font color="grey">Document generated by Confluence on Oct 01, 2012 10:08</font></td>
		    </tr>
	    </table>
    </body>
</html>
