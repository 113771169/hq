<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
    <head>
        <title>vFabric Hyperic 5.7 : HQ Groovy APIs</title>
	    <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">	    
    </head>

    <body>
<b><a href="vFabric Hyperic 5.7.html" title="vFabric Hyperic 5.7 Documentation Home">vFabric Hyperic 5.7 Documentation Home (Internal)</a>
 - <a href="https://www.vmware.com/support/pubs/vfabric-hyperic.html">vFabric Hyperic 5.7 Documentation Home (Online)</a>
 -  <a href="https://www.vmware.com/support/vfabric-hyperic/doc/vfabric-hyperic-rn-5.0.html">Hyperic 5.7 Release Notes</a> </b>
 <p>
 <p>
	    <table class="pagecontent" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#ffffff">
		    <tr>
			    <td valign="top" class="pagebody">
				    <div class="pageheader">
					    <span class="pagetitle">
                            vFabric Hyperic 5.7 : HQ Groovy APIs
                                                    </span>
				    </div>
				    <div class="pagesubheading">
					    This page last changed on Jan 04, 2012 by <font color="#0050B2">mmcgarry</font>.
				    </div>

				    <p>These topics provide information about the HQ's Groovy APIs and how to use them.<br/>
<b>WIP Note</b>:  This section is a work in progress.  In the next version of this guide, topics will be added to provide this information:</p>
<ul>
	<li>What the Groovy APIs can and cannot do.  In a future release, the Groovy APIs will provide access to all backend HQ data and functionality. Currently, not all backend data and functionality can be access by the Groovy APIs.</li>
	<li>More complete API documentation.  Some API documentation is missing or incomplete.</li>
</ul>


<h1><a name="HQGroovyAPIs-CodingConventions"></a><b>Coding Conventions</b></h1>
<p>Many times, methods take only a single argument; a Map of parameters. For example: </p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">def findSomething(p) {  
   def name = p['name']  
   def auto = p.get('auto', true)
}</pre>
		</div>
</div></div>
<p>In this example, the  method takes two arguments, the second of which, "auto" defaults to true. </p>

<h1><a name="HQGroovyAPIs-ObtainingaHelperInstance"></a><b>Obtaining a Helper Instance</b></h1>
<p>To get an instance to a helper in your method, use its getter, available from BaseController.groovy:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">import org.hyperic.hq.hqu.rendit.BaseController
class _ControllerName_Controller extends BaseController {    
    def _ControllerName_Controller() {    }
    def index(params) {        
       def myPlatform = getResourceHelper().find(platform:'My Platform') // or more succinctly        
       def yourPlat = resourceHelper.find(platform:10001)
    }
}</pre>
		</div>
</div></div>

<h1><a name="HQGroovyAPIs-BaseControllerUtilityMethods"></a><b>BaseController Utility Methods</b></h1>
<p>All controllers extend BaseController and therefore have access to all of its utility methods.</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">def MyController extends BaseController {
   MyController() {
       // Have a closure execute before every action is invoked.       
       // Also provides getUser() to fetch the current AuthzSubject       
       // making the request
       addBeforeFilter({ log.info "Current request from ${user}"})
   }
   def index(params) {        
       log.info 'Hello world!'  // built in logging via log4j.         
       // InvokeArgs provides both HttpServletRequest / Response       
       log.info "Request from: ${invokeArgs.request.serverName()}"   
   }</pre>
		</div>
</div></div>
<ul>
	<li>urlFor(): Uses HtmlUtil.urlFor to generate URLs</li>
	<li>linkTo(): Generates a link to another action or resource</li>
	<li>now(): System.currentTimeMillis()</li>
	<li>escapeHtml(): Escapes a string of HTML</li>
</ul>


<p>BaseController provides wrappers around a few methods from the Util classes found here:<br/>
hq-rendit/src/main/groovy/org/hyperic/hq/hqu/rendit/util<br/>
hq-rendit/src/main/groovy/org/hyperic/hq/hqu/rendit/render<br/>
hq-rendit/src/main/groovy/org/hyperic/hq/hqu/rendit/html</p>

<h1><a name="HQGroovyAPIs-MetaClassesandCategories"></a><b>MetaClasses and Categories</b></h1>
<p>Groovy allows dynamic insertion of methods into objects dynamically at runtime. HQU takes advantage of this to make methods on objects seem more meaningful.</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">private getPlatformToDelete(id) {
        AuthzSubject curUser = getUser()
        log.info "${curUser.isSuperUser()}"
    }</pre>
		</div>
</div></div>

<p>The class AuthzSubject exists in HQ, however, it does not contain the method 'isSuperUser()'. AuthzSubjectCategory.groovy adds it at runtime.  See this excerpt from AuthzSubjectCategory.groovy:</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">class AuthzSubjectCategory {
    static boolean isSuperUser(AuthzSubject subject) {
        PermissionManagerFactory
     .getInstance()
            .hasAdminPermission(subject.id)
    }
}</pre>
		</div>
</div></div>

<p>Static methods in the category class tell Groovy to insert those methods for their associated object class. The first parameter is the recipient of the invocation, and all subsequent parameters are passed normally.</p>

<h1><a name="HQGroovyAPIs-ResourceHelper.groovy"></a><b>ResourceHelper.groovy</b></h1>
<p>General purpose utility method for finding resources and resource counts.  It provides methods for finding:</p>
<ul>
	<li>the counts of  platforms, servers, or services</li>
	<li>platforms, servers, or services</li>
	<li>a subset of all platforms, servers, or services</li>
	<li>all platforms, servers, or services, sorted by name</li>
	<li>all resource groups</li>
	<li>a prototype by name</li>
	<li>all prototypes of platforms, servers, and services a group by ID</li>
</ul>


<h1><a name="HQGroovyAPIs-AlertHelper.groovy"></a><b>AlertHelper.groovy</b></h1>
<p>Provides methods to find:</p>
<ul>
	<li>Alerts within a specified timerange, greater or equal to a given priority</li>
	<li>Recent alerts with at least the specified severity level</li>
	<li>Group alerts within a specified timerange, greater or equal to a given priority</li>
	<li>Recent alerts with at least the specified severity level</li>
	<li>All alert definitions</li>
	<li>Type-based alert definitions; these are the templates for the individual resource definitions.</li>
	<li>Group alert definition</li>
</ul>


<h1><a name="HQGroovyAPIs-AuditHelper.groovy"></a><b>AuditHelper.groovy</b></h1>
<h1><a name="HQGroovyAPIs-BaseHelper.groovy"></a><b>BaseHelper.groovy</b></h1>
<h1><a name="HQGroovyAPIs-MetricHelper.groovy"></a><b>MetricHelper.groovy</b></h1>
<h1><a name="HQGroovyAPIs-AgentHelper.groovy"></a><b>AgentHelper.groovy</b></h1>

				    
                    			    </td>
		    </tr>
	    </table>
	    <table border="0" cellpadding="0" cellspacing="0" width="100%">
			<tr>
				<td height="12" background="http://support.hyperic.com/images/border/border_bottom.gif"><img src="images/border/spacer.gif" width="1" height="1" border="0"/></td>
			</tr>
		    <tr>
			    <td align="center"><font color="grey">Document generated by Confluence on Oct 01, 2012 10:08</font></td>
		    </tr>
	    </table>
    </body>
</html>
