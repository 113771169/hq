<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
    <head>
        <title>vFabric Hyperic 5.7 : Troubleshoot Agent and Server Problems</title>
	    <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">	    
    </head>

    <body>
<b><a href="vFabric Hyperic 5.7.html" title="vFabric Hyperic 5.7 Documentation Home">vFabric Hyperic 5.7 Documentation Home (Internal)</a>
 - <a href="https://www.vmware.com/support/pubs/vfabric-hyperic.html">vFabric Hyperic 5.7 Documentation Home (Online)</a>
 -  <a href="https://www.vmware.com/support/vfabric-hyperic/doc/vfabric-hyperic-rn-5.0.html">Hyperic 5.7 Release Notes</a> </b>
 <p>
 <p>
	    <table class="pagecontent" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#ffffff">
		    <tr>
			    <td valign="top" class="pagebody">
				    <div class="pageheader">
					    <span class="pagetitle">
                            vFabric Hyperic 5.7 : Troubleshoot Agent and Server Problems
                                                    </span>
				    </div>
				    <div class="pagesubheading">
					    This page last changed on Sep 21, 2012 by <font color="#0050B2">mmcgarry</font>.
				    </div>

				    

<p>This page has tips for troubleshooting problems in a VMware vFabric™ Hyperic® deployment.</p>


<style type='text/css'>/*<![CDATA[*/
div.rbtoc1348261155881 {margin-left: 1.5em;padding: 0px;}
div.rbtoc1348261155881 ul {list-style: disc;margin-left: 0px;padding-left: 20px;}
div.rbtoc1348261155881 li {margin-left: 0px;padding-left: 0px;}

/*]]>*/</style><div class='rbtoc1348261155881'>
<ul>
    <li><a href='#TroubleshootAgentandServerProblems-LookingforClues'>Looking for Clues</a></li>
<ul>
    <li><a href='#TroubleshootAgentandServerProblems-HQHealth'>HQ Health</a></li>
    <li><a href='#TroubleshootAgentandServerProblems-hqstatsandagentstats'>hqstats and agentstats</a></li>
    <li><a href='#TroubleshootAgentandServerProblems-AgentMetrics'>Agent Metrics</a></li>
    <li><a href='#TroubleshootAgentandServerProblems-LogFiles'>Log Files</a></li>
    <li><a href='#TroubleshootAgentandServerProblems-ThreadDumps'>Thread Dumps</a></li>
    <li><a href='#TroubleshootAgentandServerProblems-CheckPortAvailability'>Check Port Availability</a></li>
</ul>
    <li><a href='#TroubleshootAgentandServerProblems-HypericServerProblems'>Hyperic Server Problems</a></li>
    <li><a href='#TroubleshootAgentandServerProblems-LargeEventTable'>Large Event Table</a></li>
<ul>
    <li><a href='#TroubleshootAgentandServerProblems-LicenseIssues'>License Issues</a></li>
    <li><a href='#TroubleshootAgentandServerProblems-BackloggedHypericServer'>Backlogged Hyperic Server</a></li>
</ul>
    <li><a href='#TroubleshootAgentandServerProblems-AgentStartuporConnectionProblems'>Agent Startup or Connection Problems</a></li>
<ul>
    <li><a href='#TroubleshootAgentandServerProblems-AgentFailedtoConnecttoServeratFirstStartup'>Agent Failed to Connect to Server at First Startup</a></li>
    <li><a href='#TroubleshootAgentandServerProblems-ServerDoesNotHaveAgentToken'>Server Does Not Have Agent Token</a></li>
    <li><a href='#TroubleshootAgentandServerProblems-AgentStartScriptTimeout'>Agent Start Script Timeout</a></li>
    <li><a href='#TroubleshootAgentandServerProblems-JavaServiceWrapperTimeout'>Java Service Wrapper Timeout</a></li>
    <li><a href='#TroubleshootAgentandServerProblems-ProblemRunningStartScriptsetupOption'>Problem Running Start Script setup Option</a></li>
</ul>
    <li><a href='#TroubleshootAgentandServerProblems-InvalidorUnknownAvailability'>Invalid or Unknown Availability</a></li>
<ul>
    <li><a href='#TroubleshootAgentandServerProblems-OutofSyncAgentandServerClocks'>Out-of-Sync Agent and Server Clocks</a></li>
    <li><a href='#TroubleshootAgentandServerProblems-OverloadedBackend'>Overloaded Backend</a></li>
    <li><a href='#TroubleshootAgentandServerProblems-OverloadedAgent'>Overloaded Agent</a></li>
</ul>
    <li><a href='#TroubleshootAgentandServerProblems-SlowUserInterface'>Slow User Interface</a></li>
    <li><a href='#TroubleshootAgentandServerProblems-WarningMessagesintheAgentLog'>Warning Messages in the Agent Log</a></li>
<ul>
    <li><a href='#TroubleshootAgentandServerProblems-ConnectionTimeoutMessages'>Connection Timeout Messages</a></li>
</ul>
</ul></div>


<h1><a name="TroubleshootAgentandServerProblems-LookingforClues"></a>Looking for Clues</h1>

<p>This section describes options for getting information that might help you diagnose problems in an Hyperic deployment.</p>

<h2><a name="TroubleshootAgentandServerProblems-HQHealth"></a>HQ Health</h2>

<p>The <b>HQ Health</b> page, available in the "Plugins" section of the <b>Administration</b> page, displays a variety of metrics and status about your Hyperic deployment, including server host statistics and Hyperic Server process information.</p>

<p><b>HQ Health</b> provides views, queries, and diagnostic tools that provide visibility into metric loads, caches, the Hyperic database, and agents across your deployment. For more information, see <a href="ui-HQHealth.html" title="ui-HQHealth">ui&#45;HQHealth</a> in <em>vFabric Hyperic User Interface</em>.</p>

<h2><a name="TroubleshootAgentandServerProblems-hqstatsandagentstats"></a>hqstats and agentstats</h2>

<p>Mainly of use to Hyperic Support (or others with an internals-level knowledge of Hyperic), the files in the <tt>hq-server/logs/hqstat</tt> and <tt>AgentHome/logs/agentstats</tt> folders contain a variety of system and subsystem performance, resource usage, and other statistics for the Hyperic Server and Hyperic Agent, respectively.</p>

<p>The statistics files in the <tt>hqstat</tt> and <tt>agentstats</tt> directories are in <tt>.csv</tt> format and can be viewed in a spreadsheet program or other <tt>.csv</tt> viewer.</p>

<h2><a name="TroubleshootAgentandServerProblems-AgentMetrics"></a>Agent Metrics</h2>

<p>Hyperic Agent metrics are helpful in diagnosing many problems that can occur. By default, these metrics are reported:</p>

<ul>
	<li>Availability</li>
	<li>JVM Free Memory - Indicator</li>
	<li>JVM Total Memory - Indicator</li>
	<li>Number of Metrics Collected Per Minute - Indicator</li>
	<li>Number of Metrics Sent to the Server Per Minute</li>
	<li>Server Offset</li>
	<li>Total Time Spend Fetching Metrics per Minute</li>
</ul>


<p>Depending on your environment, you may find it useful to track other agent metrics, such as:</p>

<p>In addition to the default metrics</p>

<ul>
	<li>Number of Metrics which Failed to be Collected&nbsp;</li>
	<li>Number of Metrics which Failed to be Collected per Minute</li>
	<li>Maximum Time Spent Processing a Request</li>
	<li>Number of Connection Failures</li>
	<li>Total Time Spent Fetching Metrics per Minute</li>
</ul>


<p>For more information about default and available agent metrics see <a href="View Hyperic Agent Metrics.html" title="View Hyperic Agent Metrics">View Hyperic Agent Metrics</a>.</p>

<h2><a name="TroubleshootAgentandServerProblems-LogFiles"></a>Log Files</h2>

<p>The following log files can be a useful source of information in the event that a problem occurs in a Hyperic deployment:</p>

<ul>
	<li><tt>ServerHome/logs/wrapper.log</tt></li>
	<li><tt>ServerHome/logs/bootstrap.log</tt></li>
	<li><tt>ServerHome/logs/server.log</tt></li>
	<li><tt>ServerHome/logs/hqdb.log</tt> (only available for deployments using the built-in PostgreSQL database.</li>
	<li><tt>AgentHome/logs/wrapper.log</tt></li>
	<li><tt>AgentHome/logs/agent.log</tt></li>
	<li><tt>AgentHome/logs/agent.log.startup</tt></li>
</ul>


<p>You can increase the level of logging an agent performs in its <tt>agent.properties</tt> file. Note that debug logging is very verbose and uses more system resources. Hyperic recommends configuring debug logging only when troubleshooting problems, and only at the subsystem level. For more information, see <a href="Configure Agent Logging.html" title="Configure Agent Logging">Configure Agent Logging</a>.</p>

<h2><a name="TroubleshootAgentandServerProblems-ThreadDumps"></a>Thread Dumps</h2>

<p>This section has instructions for generating thread dumps for the Hyperic Server and Hyperic Agent.</p>

<h3><a name="TroubleshootAgentandServerProblems-GenerateaHypericServerThreadDumpfromUserInterface"></a>Generate a Hyperic Server Thread Dump from User Interface</h3>

<p>Follow these steps to output a server thread dump to your browser.</p>

<ol>
	<li>Click the <b>Administration</b> tab.</li>
	<li>Click <b>HQ Health</b> in the <b>Plugins</b> section of the <b>Administration</b> page.</li>
	<li>Click <b>Print</b> in the <b>HQ Process Information</b> section on the <b>HQ Health</b> page.</li>
</ol>


<h3><a name="TroubleshootAgentandServerProblems-GenerateaHypericServerThreadDumpfromCommandLine"></a>Generate a Hyperic Server Thread Dump from Command Line</h3>

<p>To generate a thread dump on Windows:</p>
<ul>
	<li>If Hyperic Server is running in a terminal window &#8212; Try <b>&lt;cntrl&gt;&lt;break&gt;</b> in the terminal window.</li>
	<li>If Hyperic Server is running as a service &#8212; Use a tool like <a href="http://www.adaptj.com/main/stacktrace">StackTrace</a>.</li>
</ul>


<p>To generate a thread dump on Unix-like systems, use <tt>jstack</tt> <a href="http://download.oracle.com/javase/1.5.0/docs/tooldocs/share/jstack.html">http://download.oracle.com/javase/1.5.0/docs/tooldocs/share/jstack.html</a> on the Hyperic Server process. For example, if the server's PID is 215:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">jstack 215 &gt;mydumpfile.txt</pre>
		</div>
</div></div>

<div class='panelMacro'><table class='tipMacro'><colgroup><col width='24'><col></colgroup><tr><td valign='top'><img src="images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td><b>How to find the Hyperic Server PID</b><br />You can run <tt>jps</tt> in a shell to determine the Hyperic Server's process ID &#8212; look for the process named "Bootstrap". For example:

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">$ jps
187 WrapperStartStopApp
408 Jps
215 Bootstrap</pre>
		</div>
</div></div></td></tr></table></div>
<div class='panelMacro'><table class='infoMacro'><colgroup><col width='24'><col></colgroup><tr><td valign='top'><img src="images/icons/emoticons/information.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>On Unix-like systems, you can also run <tt>Kill &#45;3</tt> on the Hyperic server process. Note however, that if you do, the thread dump will be written to <tt>wrapper.log</tt>, and be difficult to parse.</td></tr></table></div>
<h3><a name="TroubleshootAgentandServerProblems-GenerateAgentThreadDumpfromUserInterface"></a>Generate Agent Thread Dump from User Interface</h3>

<p>Run the agent launcher with the <tt>dump</tt> option. For more information see <a href="Start, Stop, and Other Agent Operations.html" title="Start, Stop, and Other Agent Operations">Start, Stop, and Other Agent Operations</a></p>

<h2><a name="TroubleshootAgentandServerProblems-CheckPortAvailability"></a>Check Port Availability</h2>

<p>The Hyperic Server must be able to establish a connection with the agent, and vice versa.</p>

<p>To verify that the server can access the agent's listen port, run the following from the server platform:  </p>

<p><tt>telnet AgentIp AgentPort</tt></p>

<p>For example:</p>

<p><tt>$ telnet 192.168.1.114 2144</tt></p>

<p>For a successful connection, the results are similar to:</p>

<div class="preformatted panel" style="border-width: 1px;"><div class="preformattedContent panelContent">
<pre>Trying 127.0.0.1...
Connected to localhost.
Escape character is '^\]'.
GET

Connection closed by foreign host.
</pre>
</div></div>

<p>To verify that the agent can access the server's listen port, run the following from the agent platform:  <br/>
<tt>$ telnet ServerIP ServerPort</tt>  </p>

<p>For example:</p>

<p><tt>$ telnet 192.168.1.114 7080</tt></p>



<h1><a name="TroubleshootAgentandServerProblems-HypericServerProblems"></a>Hyperic Server Problems</h1>

<p>This section describes problems that could prevent the Hyperic Server from starting up.</p>

<h1><a name="TroubleshootAgentandServerProblems-LargeEventTable"></a>Large Event Table</h1>

<p>A message like the following in <tt>server.log</tt> indicates that the <tt>EAM_EVENT_LOG</tt> is so large that trigger initialization is taking more than 15 minutes. </p>

<h2><a name="TroubleshootAgentandServerProblems-LicenseIssues"></a>License Issues </h2>

<p>In vFabric Hyperic, the number of platforms you can manage is limited by your license.  For more information, see <a href="Install or Configure Hyperic License.html" title="Install or Configure Hyperic License">Install or Configure Hyperic License</a>.</p>

<h2><a name="TroubleshootAgentandServerProblems-BackloggedHypericServer"></a>Backlogged Hyperic Server</h2>

<p>When the Hyperic Server starts after a period of downtime, it can be inundated with metric reports from agents that continued to run while the server was down. When the server is processing a large metric backlog from many agents, the maximum size of the agent-server connection pool size can become a bottleneck and affect server performance.</p>

<p>You can check the "Current Thread Busy" metric for the Hyperic Server's internal Tomcat server to determine whether connection pool size is an issue.</p>

<p>To enable a restarted server catch up with a metric backlog you can increase the maximum size of the agent-server connection pool &#8212; typically this is the only time that increasing the size of the connection pool is indicated. The maximum number of agent-server connections is configured with the <tt>org.hyperic.lather.maxConns</tt> property in <tt>web.xml</tt>. Note however that, in effect, the number of connections is limited by the maximum number of server execution threads, which is configured using the <tt>tomcat.maxthreads</tt> property in <tt>server.conf</tt>. So, when you increase the value of <tt>org.hyperic.lather.maxConns</tt>, it may be necessary to increase the value of <tt>tomcat.maxthreads</tt>.</p>

<p>To enable a backlogged Hyperic Server to catch up, enable 5% to 10% more connections than there are agents reporting to the server. For example, if you have 1000 agents, enable 1050 to 1100 agent-server connections.</p>

<p>To change the size of the agent-server connection pool:</p>

<ol>
	<li>As necessary, update the maximum number of agent-server connections &#8212; <tt>org.hyperic.lather.maxConns</tt> &#8212; in <tt>&lt;Server installation directory&gt;/hq-engine/hq-server/webapps/ROOT/WEB-INF/web.xml</tt> file, in the stanza shown below. Ensure that the value of <tt>maxConns</tt> is 5% to 10% greater than the number of agents that report to the server.
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">&lt;init-param&gt;
&lt;param-name&gt;org.hyperic.lather.maxConns&lt;/param-name&gt;
&lt;param-value&gt;3000&lt;/param-value&gt;
&lt;/init-param&gt;</pre>
		</div>
</div></div></li>
	<li>As necessary, configure the maximum number of Tomcat threads &#8212; <tt>tomcat.maxthreads</tt>  &#8212; in <tt>server.conf</tt>. Ensure that the value of <tt>maxThreads</tt> greater than the value of <tt>maxConns</tt>.</li>
	<li>Restart the Hyperic Server to enable the changes to take effect.</li>
</ol>


<h1><a name="TroubleshootAgentandServerProblems-AgentStartuporConnectionProblems"></a>Agent Startup or Connection Problems</h1>

<p>This section describes problems that could prevent the Hyperic Agent from starting up or connecting to the Hyperic Server.</p>

<h2><a name="TroubleshootAgentandServerProblems-AgentFailedtoConnecttoServeratFirstStartup"></a>Agent Failed to Connect to Server at First Startup</h2>

<p>Every time an agent starts up it attempts to contact the Hyperic Server. If, the first time you start up an agent, it cannot connect to the server, the agent will continue to have problems connecting to the server, even after the server is reachable.</p>

<p>The first time a Hyperic Agent successfully connects with the Hyperic Server, the agent saves the server connection settings in its <tt>/data</tt> directory. If the server is not available (because the wrong address/port was configured for the agent, or because the server hasn't been started or is still in the process of starting up) the agent will fail to connect, and hence fail to persist the server connection data. Upon agent restart, the agent will not be able to find the connection data it requires, and fail to connect to the server. In this case, <tt>server.log</tt> will contain a message similar to:</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">2010-04-20 11:04:26,640 ERROR [Thread-1|Thread-1] [AutoinventoryCommandsServer] Unable to send autoinventory platform data to server, sleeping for 33 secs before retrying. Error: Unable to communicate with server -- provider not yet setup</pre>
		</div>
</div></div>

<p>To solve this problem:</p>

<ol>
	<li>Delete the agent's <tt>/data</tt> directory.
	<ul>
		<li>This forces the agent to obtain new agent - server communication properties.</li>
	</ul>
	</li>
	<li>Verify the address and listen port for the Hyperic Server.
	<ul>
		<li>Is there a firewall between agent and server? See the instructions in Configure Agent &#45; Server Communication Interactively or Configure Agent &#45; Server Communication in Properties File.</li>
	</ul>
	</li>
	<li>Verify the Hyperic Server is up.</li>
	<li>Start the agent, supplying the correct server connection properties, either in <tt>agent.properties</tt> or interactively. See the instructions referenced in step 2 above.</li>
</ol>


<p><a name="TroubleshootAgentandServerProblems-TokenGone"></a></p>
<h2><a name="TroubleshootAgentandServerProblems-ServerDoesNotHaveAgentToken"></a>Server Does Not Have Agent Token</h2>

<p>Starting in 4.6.5, if all platforms managed by an agent are removed from Hyperic inventory, the Hyperic Server also removes the saved authentication token for that agent from the Hyperic database. So after you delete a platform that is managed by an agent that does not manage any other platforms (as in the case of an agent that manages only the platform it runs on), the Hyperic Server will not accept connections from that agent.</p>

<p>If you want the agent to rediscover the platform, you must repeat the initial agent setup process. To force the agent setup dialog:</p>

<ul>
	<li>While the agent is running, by running the agent launcher with the <tt>setup</tt> option, or</li>
	<li>By deleting the agent's <tt>/data</tt> and restarting the agent.</li>
</ul>




<h2><a name="TroubleshootAgentandServerProblems-AgentStartScriptTimeout"></a>Agent Start Script Timeout</h2>

<p>By default, the agent start script times out after five minutes if the startup sequence is not successful. Check the <tt>agent.log.startup</tt> file for messages.</p>

<p>If desired, you can configure a longer timeout period &#8211; to give the agent more time to connect to the server &#8212; by adding the <tt>agent.startupTimeOut</tt> property, defined below, to the <tt>agent.properties</tt> file.</p>

<div class='panelMacro'><table class='tipMacro'><colgroup><col width='24'><col></colgroup><tr><td valign='top'><img src="images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td><b>agent.startupTimeOut</b><br />
<p><b>Description</b></p>

<p>The number of seconds that the agent startup script will wait before determining that the agent did not startup successfully. If the agent is not determined to be listening for requests within this period of time, an error is logged, and the startup script times out. </p>

<p><b>Default</b></p>

<p>As installed, agent.properties does not contain a line that defines the value of this property. The default behavior of the agent is to timeout after 300 seconds.</p></td></tr></table></div>
<p>After editing the <tt>agent.properties</tt> file, save your changes and restart the agent.</p>

<h2><a name="TroubleshootAgentandServerProblems-JavaServiceWrapperTimeout"></a>Java Service Wrapper Timeout</h2>

<p>Under high load, the agent may become unresponsive. If this occurs and there are no coincident errors or warnings in the agent log that indicate another explanation, it may be that the agent JVM was starved for memory, and unresponsive to a ping from the Java Service Wrapper (JSW).</p>

<p>In that case the <tt>wrapper.log</tt> file will contain an entry like this:</p>

<p><tt>ERROR &#124; wrapper &#124; 2009/01/15 02:15:18 &#124; JVM appears hung: Timed out waiting for signal from JVM.</tt></p>

<p>To resolve the problem, you can configure the JSW to give the agent more time to respond to startup and ping requests.</p>

<p>Increase the JSW's timeout period from 30 seconds to 300. To do so, add this property to <tt>AGENT_HOME/bundles/agent-4.x.xxxx/conf/wrapper.conf</tt>.</p>

<p><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">wrapper.ping.timeout=300</pre>
		</div>
</div></div>This will cause the JSW to wait longer for a ping response before determining that the JVM is hung.</p>

<p>Increase the agent's startup timeout from 30 seconds to 300. This will give the agent more time to start up before wrapper gives up on it and kills the process. To do so, add this property value:</p>

<p><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">wrapper.startup.timeout=300</pre>
		</div>
</div></div>to</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">AgentHome/bundles/agent-4.x.xxxx/conf/wrapper.conf</pre>
		</div>
</div></div>

<h2><a name="TroubleshootAgentandServerProblems-ProblemRunningStartScriptsetupOption"></a>Problem Running Start Script setup Option</h2>

<div class='panelMacro'><table class='tipMacro'><colgroup><col width='24'><col></colgroup><tr><td valign='top'><img src="images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td><b>If agent.scu is missing...</b><br />Iff a Hyperic Agent's <tt>AgentHome/conf/agent.scu</tt> file is missing, subsequent attempts to run the agent start script (<tt>hq-agent.sh</tt> or <tt>hq-agent.bat</tt>) with the <tt>setup</tt> option will fail. To resolve this problem, you must either:

<ul>
	<li>Reinstall the agent, or</li>
</ul>


<ul>
	<li>Perform these steps:
	<ol>
		<li>Stop the agent.</li>
		<li>Delete its <tt>/data</tt> directory.</li>
		<li>Set <tt>agent.setup.camPword</tt> in <tt>AgentHome/conf/agent.properties</tt> to a plain text value.</li>
		<li>Start the agent.</li>
	</ol>
	</li>
</ul>
</td></tr></table></div>

<h1><a name="TroubleshootAgentandServerProblems-InvalidorUnknownAvailability"></a>Invalid or Unknown Availability</h1>

<p>This section describes reasons that Hyperic might incorrectly show an agent (or agent-managed resource) as unavailable, show its availability status as "Unknown" (availability icon is grey), or "flapping" availability values.</p>

<h2><a name="TroubleshootAgentandServerProblems-OutofSyncAgentandServerClocks"></a>Out-of-Sync Agent and Server Clocks</h2>

<p>If Hyperic erroneously indicates that resources are unavailable, it may be because the system clocks on the agent and server hosts are out-of-sync. By default, Hyperic monitors the offset between the server and an agent &#8212; see the "Server Offset" metric on the <b>Monitor</b> tab. An offset of less than one minute is unlikely to pose problems; with a larger offset, problems may occur.</p>

<p>To solve an offset problem, install NTP and synchronize system clocks on the agent and server hosts.</p>

<p>To prevent agent and server becoming significantly out-of-sync, you can run NTP on each system, use Hyperic to monitor the offset on each system, and set alerts based on the offset metric. To do so, configure a platform service of type "NTP" to monitor each NTP service, and set alerts to fire when an offset from the time authority grows unacceptably high. For more information, see the "Network Services" section in <em>vFabric Hyperic Resource Configuration and Metrics</em>. </p>

<h2><a name="TroubleshootAgentandServerProblems-OverloadedBackend"></a>Overloaded Backend</h2>

<p>If the Hyperic database cannot process metrics at the rate it receives them, resources that are available my be incorrectly shown as unavailable.</p>

<p>You can view Hyperic Server process statistics, as well as load and utilization data - load, process, system and JVM memory, and so on - on the <b>HQ Health</b> page.</p>

<p>Based on your load, it may be appropriate to tune Hyperic Server, the Hyperic database, or both. For more information, see <a href="Scaling and Tuning Hyperic Performance.html" title="Scaling and Tuning Hyperic Performance">Scaling and Tuning Hyperic Performance</a>. </p>

<p><b>Important:</b> First and foremost: run the Hyperic database on dedicated hardware. Competition for system resources can slow down metric processing.</p>

<h2><a name="TroubleshootAgentandServerProblems-OverloadedAgent"></a>Overloaded Agent</h2>

<p>If an agent's queue of metrics grows to a certain level over a period of time, the following warning message is written to the <tt>agent.log</tt> file:</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">The Agent is having a hard time keeping up with the frequency of metrics taken. Consider increasing your collection interval.</pre>
		</div>
</div></div>

<p>To investigate, you can configure the the agent to report the "Total Time Spent Fetching Metrics per Minute" metric &#8212; if the agent spends more than half its time  fetching metrics &#8212; it is overloaded.</p>

<p>You can alleviate the problem by</p>
<ul>
	<li>Increase metric collection intervals &#8212; For most metrics, the default is every 5 or 10 minutes. You can change the collection interval for all metrics collected for a resource type on the <b>Administration &gt; Monitoring Defaults</b> page for the resource type.</li>
</ul>


<div class='panelMacro'><table class='tipMacro'><colgroup><col width='24'><col></colgroup><tr><td valign='top'><img src="images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td><b>Want to Change a Whole Bunch of Metric Collection Intervals?</b><br />If you want to change metric templates in bulk, or without using the Hyperic user interface, you can change metric collection settings - including collection intervals - &nbsp;for a resource type with the HQApi <b>metricTemplate</b> command. You can use the <b>metricTemplate sync</b> option from the command line or in a script, as desired. For more information, see <a href="HQApi metricTemplate command.html" title="HQApi metricTemplate command">HQApi metricTemplate command</a> section in <em>vFabric Hyperic Web Services API</em>.</td></tr></table></div>

<div class='panelMacro'><table class='tipMacro'><colgroup><col width='24'><col></colgroup><tr><td valign='top'><img src="images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td><b>Try to redistribute load</b><br />If an agent that logs metric volume warnings is monitoring a large number of remote services over the network (for example, HTTP, FTP, SNMP, or another service type whose protocol the agent supports), you can spread the load around &#8212; configure a different agent to monitor some of the network services. You can compare the agent loads on the <b>Agents</b> tab of <b>HQ Health</b>.</td></tr></table></div>


<h1><a name="TroubleshootAgentandServerProblems-SlowUserInterface"></a>Slow User Interface</h1>

<p>If Hyperic's web user interface is slow, the cause may be an overloaded backend - the Hyperic database, or the Hyperic Server itself. See <a href="#TroubleshootAgentandServerProblems-OverloadedBackend">Overloaded Backend</a>.</p>


<h1><a name="TroubleshootAgentandServerProblems-WarningMessagesintheAgentLog"></a>Warning Messages in the Agent Log</h1>

<p>This section has information about the significance of selected warning messages that might be written to the <tt>agent.log</tt> file.</p>

<h2><a name="TroubleshootAgentandServerProblems-ConnectionTimeoutMessages"></a>Connection Timeout Messages</h2>

<p>Lather, the connection protocol for agent-to-server communication, is configured such that agent connections time out after five minutes, and a timeout message is written to <tt>agent.log</tt>. You can increase the timeout period from 300000 to 900000 in this file:</p>

<p><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">hq-engine/server/default/deploy/lather-jboss.sar/jboss-lather.war/WEB-INF/web.xml</pre>
		</div>
</div></div>in this stanza:</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">&lt;init-param&gt;
&lt;param-name&gt;org.hyperic.lather.execTimeout&lt;/param-name&gt;
&lt;param-value&gt;900000&lt;/param-value&gt;
&lt;/init-param&gt;</pre>
		</div>
</div></div>

				    
                    			    </td>
		    </tr>
	    </table>
	    <table border="0" cellpadding="0" cellspacing="0" width="100%">
			<tr>
				<td height="12" background="http://support.hyperic.com/images/border/border_bottom.gif"><img src="images/border/spacer.gif" width="1" height="1" border="0"/></td>
			</tr>
		    <tr>
			    <td align="center"><font color="grey">Document generated by Confluence on Oct 01, 2012 10:06</font></td>
		    </tr>
	    </table>
    </body>
</html>
