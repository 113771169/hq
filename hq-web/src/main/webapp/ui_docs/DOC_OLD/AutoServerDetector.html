<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
    <head>
        <title>vFabric Hyperic 5.0 : AutoServerDetector</title>
	    <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">	    
    </head>

    <body>
<b><a href="vFabric Hyperic 5.0.html" title="vFabric Hyperic 5.0 Documentation Home">vFabric Hyperic 5.0 Documentation Home (Internal)</a>
 - <a href="https://www.vmware.com/support/pubs/vfabric-hyperic.html">vFabric Hyperic 5.0 Documentation Home (Online)</a>
 -  <a href="https://www.vmware.com/support/vfabric-hyperic/doc/vfabric-hyperic-rn-5.0.html">Hyperic 5.0 Release Notes</a> </b>
 <p>
 <p>
	    <table class="pagecontent" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#ffffff">
		    <tr>
			    <td valign="top" class="pagebody">
				    <div class="pageheader">
					    <span class="pagetitle">
                            vFabric Hyperic 5.0 : AutoServerDetector
                                                    </span>
				    </div>
				    <div class="pagesubheading">
					    This page last changed on Jan 04, 2012 by <font color="#0050B2">mmcgarry</font>.
				    </div>

				    <p><font color="gray"><em>Topics marked with</em></font> <font color="red">*</font> <font color="gray"><em>relate to features available only in vFabric Hyperic.</em></font></p>


<style type='text/css'>/*<![CDATA[*/
div.rbtoc1325699780779 {margin-left: 1.5em;padding: 0px;}
div.rbtoc1325699780779 ul {list-style: disc;margin-left: 0px;padding-left: 20px;}
div.rbtoc1325699780779 li {margin-left: 0px;padding-left: 0px;}

/*]] >*/</style><div class='rbtoc1325699780779'>
<ul>
    <li><a href='#AutoServerDetector-Overview'>Overview</a></li>
    <li><a href='#AutoServerDetector-InterfaceHierarchy'>Interface Hierarchy</a></li>
    <li><a href='#AutoServerDetector-InterfaceReferences'>Interface References</a></li>
    <li><a href='#AutoServerDetector-ImplementingMethods'>Implementing Methods</a></li>
    <li><a href='#AutoServerDetector-ExampleUsage'>Example Usage</a></li>
    <li><a href='#AutoServerDetector-StandaloneInvocation'>Standalone Invocation</a></li>
</ul></div>

<h1><a name="AutoServerDetector-Overview"></a>Overview</h1>

<p>The <tt>AutoServerDetector</tt> interface (<tt>org.hyperic.hq.product.AutoServerDetector</tt>) is used to discover server resources when the agent does a default auto-discovery scan or when an auto-discovery scan is explicitly run for a platform. The <tt>AutoServerDetector</tt> interface is called for each  server type defined in the plugin XML descriptor.</p>

<h1><a name="AutoServerDetector-InterfaceHierarchy"></a>Interface Hierarchy</h1>

<ul>
	<li>org.hyperic.hq.product.AutoServerDetector</li>
</ul>


<h1><a name="AutoServerDetector-InterfaceReferences"></a>Interface References</h1>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">package org.hyperic.hq.product;
import java.util.List;
import org.hyperic.util.config.ConfigResponse;</pre>
		</div>
</div></div>

<h1><a name="AutoServerDetector-ImplementingMethods"></a>Implementing Methods</h1>

<p>This interface implements following methods:</p>

<p><tt>getServerResources(ConfigResponse):List</tt></p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">public List getServerResources(ConfigResponse platformConfig)
throws PluginException;</pre>
		</div>
</div></div>
<p>This method is called if the associated autodiscovery implementation is implementing this interface. If plugin defines more that one server type this interface is called against every server type respectively. The method must return a List of <tt>ServerResource</tt> objects. See <a href="ServerResource.html" title="ServerResource">ServerResource</a> for more information.</p>


<p><b>Parameters:</b><br/>
<b>&nbsp;&nbsp; platformConfig</b> Configuration for underlying platform.</p>

<p><b>Returns:</b><br/>
&nbsp;&nbsp; List of <tt>ServerResource</tt> objects.</p>

<p><b>Throws:</b><br/>
&nbsp;&nbsp; org.hyperic.hq.product.PluginException</p>

<h1><a name="AutoServerDetector-ExampleUsage"></a>Example Usage</h1>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">package hq.example;

import java.io.File;
import java.util.ArrayList;
import java.util.Enumeration;
import java.util.Hashtable;
import java.util.List;

import org.hyperic.hq.product.AutoServerDetector;
import org.hyperic.hq.product.PluginException;
import org.hyperic.hq.product.ServerDetector;
import org.hyperic.hq.product.ServerResource;
import org.hyperic.util.config.ConfigResponse;

public class CustomAutoScanDetector
extends ServerDetector
implements AutoServerDetector {

    /** PTQL query to find matching processes */
    private static final String PTQL_QUERY = "State.Name.ct=firefox";

    public List getServerResources(ConfigResponse config) throws PluginException {
        List servers = new ArrayList();
        List paths = getServerProcessList();

        // if no processes found, return empty list.
        // this means we couldn't discover anything.
        if(paths.size() &lt; 1)
            return servers;

        // using empty installation path,
        // since we don't need it anywhere
        String installPath = "";

        ConfigResponse productConfig = new ConfigResponse();

        // need to save original query to config.
        // this can be later altered through hq gui.
        productConfig.setValue("process.query", PTQL_QUERY);
        ServerResource server = createServerResource(installPath);
        setProductConfig(server, productConfig);
        server.setMeasurementConfig();
        servers.add(server);

        return servers;
    }

    private List getServerProcessList() {
        List servers = new ArrayList();
        long[] pids = getPids(PTQL_QUERY);
        for (int i=0; i&lt;pids.length; i++) {
            String exe = getProcExe(pids[i]);
            if (exe == null) {
                continue;
            }
            File binary = new File(exe);
            if (!binary.isAbsolute()) {
                continue;
            }
            servers.add(binary.getAbsolutePath());
        }
        return servers;
    }


}</pre>
		</div>
</div></div>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: xml; gutter: false">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;plugin
   name="autoscan-example"
   package="hq.example"&gt;

      &lt;metrics
            name="basic-process-metrics"&gt;
         &lt;metric
               indicator="true"
               units="percentage"
               name="Availability"
               collectionType="dynamic"
               template="sigar:Type=ProcState,Arg=%process.query%:State"
               category="AVAILABILITY"&gt;
         &lt;/metric&gt;
         &lt;metric
               indicator="true"
               units="B"
               name="Process Virtual Memory Size"
               collectionType="dynamic"
               template="sigar:Type=ProcMem,Arg=%process.query%:Size"
               category="UTILIZATION"&gt;
         &lt;/metric&gt;
         &lt;metric
               units="B"
               name="Process Resident Memory Size"
               template="sigar:Type=ProcMem,Arg=%process.query%:Resident"&gt;
         &lt;/metric&gt;
         &lt;metric
               name="Process Page Faults"
               collectionType="trendsup"
               template="sigar:Type=ProcMem,Arg=%process.query%:PageFaults"&gt;
         &lt;/metric&gt;
         &lt;metric
               units="ms"
               name="Process Cpu System Time"
               collectionType="trendsup"
               template="sigar:Type=ProcCpu,Arg=%process.query%:Sys"&gt;
         &lt;/metric&gt;
         &lt;metric
               units="ms"
               name="Process Cpu User Time"
               collectionType="trendsup"
               template="sigar:Type=ProcCpu,Arg=%process.query%:User"&gt;
         &lt;/metric&gt;
         &lt;metric
               units="ms"
               name="Process Cpu Total Time"
               collectionType="trendsup"
               template="sigar:Type=ProcCpu,Arg=%process.query%:Total"&gt;
         &lt;/metric&gt;
         &lt;metric
               indicator="true"
               units="percentage"
               name="Process Cpu Usage"
               template="sigar:Type=ProcCpu,Arg=%process.query%:Percent"&gt;
         &lt;/metric&gt;
         &lt;metric
               units="epoch-millis"
               name="Process Start Time"
               collectionType="static"
               template="sigar:Type=ProcTime,Arg=%process.query%:StartTime"
               category="AVAILABILITY"&gt;
         &lt;/metric&gt;
         &lt;metric
               name="Process Open File Descriptors"
               template="sigar:Type=ProcFd,Arg=%process.query%:Total"&gt;
         &lt;/metric&gt;
         &lt;metric
               name="Process Threads"
               template="sigar:Type=ProcState,Arg=%process.query%:Threads"&gt;
         &lt;/metric&gt;
      &lt;/metrics&gt;

      &lt;server name="autoscanserver"&gt;
         &lt;plugin
               type="autoinventory"
               class="CustomAutoScanDetector"&gt;
         &lt;/plugin&gt;
         &lt;plugin
               type="measurement"
               class="org.hyperic.hq.product.MeasurementPlugin"&gt;
         &lt;/plugin&gt;
         &lt;config&gt;
            &lt;option
                  default="State.Name.eq=firefox"
                  name="process.query"
                  description="Process Query for customserver"&gt;
            &lt;/option&gt;
         &lt;/config&gt;
         &lt;metrics
               include="basic-process-metrics"&gt;
         &lt;/metrics&gt;
      &lt;/server&gt;

&lt;/plugin&gt;</pre>
		</div>
</div></div>


<h1><a name="AutoServerDetector-StandaloneInvocation"></a>Standalone Invocation</h1>

<p>Standalone invocation is done using <tt>-m discover</tt> and <tt>-p &lt;server type name&gt;</tt> options.</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false"># java -jar hq-pdk.jar
-Dplugins.include=autoscan-example
-Dlog=info
-m discover
-p autoscanserver</pre>
		</div>
</div></div>




				    
                    			    </td>
		    </tr>
	    </table>
	    <table border="0" cellpadding="0" cellspacing="0" width="100%">
			<tr>
				<td height="12" background="http://support.hyperic.com/images/border/border_bottom.gif"><img src="images/border/spacer.gif" width="1" height="1" border="0"/></td>
			</tr>
		    <tr>
			    <td align="center"><font color="grey">Document generated by Confluence on Oct 01, 2012 10:08</font></td>
		    </tr>
	    </table>
    </body>
</html>
