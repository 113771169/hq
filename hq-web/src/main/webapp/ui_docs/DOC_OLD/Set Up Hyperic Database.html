<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
    <head>
        <title>vFabric Hyperic 5.0 : Set Up Hyperic Database</title>
	    <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">	    
    </head>

    <body>
<b><a href="vFabric Hyperic 5.0.html" title="vFabric Hyperic 5.0 Documentation Home">vFabric Hyperic 5.0 Documentation Home (Internal)</a>
 - <a href="https://www.vmware.com/support/pubs/vfabric-hyperic.html">vFabric Hyperic 5.0 Documentation Home (Online)</a>
 -  <a href="https://www.vmware.com/support/vfabric-hyperic/doc/vfabric-hyperic-rn-5.0.html">Hyperic 5.0 Release Notes</a> </b>
 <p>
 <p>
	    <table class="pagecontent" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#ffffff">
		    <tr>
			    <td valign="top" class="pagebody">
				    <div class="pageheader">
					    <span class="pagetitle">
                            vFabric Hyperic 5.0 : Set Up Hyperic Database
                                                    </span>
				    </div>
				    <div class="pagesubheading">
					    This page last changed on Aug 27, 2012 by <font color="#0050B2">mmcgarry</font>.
				    </div>

				    <style type='text/css'>/*<![CDATA[*/
div.rbtoc1346104862643 {margin-left: 1.5em;padding: 0px;}
div.rbtoc1346104862643 ul {list-style: disc;margin-left: 0px;padding-left: 20px;}
div.rbtoc1346104862643 li {margin-left: 0px;padding-left: 0px;}

/*]]>*/</style><div class='rbtoc1346104862643'>
<ul>
    <li><a href='#SetUpHypericDatabase-AbouttheRPM'>About the RPM</a></li>
    <li><a href='#SetUpHypericDatabase-InstallPostgreSQLRPM'>Install PostgreSQL RPM</a></li>
<ul>
    <li><a href='#SetUpHypericDatabase-AboutInstallationLocations'>About Installation Locations</a></li>
    <li><a href='#SetUpHypericDatabase-DefaultDatabaseandUser'>Default Database and User</a></li>
</ul>
    <li><a href='#SetUpHypericDatabase-CreateDatabaseUserforHyperic'>Create Database User for Hyperic</a></li>
    <li><a href='#SetUpHypericDatabase-ConfigurePostgreSQLListenAddresses'>Configure PostgreSQL Listen Addresses</a></li>
    <li><a href='#SetUpHypericDatabase-ConfigureClientAuthentication'>Configure Client Authentication</a></li>
    <li><a href='#SetUpHypericDatabase-InstallPostgreSQLClientontheHypericServerHost'>Install PostgreSQL Client on the Hyperic Server Host</a></li>
<ul>
    <li><a href='#SetUpHypericDatabase-InstalltheHypericServer'>Install the Hyperic Server</a></li>
    <li><a href='#SetUpHypericDatabase-StartHypericServer'>Start Hyperic Server</a></li>
</ul>
    <li><a href='#SetUpHypericDatabase-TroubleshootPostgreSQLConnectionProblems'>Troubleshoot PostgreSQL Connection Problems</a></li>
    <li><a href='#SetUpHypericDatabase-UsefulPostgreSQLCommands'>Useful PostgreSQL Commands</a></li>
</ul></div>


<p>This section provides instructions for setting up vPostgreSQL or PostreSQL as your external Hyperic database. </p>

<p>This task corresponds to <a href="Hyperic Installation and Startup Process.html#HypericInstallationandStartupProcess-SetUpDatabase">Step 2 - Set Up Hyperic Database</a> of <a href="Hyperic Installation and Startup Process.html" title="Hyperic Installation and Startup Process">Hyperic Installation and Startup Process</a>. </p>

<p>These instructions assume that you are performing a new installation of an RPM package of PostgreSQL, using <tt>yum</tt>, an RPM package installer.</p>

<h1><a name="SetUpHypericDatabase-AbouttheRPM"></a>About the RPM </h1>


<div class='panelMacro'><table class='tipMacro'><colgroup><col width='24'><col></colgroup><tr><td valign='top'><img src="images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td><b>Hyperic requires utf-8 character encoding</b><br />Create the Hyperic database with utf-8 character encoding.</td></tr></table></div>

<h1><a name="SetUpHypericDatabase-InstallPostgreSQLRPM"></a>Install PostgreSQL RPM</h1>

<p>Log in as root to the target Linux machine, and enter this command:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">yum install postgresql postgresql-server</pre>
		</div>
</div></div>

<h2><a name="SetUpHypericDatabase-AboutInstallationLocations"></a>About Installation Locations</h2>

<p>The PostgreSQL RPM installation locations may vary by platform vendor. RHEL locations are listed below. </p>

<ul>
	<li>Executables &#8212; <tt>/usr/bin</tt></li>
	<li>Libraries &#8212; <tt>/usr/lib</tt></li>
	<li>Documentation &#8212; <tt>/usr/share/doc/postgresql-x.y.z</tt>, <tt>/usr/share/doc/postgresql-x.y.z/contrib</tt></li>
	<li>Contrib &#8212; <tt>/usr/share/pgsql/contrib</tt></li>
	<li>Data &#8212; <tt>/var/lib/pgsql/data</tt></li>
	<li>Backup area &#8212; <tt>/var/lib/pgsql/backup</tt></li>
	<li>Templates &#8212; <tt>/usr/share/pgsql</tt></li>
	<li>Procedural Languages &#8212; <tt>/usr/lib/pgsql</tt></li>
	<li>Development Headers &#8212; <tt>/usr/include/pgsql</tt></li>
	<li>Other shared data &#8212; <tt>/usr/share/pgsql</tt></li>
	<li>Regression tests &#8212; <tt>/usr/lib/pgsql/test/regress</tt> (in the <tt>-test</tt> package)</li>
	<li>Documentation SGML &#8212; <tt>/usr/share/doc/postgresql-docs-x.y.z</tt></li>
</ul>


<h2><a name="SetUpHypericDatabase-DefaultDatabaseandUser"></a>Default Database and User</h2>

<p>The RPM installer creates a "postgres" database instance in the <tt>var/vmware/vpostgres/9.1/pgdata</tt> directory, with database user "postgres".  THe installer also creates a "postgres" user on the host platform itself.</p>


<h1><a name="SetUpHypericDatabase-CreateDatabaseUserforHyperic"></a>Create Database User for Hyperic</h1>

<p>In this step you create the account that the Hyperic Server will use to connect to the Hyperic database. The username is "admin", the password "hqadmin".</p>

<ol>
	<li>Change user to PostgreSQL and connect to the database locally.
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false"># su postgres</pre>
		</div>
</div></div>
	<ul>
		<li>The psql prompt is displayed.</li>
	</ul>
	</li>
	<li>Create a user named <tt>admin</tt> with <tt>login</tt> and <tt>createdb</tt> privileges.
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">create role admin with login createdb password 'hqadmin';</pre>
		</div>
</div></div></li>
	<li>Create a default database for Hyperic. Place quotes around the string <tt>HQ</tt> so that the database name will be uppercase.
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">CREATE DATABASE "HQ" OWNER admin;</pre>
		</div>
</div></div></li>
</ol>


<h1><a name="SetUpHypericDatabase-ConfigurePostgreSQLListenAddresses"></a>Configure PostgreSQL Listen Addresses</h1>

<p>The default permissions for a PostgreSQL database allow local connections only. In this step, you configure PostgreSQL to accept network connections; this behavior is configured in <tt>postgresql.conf</tt>.</p>

<ol>
	<li>Open <tt>postgresql.conf</tt>.</li>
	<li>To configure PostgreSQL to listen on all network interfaces, uncomment the listen address entry and change its value as shown below.
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">listen_addresses = '*'</pre>
		</div>
</div></div></li>
</ol>


<h1><a name="SetUpHypericDatabase-ConfigureClientAuthentication"></a>Configure Client Authentication</h1>


<p>PostgreSQL client authentication is defined in the <tt>pg_hba.conf</tt> file, which contains lines, referred to as records, that specify allowed connection types, users, client IP addresses, and authentication method. Locate this line in the file:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false"># TYPE  DATABASE USER  CIDR-ADDRESS AUTH-METHOD</pre>
		</div>
</div></div>
<p>and add these lines below it:</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">local   all      all   ident           sameuser
host    all      all *192.168.1.6/32* password</pre>
		</div>
</div></div>
<p>For more information about <tt>pg_hba.conf</tt> see <a href="http://www.postgresql.org/docs/8.2/interactive/auth-pg-hba-conf.html">http://www.postgresql.org/docs/8.2/interactive/auth-pg-hba-conf.html</a></p>

<h1><a name="SetUpHypericDatabase-InstallPostgreSQLClientontheHypericServerHost"></a>Install PostgreSQL Client on the Hyperic Server Host</h1>

<p>Install the PostgreSQL client so that you can verify connectivity between the server and the database. To install the client, enter these commands:</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">yum -y install postgresql
psql -d postgres -h 192.168.1.4 -U admin -W</pre>
		</div>
</div></div>

<p>After you verify the connection, you can remove the PostgreSQL client with this command:</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">yum -y remove postgresql</pre>
		</div>
</div></div>


<h2><a name="SetUpHypericDatabase-InstalltheHypericServer"></a>Install the Hyperic Server</h2>

<p>Install the Hyperic Server. For instructions, see <a href="Hyperic Installation and Startup Process.html#HypericInstallationandStartupProcess-SetUpServer">Step 3 - Set Up Hyperic Server</a> of the <a href="Hyperic Installation and Startup Process.html" title="Hyperic Installation and Startup Process">Hyperic Installation and Startup Process</a>.</p>

<div class='panelMacro'><table class='tipMacro'><colgroup><col width='24'><col></colgroup><tr><td valign='top'><img src="images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td><b>Don't start up the server yet</b><br />Do not start the Hyperic Server until after completing the steps in the following section.</td></tr></table></div>

<h2><a name="SetUpHypericDatabase-StartHypericServer"></a>Start Hyperic Server</h2>

<p>Start the Hyperic Server. For instructions, see the <a href="Hyperic Installation and Startup Process.html#HypericInstallationandStartupProcess-StartServer">"Start the Hyperic Server" step</a> of the <a href="Hyperic Installation and Startup Process.html" title="Hyperic Installation and Startup Process">Hyperic Installation and Startup Process</a>.</p>

<p>If the server fails to start up, there may be problems with your PostgreSQL configuration. Check the PostgreSQL logs for  connection failures or errors.</p>

<h1><a name="SetUpHypericDatabase-TroubleshootPostgreSQLConnectionProblems"></a>Troubleshoot PostgreSQL Connection Problems</h1>

<p>If network connections to the database fail, you can troubleshoot the issue in PostgreSQL log files, using the UNIX® <tt>tail</tt> command with the <tt>-f</tt> parameter</p>

<p><tt>tail -f</tt> displays the lines at the end of a file, and displays additional log messages that follow to the terminal. This is useful for watching log files, or any other file which may be appended over time. Failed connection messages are written to the following files:.</p>

<ul>
	<li><tt>/var/lib/pgsql/data/pg_log/postgresql-day.log</tt></li>
	<li><tt>/var/lib/pgsql/pgstartup.log</tt></li>
</ul>


<h1><a name="SetUpHypericDatabase-UsefulPostgreSQLCommands"></a>Useful PostgreSQL Commands</h1>

<p><tt>\h</tt> &#8212; help  with SQL commands<br/>
<tt>&#63;</tt> &#8212; help with psql commands<br/>
<tt>\du</tt> &#8212; list roles/users<br/>
<tt>\l</tt> &#8212; list databases<br/>
<tt>\c</tt> &#8212; to choose a database<br/>
<tt>\d</tt> &#8212; to list tables once in a database<br/>
<tt>\q</tt> &#8212; quit</p>




				    
                    			    </td>
		    </tr>
	    </table>
	    <table border="0" cellpadding="0" cellspacing="0" width="100%">
			<tr>
				<td height="12" background="http://support.hyperic.com/images/border/border_bottom.gif"><img src="images/border/spacer.gif" width="1" height="1" border="0"/></td>
			</tr>
		    <tr>
			    <td align="center"><font color="grey">Document generated by Confluence on Oct 01, 2012 10:06</font></td>
		    </tr>
	    </table>
    </body>
</html>
