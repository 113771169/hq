<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
    <head>
        <title>vFabric Hyperic 4.6.6 : Developing an HQU Plugin</title>
	    <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">	    
    </head>

    <body>
<b><a href="vFabric Hyperic 4.6.6.html" title="vFabric Hyperic 4.6.6 Documentation Home">vFabric Hyperic 4.6.6 Documentation Home (Internal)</a>
 - <a href="https://www.vmware.com/support/pubs/vfabric-hyperic.html">vFabric Hyperic Documentation Home (Online)</a>
 -  <a href="https://www.vmware.com/support/vfabric-hyperic/doc/vfabric-hyperic-rn-4.6.6.html">Hyperic 4.6.6 Release Notes</a> </b>
 <p>
 <p>
	    <table class="pagecontent" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#ffffff">
		    <tr>
			    <td valign="top" class="pagebody">
				    <div class="pageheader">
					    <span class="pagetitle">
                            vFabric Hyperic 4.6.6 : Developing an HQU Plugin
                                                    </span>
				    </div>
				    <div class="pagesubheading">
					    This page last changed on Jan 04, 2012 by <font color="#0050B2">mmcgarry</font>.
				    </div>

				    <style type='text/css'>/*<![CDATA[*/
div.rbtoc1325699463039 {margin-left: 1.5em;padding: 0px;}
div.rbtoc1325699463039 ul {list-style: disc;margin-left: 0px;padding-left: 20px;}
div.rbtoc1325699463039 li {margin-left: 0px;padding-left: 0px;}

/*]]>*/</style><div class='rbtoc1325699463039'>
<ul>
    <li><a href='#DevelopinganHQUPlugin-Step1CreatePluginScaffolding'>Step 1 - Create Plugin Scaffolding</a></li>
<ul>
    <li><a href='#DevelopinganHQUPlugin-ScaffoldingSyntaxandArguments'>Scaffolding Syntax and Arguments</a></li>
    <li><a href='#DevelopinganHQUPlugin-FilesandDirectoriesCreatedbyScaffoldingTask'>Files and Directories Created by Scaffolding Task</a></li>
    <li><a href='#DevelopinganHQUPlugin-ContentsoftheGeneratedPluginFiles'>Contents of the Generated Plugin Files</a></li>
</ul>
    <li><a href='#DevelopinganHQUPlugin-Step2BuildthePlugin'>Step 2 - Build the Plugin</a></li>
    <li><a href='#DevelopinganHQUPlugin-Step3DeployandRunthePlugin'>Step 3 - Deploy and Run the Plugin</a></li>
    <li><a href='#DevelopinganHQUPlugin-Step4SetLocationPropertiesforaViewPlugin'>Step 4 - Set Location Properties for a View Plugin</a></li>
<ul>
    <li><a href='#DevelopinganHQUPlugin-ExcerptfromPlugin.groovyasCreated'>Excerpt from Plugin.groovy as Created</a></li>
    <li><a href='#DevelopinganHQUPlugin-UnderstandingAttachmentPropertiesandOptions'>Understanding Attachment Properties and Options</a></li>
    <li><a href='#DevelopinganHQUPlugin-SpecifyViewLocationinPlugin.groovy'>Specify View Location in Plugin.groovy</a></li>
<ul>
    <li><a href='#DevelopinganHQUPlugin-AttachPlugintoaMastheadMenu'>Attach Plugin to a Masthead Menu</a></li>
    <li><a href='#DevelopinganHQUPlugin-AttachPlugintoAdministrationPage'>Attach Plugin to Administration Page</a></li>
    <li><a href='#DevelopinganHQUPlugin-AttachPlugintoResource%3EViewpage'>Attach Plugin to Resource&gt;View page</a></li>
</ul>
    <li><a href='#DevelopinganHQUPlugin-DetachingandRemovingHQUPlugins'>Detaching and Removing HQU Plugins</a></li>
</ul>
    <li><a href='#DevelopinganHQUPlugin-Step4ProgramthePluginBehavior'>Step 4 - Program the Plugin Behavior</a></li>
    <li><a href='#DevelopinganHQUPlugin-Step5LocalizethePlugin'>Step 5 - Localize the Plugin</a></li>
<ul>
    <li><a href='#DevelopinganHQUPlugin-ContentsoftheI18nPropertiesasCreated'>Contents of the I18n Properties as Created</a></li>
    <li><a href='#DevelopinganHQUPlugin-UnderstandingHowPluginViewsObtainLocalizationStrings'>Understanding How Plugin Views Obtain Localization Strings</a></li>
</ul>
</ul></div>

<p>This section has instructions for the key steps in developing an HQU plugin.  </p>

<h1><a name="DevelopinganHQUPlugin-Step1CreatePluginScaffolding"></a>Step 1 - Create Plugin Scaffolding</h1>

<p>You must have access to Hyperic source code to run the scaffolding task.</p>

<p>Generate the directory structure and the required component files for the plugin using the scaffold maven archetype in the hq source directory.</p>

<h2><a name="DevelopinganHQUPlugin-ScaffoldingSyntaxandArguments"></a>Scaffolding Syntax and Arguments </h2>

<p>To generate a new plugin using the scaffold archetype:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">$ cd hq-uiplugin
$ mvn archetype:update-local-catalog
$ mvn archetype:generate -DarchetypeCatalog=local
[INFO] No archetype defined. Using maven-archetype-quickstart (org.apache.maven.archetypes:maven-archetype-quickstart:1.0)
Choose archetype:
1: local -&gt; scaffold-archetype (scaffold-archetype)
Choose a number: : 1
Define value for property 'groupId': : org.myco
Define value for property 'artifactId': : cool
Define value for property 'version': 1.0-SNAPSHOT: 
Define value for property 'package': org.myco
Define value for property 'controller': : Freezer
Define value for property 'controllerDir': : freezer
Confirm properties configuration:
groupId: org.myco
artifactId: cool
version: 1.0-SNAPSHOT
package: org.myco
controller: Freezer
controllerDir: freezer
Y: Y</pre>
		</div>
</div></div>

<p>The table below defines the properties you supply when you run the scaffolding task.</p>

<div class='table-wrap'>
<table class='confluenceTable'><tbody>
<tr>
<th class='confluenceTh'>Properties</th>
<th class='confluenceTh'> Description</th>
</tr>
<tr>
<td class='confluenceTd'> <tt>groupId</tt></td>
<td class='confluenceTd'> The group ID used in the generated <tt>pom.xml</tt> of of the plugin.</td>
</tr>
<tr>
<td class='confluenceTd'> <tt>artifactId</tt> </td>
<td class='confluenceTd'> The name of the plugin; the string you supply will be the name of the plugin's root directory. Supply a lower case string.</td>
</tr>
<tr>
<td class='confluenceTd'> <tt>version</tt></td>
<td class='confluenceTd'> The plugin version</td>
</tr>
<tr>
<td class='confluenceTd'> <tt>package</tt></td>
<td class='confluenceTd'> The base package structure for generated controllers</td>
</tr>
<tr>
<td class='confluenceTd'> <tt>controller</tt></td>
<td class='confluenceTd'> The name of the controller for which the scaffolding will create a controller file.  The task will create a controller file, whose name is the string "Controller" concatenated with <em>Controller_Name</em>, as in: <tt>Controller_NameController.groovy</tt>.  Supply a value with leading character in upper case.</td>
</tr>
<tr>
<td class='confluenceTd'> <tt>controllerDir</tt></td>
<td class='confluenceTd'>The name of the directory that contains views for <em>Controller_Name</em>;  the string you supply will be the name of the directory in which views are created. Supply a lower case string.</td>
</tr>
</tbody></table>
</div>


<h2><a name="DevelopinganHQUPlugin-FilesandDirectoriesCreatedbyScaffoldingTask"></a>Files and Directories Created by Scaffolding Task</h2>
<p>The scaffold task creates the directory structure and files shown below in the <tt>hq-uiplugin</tt> directory of the source tree.</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">pluginname

/* 
where "pluginname" is the value of "artifactID" 
*/

     src/main/groovy/
           Plugin.groovy
           app/
                ControllerNameController.groovy
                /* 
                where "ControlName" is the value of "controller"
                */
           src/main/resources
                plugin.properties
                views/
                     controller_views/
                          index.gsp
                etc/
                     pluginname_i18n.properties
                     /* 
                     where "pluginname" is the value of "artifactID" 
                     */</pre>
		</div>
</div></div>

<p>The maven target creates a single controller file and the default view generated by that controller, index.gsp.  Note that if your requirements dictate, a single controller can render multiple views.  To accomplish this, you would add an additional action that renders the other view to the controller.   </p>

<p>Note also that a plugin can have multiple controllers.  To accomplish this, you would write an additional controller and put it in the /app directory, and add a subdirectory  for that controller's views under the /app directory. </p>

<h2><a name="DevelopinganHQUPlugin-ContentsoftheGeneratedPluginFiles"></a>Contents of the Generated Plugin Files  </h2>
<p>The plugin files that are created are a starting point for the plugin development process.  The newly created plugin is functional, to the extent that you can invoke it and see it render a view to the browser. In following steps, you edit the plugin files to define its behavior.  </p>

<p>The table below describes the contents of the  plugin files upon creation. 
<br class="atl-forced-newline" /></p>
<div class='table-wrap'>
<table class='confluenceTable'><tbody>
<tr>
<td class='confluenceTd'><b>Plugin File</b> </td>
<td class='confluenceTd'><b>Contents When Created</b></td>
</tr>
<tr>
<td class='confluenceTd'>Plugin.groovy</td>
<td class='confluenceTd'>Imports the plugin controller file; contains commented out property definitions for attaching the plugin to the HQ Portal.</td>
</tr>
<tr>
<td class='confluenceTd'>plugin.properties</td>
<td class='confluenceTd'>Sets the property values for plugin name, help tag, and version information.</td>
</tr>
<tr>
<td class='confluenceTd'>AlertController.groovy</td>
<td class='confluenceTd'>Imports BaseController.groovy; limits access to users with Super User role, and contains a sample action (method), called "index", and shows usage of the render method to render  the plugin name and user name. </td>
</tr>
<tr>
<td class='confluenceTd'>index.gsp</td>
<td class='confluenceTd'>Contains sample text for the view, and shows the use of variables.</td>
</tr>
<tr>
<td class='confluenceTd'>joesalertcenter_i18n.properties</td>
<td class='confluenceTd'>Example usage of the the property that contains the plugin description, and a localization string.</td>
</tr>
</tbody></table>
</div>

<p><br class="atl-forced-newline" /></p>
<h1><a name="DevelopinganHQUPlugin-Step2BuildthePlugin"></a>Step 2 - Build the Plugin</h1>
<p><a name="DevelopinganHQUPlugin-Step2"></a></p>

<p>You should now be able to package your new plugin for deployment to HQ:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">$ cd hq-uiplugin/_plugin_name_
$ mvn clean assembly:directory</pre>
		</div>
</div></div>

<h1><a name="DevelopinganHQUPlugin-Step3DeployandRunthePlugin"></a>Step 3 - Deploy and Run the Plugin </h1>

<p><a name="DevelopinganHQUPlugin-Step3"></a></p>

<p>To deploy the plugin:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">$ cd hq-uiplugin/_plugin_name_
$ cp -r target/plugin_name-VERSION-server/plugin_name/* TOMCAT_HOME/webapps/ROOT/hqu/plugin_name</pre>
		</div>
</div></div>

<p><b>NOTE: To hot deploy updates to the plugin, remove the plugin folder completely from the hqu folder to undeploy and then paste the updated folder back in to redeploy.</b></p>

<p>To invoke the plugin from a browser:</p>
<div class="preformatted panel" style="border-width: 1px;"><div class="preformattedContent panelContent">
<pre>http://localhost:7080/hqu/plugin_name/Controller_Name/index.hqu 
</pre>
</div></div>

<p>For example, given the values used for <em>plugin_name</em> and <em>Controller_Name</em> in the example task execution above: </p>
<div class="preformatted panel" style="border-width: 1px;"><div class="preformattedContent panelContent">
<pre>http://localhost:7080/hqu/joesalertcenter/Alert/index.hqu 
</pre>
</div></div>
<p>When you invoke the plugin, its default action "index" is executed.</p>

<h1><a name="DevelopinganHQUPlugin-Step4SetLocationPropertiesforaViewPlugin"></a>Step 4 - Set Location Properties for a View Plugin</h1>

<p>In this step, you define how the plugin attaches to the HQ Portal, and the controller and action that will be invoked when the plugin is run. This behavior is defined in Plugin.groovy. If you do not wish to attach the plugin to the HQ Portal, this step is optional.</p>

<h2><a name="DevelopinganHQUPlugin-ExcerptfromPlugin.groovyasCreated"></a>Excerpt from Plugin.groovy as Created </h2>
<p>This is the portion of Plugin.groovy you edit:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">/*
        addView(description:  'A Groovy HQU-_plugin_name_',
                attachType:   'masthead', 
                controller:   _Controller_Name_Controller,
                action:       'index', 
                category:     'tracker')
         */
    }
}</pre>
		</div>
</div></div>

<h2><a name="DevelopinganHQUPlugin-UnderstandingAttachmentPropertiesandOptions"></a>Understanding Attachment Properties and Options</h2>

<p>This table defines the properties defined in <tt>Plugin.groovy</tt> that govern plugin attachment and invocation behavior.
<br class="atl-forced-newline" /></p>
<div class='table-wrap'>
<table class='confluenceTable'><tbody>
<tr>
<th class='confluenceTh'>Property</th>
<th class='confluenceTh'>Behavior and Options</th>
<th class='confluenceTh'>Default </th>
</tr>
<tr>
<td class='confluenceTd'>description</td>
<td class='confluenceTd'>Brief description of the view displayed as the View title in the Portal.</td>
<td class='confluenceTd'>'A Groovy HQU-plugin_name'</td>
</tr>
<tr>
<td class='confluenceTd'>attachType</td>
<td class='confluenceTd'>Specifies where the plugin will be attached.  <br class="atl-forced-newline" />
'masthead'—attach to a menu on the Portal masthead.  <br class="atl-forced-newline" />
'admin'—attach to Administration page. <br class="atl-forced-newline" />
'resource'—attach to View page of a Resource. </td>
<td class='confluenceTd'>'masthead'  <br class="atl-forced-newline" />
 <br class="atl-forced-newline" />  </td>
</tr>
<tr>
<td class='confluenceTd'>resourceType </td>
<td class='confluenceTd'>If attachType  is set to 'resource' use this property to identify the type of the resource whose <b>View</b> page should show the plugin. </td>
<td class='confluenceTd'>The Plugin.groovy file generated by the scaffolding does not contain this property, you must add it yourself to use it.  </td>
</tr>
<tr>
<td class='confluenceTd'>controller</td>
<td class='confluenceTd'>Specifies the filename of the plugin controller to invoke when the the plugin is run.</td>
<td class='confluenceTd'>Specifies the controller file created by the scaffolding process.  </td>
</tr>
<tr>
<td class='confluenceTd'>action </td>
<td class='confluenceTd'>The method, in the controller file specified by the controller property, to invoke when the plugin is run. If you change the value of action, remember that each action defined must have a similarly named .gsp file in views/<em>controller_views.</em></td>
<td class='confluenceTd'>Specifies the sample index ()method contained in the controller file.  </td>
</tr>
<tr>
<td class='confluenceTd'>category</td>
<td class='confluenceTd'>Defines the view plugin's Portal attachment point, when attachType  is 'masthead'. It may be defined as:  <br class="atl-forced-newline" />
'tracker'——plugin will appear on Analyze menu. <br class="atl-forced-newline" />
'resource'—plugin will appear on Resources menu. <br class="atl-forced-newline" />
(blank)—set to blank unless the attachType  is 'masthead'.</td>
<td class='confluenceTd'>'tracker' <br class="atl-forced-newline" />  </td>
</tr>
</tbody></table>
</div>


<h2><a name="DevelopinganHQUPlugin-SpecifyViewLocationinPlugin.groovy"></a>Specify View Location in Plugin.groovy </h2>

<p>Uncomment the addView method in Plugin.groovy.</p>

<h3><a name="DevelopinganHQUPlugin-AttachPlugintoaMastheadMenu"></a>Attach Plugin to a Masthead Menu </h3>

<ol>
	<li>Leave the  attachType property set to 'masthead'.</li>
	<li>Set the  category property to blank.</li>
	<li>Edit the values of description, controller, and action, as desired.</li>
</ol>


<h3><a name="DevelopinganHQUPlugin-AttachPlugintoAdministrationPage"></a>Attach Plugin to Administration Page</h3>

<ol>
	<li>Set the value of attachType property set to 'admin'.</li>
	<li>Set the  category property blank.</li>
	<li>Edit the values of description, controller, and action, as desired.</li>
</ol>


<h3><a name="DevelopinganHQUPlugin-AttachPlugintoResource%3EViewpage"></a>Attach Plugin to Resource&gt;View page </h3>

<p>To add an item to the 'Views' tab of a resource, and gain access to resource context, you can attach a view to a resource type:</p>
<ol>
	<li>Set the value of attachType property set to 'resource'.</li>
	<li>Set the  category property blank.</li>
	<li>Add, and set the resourceType property to a valid Resource type, enclosed in single quotes and square brackets, for instance  ['Linux'].</li>
	<li>Edit the values of description, controller, and action, as desired.</li>
</ol>


<h2><a name="DevelopinganHQUPlugin-DetachingandRemovingHQUPlugins"></a>Detaching and Removing HQU Plugins</h2>

<p>HQ has a built-in HQU plugin, called Plugin Mon, for managing other HQU plugins.  To detach plugin views and remove a plugin from the database, use Administration -&gt; HQU Plugin Management.</p>

<h1><a name="DevelopinganHQUPlugin-Step4ProgramthePluginBehavior"></a>Step 4 - Program the Plugin Behavior </h1>

<p>The real work of developing an HQU plugin is defining its behavior, in the plugin controller file.  For controller development topics, see <a href="Writing Plugin Controller Logic.html" title="Writing Plugin Controller Logic">Writing Plugin Controller Logic</a>.</p>

<h1><a name="DevelopinganHQUPlugin-Step5LocalizethePlugin"></a>Step 5 - Localize the Plugin </h1>

<p>HQU supports the I18N internationalization model. The scaffolding tool creates a PropertyResourceBundle file for localization strings properties, <tt>plugin_name_i18n.properties</tt> in <tt>/ui_plugins/{plugin/etc</tt>.</p>


<h2><a name="DevelopinganHQUPlugin-ContentsoftheI18nPropertiesasCreated"></a>Contents of  the I18n Properties as Created</h2>

<p>Upon creation <tt>plugin_name_i18n.properties</tt> contains two key-value pairs.<br/>
plugin_name.description=[new plugin]  plugin_name<br/>
Congrats=Congratulations
<br class="atl-forced-newline" />
The first line defines the link name for plugins attached to the portal, where:</p>
<ul>
	<li><em>plugin_name</em>  is the name you assigned to the plugin when running the scaffolding task.</li>
	<li>new plugin is an arbitrary string that will be prefixed to <em>plugin_name</em></li>
</ul>


<p>The menu item the is created is: <br/>
new plugin <em>plugin_name</em><br/>
The second line defines the string to present in Views for the text item whose key is Congrats.</p>

<h2><a name="DevelopinganHQUPlugin-UnderstandingHowPluginViewsObtainLocalizationStrings"></a>Understanding How Plugin Views Obtain Localization Strings </h2>

<p>A special variable in the .gsp rendered for an action allows it to obtain localized resource bundles from  <tt>etc/myplugin_i18n.properties</tt>. The variable, a lower-case letter 'l', is of the type 'BundleMapFacade' which provides a map-like facade, allowing you to access resource bundle attributes like regular Map entries. For example, in a line from a <tt>.gsp</tt>, in either of these forms:</p>
<div class="preformatted panel" style="border-width: 1px;"><div class="preformattedContent panelContent">
<pre>${l.Congrats} </pre>
</div></div>
<div class="preformatted panel" style="border-width: 1px;"><div class="preformattedContent panelContent">
<pre>$l['Congrats'] </pre>
</div></div>
<p>The variable <tt>l.Congrats</tt> points at <tt>etc/myplugin_i18n.properties:Congrats</tt><br/>
For information about how a plugin controller can obtain localized resource bundles, see <a href="Writing Plugin Controller Logic.html#WritingPluginControllerLogic-LocalizedResourceBundles">Obtaining Localized Strings</a>.</p>

				    
                    			    </td>
		    </tr>
	    </table>
	    <table border="0" cellpadding="0" cellspacing="0" width="100%">
			<tr>
				<td height="12" background="http://support.hyperic.com/images/border/border_bottom.gif"><img src="images/border/spacer.gif" width="1" height="1" border="0"/></td>
			</tr>
		    <tr>
			    <td align="center"><font color="grey">Document generated by Confluence on Jun 01, 2012 08:28</font></td>
		    </tr>
	    </table>
    </body>
</html>
