<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
    <head>
        <title>vFabric Hyperic 5.7 : Upgrade Hyperic Agent</title>
	    <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">	    
    </head>

    <body>
<b><a href="vFabric Hyperic 5.7.html" title="vFabric Hyperic 5.7 Documentation Home">vFabric Hyperic 5.7 Documentation Home (Internal)</a>
 - <a href="https://www.vmware.com/support/pubs/vfabric-hyperic.html">vFabric Hyperic 5.7 Documentation Home (Online)</a>
 -  <a href="https://www.vmware.com/support/vfabric-hyperic/doc/vfabric-hyperic-rn-5.7.html">Hyperic 5.7 Release Notes</a> </b>
 <p>
 <p>
	    <table class="pagecontent" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#ffffff">
		    <tr>
			    <td valign="top" class="pagebody">
				    <div class="pageheader">
					    <span class="pagetitle">
                            vFabric Hyperic 5.7 : Upgrade Hyperic Agent
                                                    </span>
				    </div>
				    <div class="pagesubheading">
					    This page last changed on Oct 24, 2012 by <font color="#0050B2">mmcgarry</font>.
				    </div>

				    <style type='text/css'>/*<![CDATA[*/
div.rbtoc1351121924906 {margin-left: 1.5em;padding: 0px;}
div.rbtoc1351121924906 ul {list-style: disc;margin-left: 0px;padding-left: 20px;}
div.rbtoc1351121924906 li {margin-left: 0px;padding-left: 0px;}

/*]]>*/</style><div class='rbtoc1351121924906'>
<ul>
    <li><a href='#UpgradeHypericAgent-AgentUpgradeMethods'>Agent Upgrade Methods</a></li>
    <li><a href='#UpgradeHypericAgent-PushAgentBundlefromthevFabricHypericServer'>Push Agent Bundle from the vFabric Hyperic Server</a></li>
    <li><a href='#UpgradeHypericAgent-UpgradeAgentBundleManually'>Upgrade Agent Bundle Manually</a></li>
    <li><a href='#UpgradeHypericAgent-CreateaCustomAgentUpgradeBundle'>Create a Custom Agent Upgrade Bundle</a></li>
    <li><a href='#UpgradeHypericAgent-UpgradeAgentUsingaFullAgentPackage'>Upgrade Agent Using a Full Agent Package</a></li>
</ul></div>

<blockquote>
<p><b>About this page...</b> </p>

<p>This page has instructions for upgrading the Hyperic Agent to 5.0. Before performing the steps on this page, see <a href="Hyperic Upgrade Processes.html" title="Hyperic Upgrade Processes">Hyperic Upgrade Processes</a> for information about upgrade options and other steps in the upgrade process. </p>

<p>If you want to configure your 5.0 agents for a user-managed keystore, see the information in the <a href="Hyperic Upgrade Processes.html#HypericUpgradeProcesses-UpgradeWithTrust">Upgrade Server and Agent with User-Managed Keystores</a> section of <a href="Hyperic Upgrade Processes.html" title="Hyperic Upgrade Processes">Hyperic Upgrade Processes</a>. </p></blockquote> 

<h1><a name="UpgradeHypericAgent-AgentUpgradeMethods"></a>Agent Upgrade Methods</h1>

<p>To upgrade a Hyperic 4.x Agent to 5.0 you can either:</p>

<ul>
	<li>Install just the 5.0 agent bundle, by pushing it from your upgraded Hyperic 5.7 Server to each agent (in vFabric Hyperic only) as described in <a href="#UpgradeHypericAgent-PushAgentBundlefromthevFabricHypericServer">Push Agent Bundle from the vFabric Hyperic Server</a>, or by manually copying the bundle to each agent as described in <a href="#UpgradeHypericAgent-UpgradeAgentBundleManually">Upgrade Agent Bundle Manually</a>. If desired, you can first create your own agent bundle, as described in <a href="#UpgradeHypericAgent-CreateaCustomAgentUpgradeBundle">Create a Custom Agent Upgrade Bundle</a>.</li>
</ul>


<ul>
	<li>Install complete 5.0 agent package, as described in <a href="#UpgradeHypericAgent-UpgradeAgentUsingaFullAgentPackage">Upgrade Agent Using a Full Agent Package</a>.</li>
</ul>


<p><a name="UpgradeHypericAgent-PushBundle"></a></p>
<h1><a name="UpgradeHypericAgent-PushAgentBundlefromthevFabricHypericServer"></a>Push Agent Bundle from the vFabric Hyperic Server</h1>
<p><b>Available only in <font color="red">vFabric Hyperic</font></b></p>

<p>You can update one or more Hyperic Agents by pushing the new bundle to it from the Hyperic Server, using the Hyperic user interface. The bundle must reside in the <tt>ServerHome/hq-engine/hq-server/webapps/ROOT/WEB-INF/hq-agent-bundles</tt> directory.</p>

<p>The agent upgrade command is available on the <b>Views</b> tab for an Hyperic Agent (or a group of agents). For more information see <a href="Start, Stop, and Other Agent Operations.html" title="Start, Stop, and Other Agent Operations">Start, Stop, and Other Agent Operations</a> in <em>vFabric Hyperic Configuration</em>.</p>

<p><b>Note:</b> When you update an agent bundle, the configuration settings in the agent's <tt>AgentHome/conf/agent.properties</tt> file are not changed. However, the first time you start an agent that you have updated from 4.5 or earlier, passwords specified in the file will be encrypted.  </p>

<div class='panelMacro'><table class='tipMacro'><colgroup><col width='24'><col></colgroup><tr><td valign='top'><img src="images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td><b>Agent Name Unchanged by Bundle Upgrade Process</b><br />Note that if you upgrade a pre-4.6 agent by pushing a new bundle from the Hyperic Server, the name of the agent is not changed. So, an agent name that contains the Hyperic version number &#8212; as is the default naming convention &#8212; reflects the originally installed version, rather than the version to which it has been upgraded. For example, if you push a 5.0 bundle to an agent whose name is "HQ Agent 4.5", the agent name will remain "HQ Agent 4.5".</td></tr></table></div>


<h1><a name="UpgradeHypericAgent-UpgradeAgentBundleManually"></a>Upgrade Agent Bundle Manually</h1>

<p>Follow these steps if you wish to manually upgrade the agent bundle in your agent installation, instead of pushing the bundle from the Hyperic Server.</p>

<p><b>Note:</b> When you update an agent bundle, your previous agent configuration is preserved &#8212; the <tt>AgentHome/conf/agent.properties</tt> file is not overwritten.</p>

<ol>
	<li>Copy the agent bundle (agent-5.x.y-nnn.tgz or agent-5.x.y-nnn.zip) from<br/>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">ServerHome/hq-engine/hq-server/webapps/ROOT/WEB-INF/hq-agent-bundles</pre>
		</div>
</div></div>to
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">AgentHome/bundles</pre>
		</div>
</div></div></li>
	<li>Unpack the agent bundle.</li>
	<li>Edit the <tt>rollback.properties</tt> file in <tt>AgentHome/conf</tt> to specify the location of the new agent bundle and the bundle it will supersede.
<div class='table-wrap'>
<table class='confluenceTable'><tbody>
<tr>
<th class='confluenceTh'> Property </th>
<th class='confluenceTh'> Description </th>
<th class='confluenceTh'> Example </th>
</tr>
<tr>
<td class='confluenceTd'> HQ_AGENT_BUNDLE </td>
<td class='confluenceTd'> Name of directory with the new bundle, without full path specification. </td>
<td class='confluenceTd'> agent-5.x.y-EE-nnn </td>
</tr>
<tr>
<td class='confluenceTd'> HQ_AGENT&#95; <br class="atl-forced-newline" />
ROLLBACK_BUNDLE </td>
<td class='confluenceTd'> Name of directory with the old bundle (the one you are upgrading from), without full path specification. </td>
<td class='confluenceTd'> agent-4.5.0-EE-nnn </td>
</tr>
</tbody></table>
</div>
</li>
	<li>Restart the agent. For instructions, see <a href="Start, Stop, and Other Agent Operations.html" title="Start, Stop, and Other Agent Operations">Start, Stop, and Other Agent Operations</a> in <em>vFabric Hyperic Configuration</em>.</li>
</ol>


<p>If the upgrade to the new agent bundle fails, an attempt will be made to start the agent using the old agent bundle.</p>

<p>You can determine whether the upgrade was successful and what version you are running by looking at the log files in AgentHome/logs.</p>

<h1><a name="UpgradeHypericAgent-CreateaCustomAgentUpgradeBundle"></a>Create a Custom Agent Upgrade Bundle</h1>
<p><a name="UpgradeHypericAgent-CustomBundle"></a></p>

<p>This section describes how to create a custom agent bundle. Pre-configuring the agent eases the process of upgrading multiple agents. For additional information, see <a href="Install Hyperic Agents in Volume.html" title="Install Hyperic Agents in Volume">Install Hyperic Agents in Volume</a>.</p>

<ol>
	<li>Back up an existing agent located in:
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">ServerHome/hq-engine/hq-server/webapps/ROOT/WEB-INF/hq-agent-bundles</pre>
		</div>
</div></div>
	<ul>
		<li>For example:
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">cp ServerHome/hq-engine/hq-server/webapps/ROOT/WEB-INF/hq-agent-bundles/agent-4.5.0-EE-nnn.tgz
ServerHome/hq-engine/hq-server/webapps/ROOT/WEB-INF/hq-agent-bundles/agent-4.5.0-EE-nnn.tgz.bak</pre>
		</div>
</div></div></li>
	</ul>
	</li>
	<li>Extract the bundle. For example:
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">tar xzf ServerHome/hq-engine/hq-server/webapps/ROOT/WEB-INF/hq-agent-bundles/agent-4.5.0-EE-nnn.tgz</pre>
		</div>
</div></div>
	<ul>
		<li>This results in a new directory corresponding to the agent bundle, like this:
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">ServerHome/hq-engine/hq-server/webapps/ROOT/WEB-INF/hq-agent-bundles/agent-4.5.0-EE-nnn</pre>
		</div>
</div></div></li>
	</ul>
	</li>
	<li>Update the contents of expanded directory. For instance, you could add custom plugins to the plugins directory:
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">ServerHome/hq-engine/hq-server/webapps/ROOT/WEB-INF/hq-agent-bundles/agent-4.5.0-EE-nnn/pdk/plugins</pre>
		</div>
</div></div></li>
	<li>Rename expanded directory to the name of custom agent bundle. For example:
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">mv ServerHome/hq-engine/hq-server/webapps/ROOT/WEB-INF/hq-agent-bundles/agent-4.5.0-EE-nnn
ServerHome/hq-engine/hq-server/webapps/ROOT/WEB-INF/hq-agent-bundles/my-bundle</pre>
		</div>
</div></div></li>
	<li>Pack up agent bundle, using the directory name from from the previous step as the tarball file name. For example:
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">tar cvf ServerHome/hq-engine/hq-server/webapps/ROOT/WEB-INF/hq-agent-bundles/my-bundle.tar
ServerHome/hq-engine/hq-server/webapps/ROOT/WEB-INF/hq-agent-bundles/my-bundle;
gzip ServerHome/hq-engine/hq-server/webapps/ROOT/WEB-INF/hq-agent-bundles/my-bundle</pre>
		</div>
</div></div></li>
</ol>


<h1><a name="UpgradeHypericAgent-UpgradeAgentUsingaFullAgentPackage"></a>Upgrade Agent Using a Full Agent Package</h1>

<p>These instructions apply to both Hyperic HQ and vFabric Hyperic. </p>

<p>To upgrade an Hyperic 4.x Agent using full the agent package:</p>
<ol>
	<li>Stop the 4.x agent.</li>
	<li>Preserve the existing agent configuration.
	<ul>
		<li>Back up the <tt>agent.properties</tt> file from your previous installation. The default location for <tt>agent.properties</tt> in 4.x installations is the <tt>AgentHome/conf</tt> directory.</li>
		<li>Note: In some Hyperic environments, <tt>agent.properties</tt> is stored in an alternative location that eases the process of automating the deployment of multiple agents. On Unix-based platforms, that location is the <tt>.hq</tt> subdirectory of the home directory of the user that runs the Agent. If your agent configuration is stored in that location, it will not be over-written by the new installation.</li>
	</ul>
	</li>
	<li>If the agent runs on Windows, uninstall the agent service from a command shell in <tt>AgentHome/bin</tt>:
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">hq-agent.bat remove</pre>
		</div>
</div></div></li>
	<li>Unpack the 5.0 agent into the agent installation directory.</li>
	<li>Restore the backed up <tt>agent.properties</tt> file to <tt>AgentHome/conf</tt> (unless you keep the properties file in the <tt>.hq</tt> subdirectory of the home directory of the user that runs the agent.)</li>
	<li>Start the Hyperic Agent
	<ul>
		<li>On Unix-like platforms, enter this command in a shell:
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">sh hq-agent.sh start</pre>
		</div>
</div></div></li>
		<li>On Windows, install the new agent service and start the agent. In a command shell in <tt>AgentHome/bin</tt> enter:
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">hq-agent.bat install
hq-agent.bat start</pre>
		</div>
</div></div></li>
	</ul>
	</li>
</ol>





				    
                    			    </td>
		    </tr>
	    </table>
	    <table border="0" cellpadding="0" cellspacing="0" width="100%">
			<tr>
				<td height="12" background="http://support.hyperic.com/images/border/border_bottom.gif"><img src="images/border/spacer.gif" width="1" height="1" border="0"/></td>
			</tr>
		    <tr>
			    <td align="center"><font color="grey">Document generated by Confluence on Oct 29, 2012 13:00</font></td>
		    </tr>
	    </table>
    </body>
</html>
