<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
    <head>
        <title>vFabric Hyperic 4.6.6 : Set Up Alert Action Script</title>
	    <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">	    
    </head>

    <body>
<b><a href="vFabric Hyperic 4.6.6.html" title="vFabric Hyperic 4.6.6 Documentation Home">vFabric Hyperic 4.6.6 Documentation Home (Internal)</a>
 - <a href="https://www.vmware.com/support/pubs/vfabric-hyperic.html">vFabric Hyperic Documentation Home (Online)</a>
 -  <a href="https://www.vmware.com/support/vfabric-hyperic/doc/vfabric-hyperic-rn-4.6.6.html">Hyperic 4.6.6 Release Notes</a> </b>
 <p>
 <p>
	    <table class="pagecontent" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#ffffff">
		    <tr>
			    <td valign="top" class="pagebody">
				    <div class="pageheader">
					    <span class="pagetitle">
                            vFabric Hyperic 4.6.6 : Set Up Alert Action Script
                                                    </span>
				    </div>
				    <div class="pagesubheading">
					    This page last changed on Jan 04, 2012 by <font color="#0050B2">mmcgarry</font>.
				    </div>

				    <p><b>Available only in <font color="red">vFabric Hyperic</font></b></p>


<style type='text/css'>/*<![CDATA[*/
div.rbtoc1325699212603 {margin-left: 1.5em;padding: 0px;}
div.rbtoc1325699212603 ul {list-style: disc;margin-left: 0px;padding-left: 20px;}
div.rbtoc1325699212603 li {margin-left: 0px;padding-left: 0px;}

/*]]>*/</style><div class='rbtoc1325699212603'>
<ul>
    <li><a href='#ui-Alert.Script-DefineaScriptActionforanAlert'>Define a Script Action for an Alert</a></li>
    <li><a href='#ui-Alert.Script-EnvironmentVariablesforFiredAlertData'>Environment Variables for Fired Alert Data</a></li>
    <li><a href='#ui-Alert.Script-ExampleScript'>Example Script</a></li>
    <li><a href='#ui-Alert.Script-AssigntheScriptActiontoanAlert'>Assign the Script Action to an Alert</a></li>
</ul></div>

<h1><a name="SetUpAlertActionScript-DefineaScriptActionforanAlert"></a>Define a Script Action for an Alert</h1>

<p>A script action allows you to access and use Hyperic environment variables that contain information about a fired alert. You can use the data in any fashion you wish, for instance in a web service call to external management system.</p>

<p>To use the script action feature, write a script that implements the action or logic you wish to perform with the alert-related environment variables. When you configure the alert, specify the script to be executed when the alert fires. The script is server-side only, meaning it must be accessible and executable by the same user running the HQ Server process.</p>

<div class='panelMacro'><table class='infoMacro'><colgroup><col width='24'><col></colgroup><tr><td valign='top'><img src="images/icons/emoticons/information.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td><b>Agent-side Scripts</b><br />If you wish to execute agent-side scripts, see <a href="Configure a Custom Control Action.html" title="Configure a Custom Control Action">Configure a Custom Control Action</a>.</td></tr></table></div>

<p>Script actions can be defined for resource alerts and resource type alerts. In this version of Hyperic, escalation schemes do not support script actions.</p>

<div class='panelMacro'><table class='tipMacro'><colgroup><col width='24'><col></colgroup><tr><td valign='top'><img src="images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td><b>Script actions are synchronous</b><br />Script actions execute one at a time. Until a script action completes, additional alerts will not fire on the resource.</td></tr></table></div>


<div class='panelMacro'><table class='warningMacro'><colgroup><col width='24'><col></colgroup><tr><td valign='top'><img src="images/icons/emoticons/forbidden.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td><b>Script actions and memory</b><br />Script actions are forked by the the Hyperic Server's Java process. Most operating systems duplicate the Java process's memory before executing the new process; exact behavior varies by operating system. If the operating system does not provide for over-committing memory, script execution requires an amount of free memory equal to the amount of memory that the Hyperic Server's Java process consumes &#8212; otherwise, the script action will not run.</td></tr></table></div>

<h1><a name="SetUpAlertActionScript-EnvironmentVariablesforFiredAlertData"></a>Environment Variables for Fired Alert Data</h1>

<p>The environment variables for fired alert data are prefixed with the string "HYPERIC_". The table below describes the variables.</p>

<div class='table-wrap'>
<table class='confluenceTable'><tbody>
<tr>
<th class='confluenceTh'> Variable </th>
<th class='confluenceTh'> Description </th>
<th class='confluenceTh'> Example Output </th>
</tr>
<tr>
<td class='confluenceTd'> HYPERIC_ALERT_ALERT_TIME </td>
<td class='confluenceTd'> The time at which the&nbsp; alert fired, in milliseconds from epoch. </td>
<td class='confluenceTd'> 1219167000000 </td>
</tr>
<tr>
<td class='confluenceTd'> HYPERIC_ALERT_CONDITION </td>
<td class='confluenceTd'> The condition that caused the alert to fire. Note:&nbsp; This environment variable is supported only on Unix-based platforms. The value contains the Java \n character, which causes errors under Windows. In Windows environments, use the HYPERIC_ALERT_SUMMARY variable, which provides the same information without the \n character. </td>
<td class='confluenceTd'> If Load Average 5 Minutes &gt; 1.0 (actual value = 1.4) </td>
</tr>
<tr>
<td class='confluenceTd'> HYPERIC_ALERT_DESCRIPTION </td>
<td class='confluenceTd'> The description of the alert that fired.&nbsp; <br class="atl-forced-newline" /> </td>
<td class='confluenceTd'> This alert will fire when the load rises </td>
</tr>
<tr>
<td class='confluenceTd'> HYPERIC_ALERT_ID </td>
<td class='confluenceTd'>  <br class="atl-forced-newline" />
<br class="atl-forced-newline" />
The internal Hyperic ID for the alert that fired. <br class="atl-forced-newline" />  <br class="atl-forced-newline" />  <b>Note:</b>&nbsp;The&nbsp;HYPERIC_ALERT_ID for an alert is not committed to the Hyperic database until all alert actions are complete. Therefore, an alert action script (whether it uses SQL or HQApi) cannot query or update the Hyperic database using the alert's&nbsp;HYPERIC_ALERT_ID,&nbsp;because that value will not yet exist in the Hyperic database. </td>
<td class='confluenceTd'>&nbsp;</td>
</tr>
<tr>
<td class='confluenceTd'> HYPERIC_ALERT_NAME </td>
<td class='confluenceTd'> The name of the alert that fired. </td>
<td class='confluenceTd'> High Load </td>
</tr>
<tr>
<td class='confluenceTd'> HYPERIC_ALERT_PRIORITY </td>
<td class='confluenceTd'> The priority of the alert that fired, 1 for High, 2 for Medium, 3 for Low. </td>
<td class='confluenceTd'> 2 </td>
</tr>
<tr>
<td class='confluenceTd'> HYPERIC_ALERT_SUMMARY </td>
<td class='confluenceTd'> A condensed data string that contains the relevant alert and resource names and values which triggered the alert. </td>
<td class='confluenceTd'> Mac OS X DOWN The-Idea-Men Availability (0.0%) </td>
</tr>
<tr>
<td class='confluenceTd'> HYPERIC_FIXED_ALERT_ID </td>
<td class='confluenceTd'> <font color="#0000ff">This variable was added in Hyperic 4.5.1.2.</font> <br class="atl-forced-newline" />
<br class="atl-forced-newline" />
Valid for recovery alerts only. Supplies the internal Hyperic ID for the primary alert to which the recovery alert is assigned. </td>
<td class='confluenceTd'>&nbsp;</td>
</tr>
<tr>
<td class='confluenceTd'> HYPERIC_FIXED_ALERT_NAME </td>
<td class='confluenceTd'> <font color="#0000ff">This variable was added in Hyperic 4.5.1.2.</font> <br class="atl-forced-newline" />
<br class="atl-forced-newline" />
Valid for recovery alerts only. Supplies the name of the primary alert to which the recovery alert is assigned. </td>
<td class='confluenceTd'> High Load </td>
</tr>
<tr>
<td class='confluenceTd'> HYPERIC_PLATFORM_NAME </td>
<td class='confluenceTd'> The platform on which this alert fired. </td>
<td class='confluenceTd'> localhost.hyperic.com </td>
</tr>
<tr>
<td class='confluenceTd'> HYPERIC_RECOVERY_ALERT </td>
<td class='confluenceTd'> A boolean that indicates if the alert is a recovery alert. </td>
<td class='confluenceTd'> false </td>
</tr>
<tr>
<td class='confluenceTd'> HYPERIC_RESOURCE_ID <br class="atl-forced-newline" /> </td>
<td class='confluenceTd'> The internal ID for the resource for which the alert fired. </td>
<td class='confluenceTd'>&nbsp;</td>
</tr>
<tr>
<td class='confluenceTd'> HYPERIC_RESOURCE_NAME </td>
<td class='confluenceTd'> The name of the resource for which the alert fired. </td>
<td class='confluenceTd'> localhost.hyperic.com </td>
</tr>
</tbody></table>
</div>



<h1><a name="SetUpAlertActionScript-ExampleScript"></a>Example Script</h1>

<p>The following script is an example of using the alert variables. The example script simply writes the time that the script executed and the variables to a log file; it is not a representative use case. The purpose of script actions is to enable more complex alert actions, and actions that meet the unique needs of your environment.</p>

<div class="code panel" style="border-width: 1px;"><div class="codeHeader panelHeader" style="border-bottom-width: 1px;"><b>alert.pl</b></div><div class="codeContent panelContent">
<script type="syntaxhighlighter" class="theme: Confluence; brush: java; gutter: false"><![CDATA[#!/usr/bin/perl
my $logfile = "/tmp/output.txt";
my $date = localtime();
open LOGFILE, "&gt;$logfile" or die "Cannot open log file for writing";
print LOGFILE "# Running script at $date", "\n";
foreach $key (sort keys(%ENV)) {
if ($key =~ m/^HYPERIC/) {
my $msg = "$key = $ENV{$key}";
print LOGFILE $msg, "\n";
}
}
close LOGFILE;]]></script>
</div></div>

<h1><a name="SetUpAlertActionScript-AssigntheScriptActiontoanAlert"></a>Assign the Script Action to an Alert</h1>

<p>To assign a script action to an alert definition:</p>
<ol>
	<li>Select the alert definition.</li>
	<li>Click the <b>Script</b> tab in the <b>Alert Definition</b> page.</li>
	<li>Enter the full path to script and click <b>Set</b>.</li>
</ol>




				    
                    			    </td>
		    </tr>
	    </table>
	    <table border="0" cellpadding="0" cellspacing="0" width="100%">
			<tr>
				<td height="12" background="http://support.hyperic.com/images/border/border_bottom.gif"><img src="images/border/spacer.gif" width="1" height="1" border="0"/></td>
			</tr>
		    <tr>
			    <td align="center"><font color="grey">Document generated by Confluence on May 21, 2012 08:34</font></td>
		    </tr>
	    </table>
    </body>
</html>
