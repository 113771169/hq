<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
    <head>
        <title>vFabric Hyperic 4.6.5 : Control Plugin</title>
	    <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">	    
    </head>

    <body>
	    <table class="pagecontent" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#ffffff">
		    <tr>
			    <td valign="top" class="pagebody">
				    <div class="pageheader">
					    <span class="pagetitle">
                            vFabric Hyperic 4.6.5 : Control Plugin
                                                    </span>
				    </div>
				    <div class="pagesubheading">
					    This page last changed on Jan 04, 2012 by <font color="#0050B2">mmcgarry</font>.
				    </div>

				    <h1><a name="ControlPlugin-ControlPlugins"></a>Control Plugins</h1>

<p><font color="gray"><em>Topics marked with</em></font> <font color="red">*</font> <font color="gray"><em>relate to features available only in vFabric Hyperic.</em></font></p>


<p>The ControlPlugin defines control actions and implements the doAction() method used to control resources. Like the <a href="Measurement Plugin.html" title="Measurement Plugin">Measurement Plugin</a>, the method of control is left entirely to the plugin. Support classes are provided to assist with certain types of control:</p>
<ul>
	<li>JDBC</li>
	<li>JMX</li>
	<li>Script Execution</li>
	<li>Windows Service Manager<br class="atl-forced-newline" /></li>
</ul>


<p>Following are some examples of collection methods used by various plugins:</p>
<div class='table-wrap'>
<table class='confluenceTable'><tbody>
<tr>
<th class='confluenceTh'> Collection Method </th>
<th class='confluenceTh'> Plugins that Use It </th>
</tr>
<tr>
<td class='confluenceTd'> JMX </td>
<td class='confluenceTd'> JBoss, WebLogic, WebSphere </td>
</tr>
<tr>
<td class='confluenceTd'> JDBC </td>
<td class='confluenceTd'> Mysql, PostgreSQL </td>
</tr>
<tr>
<td class='confluenceTd'> Script Execution </td>
<td class='confluenceTd'> Apache, Tomcat </td>
</tr>
<tr>
<td class='confluenceTd'> Windows Service Manager </td>
<td class='confluenceTd'> IIS, Apache, Tomcat </td>
</tr>
</tbody></table>
</div>


<p><b><em>Properties</em></b></p>
<div class='table-wrap'>
<table class='confluenceTable'><tbody>
<tr>
<th class='confluenceTh'> Property </th>
<th class='confluenceTh'> Use </th>
</tr>
<tr>
<td class='confluenceTd'> BACKGROUND_COMMAND </td>
<td class='confluenceTd'> background.sh command silently fails when running </td>
<td class='confluenceTd'>&nbsp;</td>
</tr>
<tr>
<td class='confluenceTd'> DEFAULT_PROGRAM </td>
<td class='confluenceTd'> default control program </td>
<td class='confluenceTd'>&nbsp;</td>
</tr>
</tbody></table>
</div>


<h4><a name="ControlPlugin-ScriptExecution"></a>Script Execution</h4>

<div class="code panel" style="border-width: 1px;"><div class="codeHeader panelHeader" style="border-bottom-width: 1px;"><b>Script Execution Plugin</b></div><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">...
&lt;server name="Zope"
          version="2.x"&gt;
...
&lt;!-- Use this helper class --&gt;
 &lt;plugin type="control"
            class="org.hyperic.hq.product.ScriptControlPlugin"/&gt;
...

&lt;!-- default script, visible and configurable in UI --&gt;
&lt;property name="DEFAULT_PROGRAM" value="zopectl"/&gt;
...

&lt;!-- Actions visible in UI--&gt;
 &lt;actions include="start,restart,stop,kill,status,test"/&gt;

...
&lt;/server&gt;</pre>
		</div>
</div></div>

<h4><a name="ControlPlugin-WindowsServiceManager"></a>Windows Service Manager</h4>

<p>Code snippet with the required code to run Control Actions on a Windows Service.<br/>
Always specify the platform (platform="Win32") if you use a common plugin for Unix/Windows platforms.</p>

<div class="code panel" style="border-width: 1px;"><div class="codeHeader panelHeader" style="border-bottom-width: 1px;"><b>Windows Service Manager Control Actions</b></div><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">&lt;!-- Use this helper class for your Control Actions --&gt;
&lt;plugin type="control"
platform="Win32"
        class="org.hyperic.hq.product.Win32ControlPlugin"/&gt;

&lt;!-- Actions are only valid on Windows platforms --&gt;
&lt;actions platform="Win32"
include="start,stop,restart"/&gt;

&lt;!-- Specify service name as a configurable option and setting the default value--&gt;
&lt;config type="control" platform="Win32"&gt;
&lt;option name="service_name"
default="Apache2"
description="Apache Service Name"/&gt;</pre>
		</div>
</div></div>

<h4><a name="ControlPlugin-ControlPlugin.doActionMethod"></a>ControlPlugin.doAction Method</h4>

<p>Control actions are defined in the plugin descriptor. Server and Service resources can include an <b>&lt;actions&gt;</b> tag that will define the control actions that resource supports. Multiple control actions can be defined by separating the actions with a comma. For example:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeHeader panelHeader" style="border-bottom-width: 1px;"><b>Defining Control Actions</b></div><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">&lt;actions include="start,stop,restart"/&gt;

For more information, see [Plugin Descriptors].</pre>
		</div>
</div></div>
<p>These actions are passed into doAction as a String argument. The plugin can then act accordingly. Each resource that supports control will have its own ControlPlugin instance. Configuration parameters defined in the plugin descriptor  <b>&lt;config&gt;</b> tags can be retrieved using the <tt>ControlPlugin.getConfig</tt> method.</p>

<p>An example using a JBoss JMS Destination, which uses JMX for its control actions:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeHeader panelHeader" style="border-bottom-width: 1px;"><b>hq-plugin.xml</b></div><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">&lt;!-- ObjectName properties used in the control plugins --&gt;
  &lt;property name="JMSQueue"
	    value="jboss.mq.destination:service=Queue,name=%jms.destination%"/&gt;

  ...
  &lt;service name="JMS Destination"&gt;
    &lt;config&gt;
      &lt;option name="jms.destination"
                description="JMS Destination"
                default=""/&gt;
    &lt;/config&gt;

    &lt;actions include="removeAllMessages"/&gt;
    ...
  &lt;/service&gt;
  ...</pre>
		</div>
</div></div>
<div class="code panel" style="border-width: 1px;"><div class="codeHeader panelHeader" style="border-bottom-width: 1px;"><b>JBossJMSControlPlugin.java</b></div><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">public class JBossJMSControlPlugin extends ControlPlugin {

    public void doAction(String action) throws PluginException {

        // ObjectName to invoke the method on
        String oName = getProperty("JMSQueue"); //From hq-plugin.xml

        try {
            ... // Get a reference to the MBeanServer
            mBeanServer.invoke(oName, action, new Object[0], new String[0]);
            ...
        } catch (Exception e) {
            throw new PluginException("Unable to invoke method '" +
                                      action + "'", e);
        }
    }
}</pre>
		</div>
</div></div>



				    
                    			    </td>
		    </tr>
	    </table>
	    <table border="0" cellpadding="0" cellspacing="0" width="100%">
			<tr>
				<td height="12" background="http://support.hyperic.com/images/border/border_bottom.gif"><img src="images/border/spacer.gif" width="1" height="1" border="0"/></td>
			</tr>
		    <tr>
			    <td align="center"><font color="grey">Document generated by Confluence on Jan 20, 2012 10:08</font></td>
		    </tr>
	    </table>
    </body>
</html>
