<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <b><a href="vFabric Hyperic 4.6.html" title="vFabric Hyperic 4.6 Documentation Home">vFabric Hyperic 4.6 Documentation Home (Internal)</a> - <a href="https://www.vmware.com/support/pubs/vfabric-hyperic.html">vFabric Hyperic 4.6 Documentation Home (Online)</a> -  <a href="https://www.vmware.com/support/vfabric-hyperic/doc/vfabric-hyperic-rn-4.6.0.html">Hyperic 4.6 Release Notes</a> </b>
<p>      
<p>
        <title>vFabric Hyperic 4.6 : Agent Upgrade Procedure</title>
	    <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">	    
    </head>

    <body>
	    <table class="pagecontent" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#ffffff">
		    <tr>
			    <td valign="top" class="pagebody">
				    <div class="pageheader">
					    <span class="pagetitle">
                            vFabric Hyperic 4.6 : Agent Upgrade Procedure
                                                    </span>
				    </div>
				    <div class="pagesubheading">
					    This page last changed on Jul 29, 2011 by <font color="#0050B2">mmcgarry</font>.
				    </div>

				    <style type='text/css'>/*<![CDATA[*/
div.rbtoc1311965610799 {margin-left: 1.5em;padding: 0px;}
div.rbtoc1311965610799 ul {list-style: disc;margin-left: 0px;padding-left: 20px;}
div.rbtoc1311965610799 li {margin-left: 0px;padding-left: 0px;}

/*]]>*/</style><div class='rbtoc1311965610799'>
<ul>
    <li><a href='#AgentUpgradeProcedure-PushAgentBundlefromthevFabricHypericServer'>Push Agent Bundle from the vFabric Hyperic Server</a></li>
    <li><a href='#AgentUpgradeProcedure-UpgradeAgentBundleManually'>Upgrade Agent Bundle Manually</a></li>
    <li><a href='#AgentUpgradeProcedure-CreateaCustomAgentUpgradeBundle'>Create a Custom Agent Upgrade Bundle</a></li>
    <li><a href='#AgentUpgradeProcedure-UpgradeAgentUsingaFullAgentPackage'>Upgrade Agent Using a Full Agent Package</a></li>
</ul></div>

<p>To upgrade a Hyperic 4.x Agent to 4.6 you can:</p>

<ul>
	<li>Install just the 4.6 agent bundle, by pushing it from your upgraded Hyperic 4.6 Server to each agent (in vFabric Hyperic only) as described in <a href="#AgentUpgradeProcedure-PushAgentBundlefromthevFabricHypericServer">Push Agent Bundle from the vFabric Hyperic Server</a>, or by manually copying the bundle to each agent as described in <a href="#AgentUpgradeProcedure-UpgradeAgentBundleManually">Upgrade Agent Bundle Manually</a>. If desired, you can first create your own agent bundle, as described in <a href="#AgentUpgradeProcedure-CreateaCustomAgentUpgradeBundle">Create a Custom Agent Upgrade Bundle</a>.</li>
</ul>


<ul>
	<li>Install 4.6 agent package.</li>
</ul>


<h1><a name="AgentUpgradeProcedure-PushAgentBundlefromthevFabricHypericServer"></a>Push Agent Bundle from the vFabric Hyperic Server</h1>
<p><b>Available only in <font color="red">vFabric Hyperic</font></b></p>

<p>You can update one or more Hyperic Agents by pushing the new bundle to it from the Hyperic Server, using the Hyperic user interface. The bundle must reside in the <tt>ServerHome/hq-engine/hq-server/webapps/ROOT/WEB-INF/hq-agent-bundles</tt> directory.</p>

<p>The agent upgrade command is available on the <b>Views</b> tab for an Hyperic Agent (or a group of agents). For more information, see <a href="ui-Views.AgentCommands.html" title="ui-Views.AgentCommands">Agent Control Commands</a>.</p>

<p><b>Note:</b> When you update an agent bundle, the agent configuration is preserved &#8212; the <tt>AgentHome/conf/agent.properties</tt> file is not overwritten.</p>

<style type='text/css'>/*<![CDATA[*/
div.rbtoc1311965610870 {margin-left: 1.5em;padding: 0px;}
div.rbtoc1311965610870 ul {list-style: disc;margin-left: 0px;padding-left: 20px;}
div.rbtoc1311965610870 li {margin-left: 0px;padding-left: 0px;}

/*]]>*/</style><div class='rbtoc1311965610870'>
<ul>
    <li><a href='#AgentUpgradeProcedure-PushAgentBundlefromthevFabricHypericServer'>Push Agent Bundle from the vFabric Hyperic Server</a></li>
    <li><a href='#AgentUpgradeProcedure-UpgradeAgentBundleManually'>Upgrade Agent Bundle Manually</a></li>
    <li><a href='#AgentUpgradeProcedure-CreateaCustomAgentUpgradeBundle'>Create a Custom Agent Upgrade Bundle</a></li>
    <li><a href='#AgentUpgradeProcedure-UpgradeAgentUsingaFullAgentPackage'>Upgrade Agent Using a Full Agent Package</a></li>
</ul></div>


<div class='panelMacro'><table class='tipMacro'><colgroup><col width='24'><col></colgroup><tr><td valign='top'><img src="images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td><b>Agent Name Unchanged by Bundle Upgrade Process</b><br />Note that if you upgrade a 4.x agent by pushing a new bundle from the Hyperic Server, the name of the agent is not changed. So, an agent name that contains the Hyperic version number &#8212; as is the default naming convention &#8212; reflects the originally installed version, rather than the version to which it has been upgraded. For example, if you push a 4.6 bundle to an agent whose name is "HQ Agent 4.5", the agent name will remain "HQ Agent 4.5".</td></tr></table></div>


<h1><a name="AgentUpgradeProcedure-UpgradeAgentBundleManually"></a>Upgrade Agent Bundle Manually</h1>

<p>Follow these steps if you wish to manually upgrade the agent bundle in your agent installation, instead of pushing the bundle from the Hyperic Server.</p>

<p><b>Note:</b> When you update an agent bundle, your previous agent configuration is preserved &#8212; the <tt>AgentHome/conf/agent.properties</tt> file is not overwritten.</p>

<ol>
	<li>Copy the agent bundle (agent-4.x.y-nnn.tgz or agent-4.x.y-nnn.zip) from<br/>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">ServerHome/hq-engine/hq-server/webapps/ROOT/WEB-INF/hq-agent-bundles</pre>
		</div>
</div></div>to
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">AgentHome/bundles</pre>
		</div>
</div></div></li>
	<li>Unpack the agent bundle.</li>
	<li>Edit the rollback.properties file in <tt>AgentHome/conf</tt> to specify the location of the new agent bundle and the bundle it will supersede.
<div class='table-wrap'>
<table class='confluenceTable'><tbody>
<tr>
<th class='confluenceTh'> Property </th>
<th class='confluenceTh'> Description </th>
<th class='confluenceTh'> Example </th>
</tr>
<tr>
<td class='confluenceTd'> HQ_AGENT_BUNDLE </td>
<td class='confluenceTd'> Name of directory with the new bundle, without full path specification. </td>
<td class='confluenceTd'> agent-4.5.0-EE-nnn </td>
</tr>
<tr>
<td class='confluenceTd'> HQ_AGENT&#95; <br class="atl-forced-newline" />
ROLLBACK_BUNDLE </td>
<td class='confluenceTd'> Name of directory with the old bundle (the one you are upgrading from), without full path specification. </td>
<td class='confluenceTd'> agent-4.5.0-EE-nnn </td>
</tr>
</tbody></table>
</div>
</li>
	<li>Restart the agent. For instructions, see <a href="Start, Stop, and Other Agent Operations.html" title="Start, Stop, and Other Agent Operations">Start, Stop, and Other Agent Operations</a>.</li>
</ol>


<div class='panelMacro'><table class='tipMacro'><colgroup><col width='24'><col></colgroup><tr><td valign='top'><img src="images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td><b>First Agent Startup</b><br />The first time you start the agent, it will prompt for start settings. If you prefer, you can supply the settings in the agent properties file before starting the agent the first time. For instructions, see <a href="Configure Agent - Server Communication in Properties File.html" title="Configure Agent - Server Communication in Properties File">Configure Agent - Server Communication in Properties File</a>.</td></tr></table></div>

<p>If the upgrade to the new agent bundle fails, an attempt will be made to start the agent using the old agent bundle.</p>

<p>You can determine whether the upgrade was successful and what version you are running by looking at the log files in AgentHome/logs.</p>

<h1><a name="AgentUpgradeProcedure-CreateaCustomAgentUpgradeBundle"></a>Create a Custom Agent Upgrade Bundle</h1>
<p><a name="AgentUpgradeProcedure-CustomBundle"></a></p>

<p>This section describes how to create a custom agent bundle. Pre-configuring the agent eases the process of upgrading multiple agents. For additional information, see <a href="Deploying Multiple Hyperic Agents.html" title="Deploying Multiple Hyperic Agents">Deploying Multiple Hyperic Agents</a>.</p>

<ol>
	<li>Back up an existing agent located in:
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">ServerHome/hq-engine/hq-server/webapps/ROOT/WEB-INF/hq-agent-bundles</pre>
		</div>
</div></div>
	<ul>
		<li>For example:
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">cp ServerHome/hq-engine/hq-server/webapps/ROOT/WEB-INF/hq-agent-bundles/agent-4.5.0-EE-nnn.tgz
ServerHome/hq-engine/hq-server/webapps/ROOT/WEB-INF/hq-agent-bundles/agent-4.5.0-EE-nnn.tgz.bak</pre>
		</div>
</div></div></li>
	</ul>
	</li>
	<li>Extract the bundle. For example:
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">tar xzf ServerHome/hq-engine/hq-server/webapps/ROOT/WEB-INF/hq-agent-bundles/agent-4.5.0-EE-nnn.tgz</pre>
		</div>
</div></div>
	<ul>
		<li>This results in a new directory corresponding to the agent bundle, like this:
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">ServerHome/hq-engine/hq-server/webapps/ROOT/WEB-INF/hq-agent-bundles/agent-4.5.0-EE-nnn</pre>
		</div>
</div></div></li>
	</ul>
	</li>
	<li>Update the contents of expanded directory. For instance, you could add custom plugins to the plugins directory:
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">ServerHome/hq-engine/hq-server/webapps/ROOT/WEB-INF/hq-agent-bundles/agent-4.5.0-EE-nnn/pdk/plugins</pre>
		</div>
</div></div></li>
	<li>Rename expanded directory to the name of custom agent bundle. For example:
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">mv ServerHome/hq-engine/hq-server/webapps/ROOT/WEB-INF/hq-agent-bundles/agent-4.5.0-EE-nnn
ServerHome/hq-engine/hq-server/webapps/ROOT/WEB-INF/hq-agent-bundles/my-bundle</pre>
		</div>
</div></div></li>
	<li>Pack up agent bundle, using the directory name from from the previous step as the tarball file name. For example:
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">tar cvf ServerHome/hq-engine/hq-server/webapps/ROOT/WEB-INF/hq-agent-bundles/my-bundle.tar
ServerHome/hq-engine/hq-server/webapps/ROOT/WEB-INF/hq-agent-bundles/my-bundle;
gzip ServerHome/hq-engine/hq-server/webapps/ROOT/WEB-INF/hq-agent-bundles/my-bundle</pre>
		</div>
</div></div></li>
</ol>


<h1><a name="AgentUpgradeProcedure-UpgradeAgentUsingaFullAgentPackage"></a>Upgrade Agent Using a Full Agent Package</h1>

<p>These instructions apply to both Hyperic HQ and vFabric Hyperic. </p>

<p>To upgrade an Hyperic 4.x Agent using full the agent package:</p>
<ol>
	<li>Stop the 4.x agent.</li>
	<li>Preserve the existing agent configuration.
	<ul>
		<li>Back up the <tt>agent.properties</tt> file from your previous installation. The default location for <tt>agent.properties</tt> in 4.x installations is the <tt>AgentHome/conf</tt> directory.</li>
		<li>Note: In some Hyperic environments, <tt>agent.properties</tt> is stored in an alternative location that eases the process of automating the deployment of multiple agents. On Unix-based platforms, that location is the <tt>.hq</tt> subdirectory of the home directory of the user that runs the Agent. If your agent configuration is stored in that location, it will not be over-written by the new installation.</li>
	</ul>
	</li>
	<li>If the agent runs on Windows, uninstall the agent service from a command shell in <tt>AgentHome/bin</tt>:
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">hq-agent.bat remove</pre>
		</div>
</div></div></li>
	<li>Unpack the 4.y agent into the agent installation directory.</li>
	<li>On Windows, install the new agent service. In a command shell in <tt>AgentHome/bin</tt> enter:
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">hq-agent.bat install</pre>
		</div>
</div></div></li>
	<li>Start the agent. For instructions, see <a href="Start, Stop, and Other Agent Operations.html" title="Start, Stop, and Other Agent Operations">Start, Stop, and Other Agent Operations</a>.</li>
</ol>


<div class='panelMacro'><table class='tipMacro'><colgroup><col width='24'><col></colgroup><tr><td valign='top'><img src="images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td><b>First Agent Startup</b><br />The first time you start the agent, it will prompt for start settings. If you prefer, you can supply the settings in the agent properties file before starting the agent the first time. For instructions, see <a href="Configure Agent - Server Communication in Properties File.html" title="Configure Agent - Server Communication in Properties File">Configure Agent - Server Communication in Properties File</a>.</td></tr></table></div>

<p><font color=""></font></p>




				    
                    			    </td>
		    </tr>
	    </table>
	    <table border="0" cellpadding="0" cellspacing="0" width="100%">
			<tr>
				<td height="12" background="http://support.hyperic.com/images/border/border_bottom.gif"><img src="images/border/spacer.gif" width="1" height="1" border="0"/></td>
			</tr>
		    <tr>
			    <td align="center"><font color="grey">Document generated by Confluence on Jul 29, 2011 14:43</font></td>
		    </tr>
	    </table>
    </body>
</html>
