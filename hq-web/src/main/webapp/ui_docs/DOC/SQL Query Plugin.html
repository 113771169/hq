<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
    <head>
        <title>vFabric Hyperic 5.7 : SQL Query Plugin</title>
	    <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">	    
    </head>

    <body>
<b><a href="vFabric Hyperic 5.7.html" title="vFabric Hyperic 5.7 Documentation Home">vFabric Hyperic 5.7 Documentation Home (Internal)</a>
 - <a href="https://www.vmware.com/support/pubs/vfabric-hyperic.html">vFabric Hyperic 5.7 Documentation Home (Online)</a>
 -  <a href="https://www.vmware.com/support/vfabric-hyperic/doc/vfabric-hyperic-rn-5.0.html">Hyperic 5.7 Release Notes</a> </b>
 <p>
 <p>
	    <table class="pagecontent" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#ffffff">
		    <tr>
			    <td valign="top" class="pagebody">
				    <div class="pageheader">
					    <span class="pagetitle">
                            vFabric Hyperic 5.7 : SQL Query Plugin
                                                    </span>
				    </div>
				    <div class="pagesubheading">
					    This page last changed on Jan 04, 2012 by <font color="#0050B2">mmcgarry</font>.
				    </div>

				    <style type='text/css'>/*<![CDATA[*/
div.rbtoc1325699759109 {margin-left: 1.5em;padding: 0px;}
div.rbtoc1325699759109 ul {list-style: disc;margin-left: 0px;padding-left: 20px;}
div.rbtoc1325699759109 li {margin-left: 0px;padding-left: 0px;}

/*]] >*/</style><div class='rbtoc1325699759109'>
<ul>
    <li><a href='#SQLQueryPlugin-SQLQueryPlugin'>SQL Query Plugin</a></li>
    <li><a href='#SQLQueryPlugin-CustomSQLQueryPlugins'>Custom SQL Query Plugins</a></li>
    <li><a href='#SQLQueryPlugin-JDBCDrivers'>JDBC Drivers</a></li>
    <li><a href='#SQLQueryPlugin-SupportClasses'>Support Classes</a></li>
    <li><a href='#SQLQueryPlugin-WriteaSQLQueryPlugin'>Write a SQL Query Plugin</a></li>
<ul>
    <li><a href='#SQLQueryPlugin-Step1CreatePluginDescriptorFile'>Step 1 - Create Plugin Descriptor File</a></li>
    <li><a href='#SQLQueryPlugin-Step2CreateRootpluginElement'>Step 2 - Create Root plugin Element</a></li>
    <li><a href='#SQLQueryPlugin-Step3DefineserviceElement'>Step 3 - Define service Element</a></li>
    <li><a href='#SQLQueryPlugin-Step4DefineconfigElement'>Step 4 - Define config Element</a></li>
    <li><a href='#SQLQueryPlugin-Step5DefinemetricElements'>Step 5 - Define metric Elements</a></li>
<ul>
    <li><a href='#SQLQueryPlugin-MetricTemplateFormatforSQLQueryPlugins'>Metric Template Format for SQL Query Plugins</a></li>
    <li><a href='#SQLQueryPlugin-HardCodethemetricElements'>Hard-Code the metric Elements</a></li>
    <li><a href='#SQLQueryPlugin-ParameterizemetricAttributes'>Parameterize metric Attributes</a></li>
</ul>
    <li><a href='#SQLQueryPlugin-Step6ReviewCompleteDescriptor'>Step 6 - Review Complete Descriptor</a></li>
</ul>
    <li><a href='#SQLQueryPlugin-TestPlugin'>Test Plugin</a></li>
    <li><a href='#SQLQueryPlugin-DeployPlugin'>Deploy Plugin</a></li>
    <li><a href='#SQLQueryPlugin-UsetheDeployedPlugin'>Use the Deployed Plugin</a></li>
</ul></div>




<h1><a name="SQLQueryPlugin-SQLQueryPlugin"></a>SQL Query Plugin</h1>

<p>Hyperic's SQL Query plugin (<tt>sqlquery-plugin.jar</tt>) runs SQL queries and reports them as metrics. You can configure a server type of "SQL Query", and supply the JDBC URL and credentials, along with a SQL query, as configuration options &#8212; the plugin will run the query each collection interval and return these metrics:</p>

<ul>
	<li>Availability</li>
	<li>Query</li>
	<li>Query Execution Time</li>
</ul>



<h1><a name="SQLQueryPlugin-CustomSQLQueryPlugins"></a>Custom SQL Query Plugins</h1>

<p>If you want to perform multiple SQL queries on a target database, you can write a custom plugin that uses the SQL Query plugin's measurement and log tracking classes. You define the required database connection information, and the SQL queries that return metrics, in an XML plugin descriptor. A custom plugin that uses the Hyperic SQL Query management classes is an XML plugin  &#8212;  a plugin that consists only of a plugin descriptor file.  </p>

<h1><a name="SQLQueryPlugin-JDBCDrivers"></a>JDBC Drivers</h1>

<p>The JDBC driver for the target database must be present in the Hyperic Agent's <tt>pdk/lib/jdbc</tt> directory. <b>Hyperic HQ includes drivers for MySql and PostgreSQL only.</b> vFabric Hyperic includes those drivers, and in addition, drivers for Oracle, Microsoft SQL Server, and DB2.   </p>

<p>If your version of Hyperic does not include the JDBC driver for your target database, you must obtain and install the appropriate vendor-provided JDBC driver in <tt>AgentHome/bundles/AgentBundle/pdk/lib/jdbc</tt>. </p>

<div class='table-wrap'>
<table class='confluenceTable'><tbody>
<tr>
<th class='confluenceTh'> Database </th>
<th class='confluenceTh'> Database driver </th>
<th class='confluenceTh'> Database Driver Class </th>
<th class='confluenceTh'> JAR </th>
<th class='confluenceTh'> Database URL </th>
</tr>
<tr>
<td class='confluenceTd'> SQL Server 2000 </td>
<td class='confluenceTd'> Microsoft SQL Server 2000 driver for JDBC <br class="atl-forced-newline" /> <br class="atl-forced-newline" />
Note: SQL Server 2005 JDBC Driver is backwards-compatible with SQL Server 2000. </td>
<td class='confluenceTd'> com.microsoft.jdbc.sqlserver.SQLServerDriver </td>
<td class='confluenceTd'>msbase-1.2.2.jar, msutil-1.2.2.jar, mssqlserver-1.2.2.jar</td>
<td class='confluenceTd'>jdbc:microsoft:sqlserver://localhost:1433 </td>
</tr>
<tr>
<td class='confluenceTd'> SQL Server 2005 </td>
<td class='confluenceTd'> SQL Server 2005 JDBC Driver </td>
<td class='confluenceTd'>com.microsoft.sqlserver.jdbc.SQLServerDriver <br class="atl-forced-newline" /> <br class="atl-forced-newline" />
<b>Note:</b> This version of the driver is not included in vFabric Hyperic. To monitor SQL Server 2005, you must obtain and install the driver.</td>
<td class='confluenceTd'> sqljdbc.jar </td>
<td class='confluenceTd'> jdbc:sqlserver://localhost:1433 </td>
</tr>
<tr>
<td class='confluenceTd'> SQL Server 2008 </td>
<td class='confluenceTd'> SQL Server JDBC Driver version 2.0 </td>
<td class='confluenceTd'>com.microsoft.sqlserver.jdbc.SQLServerDriver <br class="atl-forced-newline" /> <br class="atl-forced-newline" />
<b>Note:</b> This version of the driver is not included in vFabric Hyperic. To monitor SQL Server 2008, you must obtain and install the driver. </td>
<td class='confluenceTd'> sqljdbc.jar (JDBC 3.0) requires JRE 5.0 <br class="atl-forced-newline" />
<br class="atl-forced-newline" />
&nbsp;sqljdbc4.jar (JDBC 4.0), requires JRE 6.0 or later. </td>
<td class='confluenceTd'> jdbc:sqlserver://localhost:1433 </td>
</tr>
<tr>
<td class='confluenceTd'> Oracle </td>
<td class='confluenceTd'>&nbsp;</td>
<td class='confluenceTd'> oracle.jdbc.driver.OracleDriver </td>
<td class='confluenceTd'>&nbsp;</td>
<td class='confluenceTd'> jdbc:oracle:thin:@localhost:1521:TEST </td>
</tr>
<tr>
<td class='confluenceTd'> MySQL </td>
<td class='confluenceTd'>&nbsp;</td>
<td class='confluenceTd'> com.mysql.jdbc.Driver </td>
<td class='confluenceTd'>&nbsp;</td>
<td class='confluenceTd'> jdbc:mysql://localhost/test </td>
</tr>
<tr>
<td class='confluenceTd'> PostgreSQL </td>
<td class='confluenceTd'>&nbsp;</td>
<td class='confluenceTd'> org.postgresql.Driver </td>
<td class='confluenceTd'>&nbsp;</td>
<td class='confluenceTd'> jdbc:postgresql://localhost:5432/test </td>
</tr>
<tr>
<td class='confluenceTd'> db2 </td>
<td class='confluenceTd'>&nbsp;</td>
<td class='confluenceTd'> com.ibm.db2.jcc.DB2Driver </td>
<td class='confluenceTd'>&nbsp;</td>
<td class='confluenceTd'>&nbsp;</td>
</tr>
<tr>
<td class='confluenceTd'> Sybase </td>
<td class='confluenceTd'>&nbsp;</td>
<td class='confluenceTd'> com.sybase.jdbc2.jdbc.SybDriver </td>
<td class='confluenceTd'>&nbsp;</td>
<td class='confluenceTd'>&nbsp;</td>
</tr>
</tbody></table>
</div>


<h1><a name="SQLQueryPlugin-SupportClasses"></a>Support Classes </h1>

<div class='table-wrap'>
<table class='confluenceTable'><tbody>
<tr>
<th class='confluenceTh'> Function </th>
<th class='confluenceTh'> Class </th>
<th class='confluenceTh'> Description</th>
</tr>
<tr>
<td class='confluenceTd'>measurement </td>
<td class='confluenceTd'>org.hyperic.hq.plugin.sqlquery.SQLQueryMeasurementPlugin </td>
<td class='confluenceTd'> Extends org.hyperic.hq.product.JDBCMeasurementPlugin. </td>
</tr>
<tr>
<td class='confluenceTd'>log tracking </td>
<td class='confluenceTd'>org.hyperic.hq.plugin.sqlquery.SQLQueryLogTrackPlugin </td>
<td class='confluenceTd'>Exends org.hyperic.hq.product.LogTrackPlugin. </td>
</tr>
<tr>
<td class='confluenceTd'>auto-discovery </td>
<td class='confluenceTd'>org.hyperic.hq.plugin.sqlquery.SQLQueryDetector  </td>
<td class='confluenceTd'> Extends org.hyperic.hq.product.DaemonDetector </td>
</tr>
</tbody></table>
</div>


<h1><a name="SQLQueryPlugin-WriteaSQLQueryPlugin"></a>Write a SQL Query Plugin</h1>

<p>This section has instructions for writing a simple SQL Query plugin that queries the Hyperic database for availability, and the number of platforms, servers, and services in inventory. The SQL queries that return the metrics are:</p>

<ul>
	<li>Availability &#8212; The Availability metric must return the value "1" to indicate that the plugin is able to connect to the database and execute SQL statements. An easy way to do this is to run an arbitrary, supported database query, appended by <tt>WHERE 1=1</tt>, which causes the result "1" if the query executes. For example:
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">SELECT COUNT(*) FROM EAM_CONFIG_PROPS WHERE 1=1</pre>
		</div>
</div></div></li>
	<li>Number of Platforms
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">SELECT COUNT(*) FROM EAM_PLATFORM</pre>
		</div>
</div></div> </li>
	<li>Number of Servers
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">SELECT COUNT(*) FROM EAM_PLATFORM</pre>
		</div>
</div></div>    </li>
	<li>Number of Services
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">SELECT COUNT(*) FROM EAM_SERVICE</pre>
		</div>
</div></div> </li>
</ul>


<h2><a name="SQLQueryPlugin-Step1CreatePluginDescriptorFile"></a>Step 1 - Create Plugin Descriptor File</h2>

<p>Create an file in a text or XML editor, and save with a name in this form:</p>

<p><tt>plugin_name-plugin.xml</tt> </p>

<p>where <tt>plugin_name</tt> is a lower case string. For example: </p>

<p><tt>inventory-plugin.xml</tt></p>

<h2><a name="SQLQueryPlugin-Step2CreateRootpluginElement"></a>Step 2 - Create Root plugin Element</h2>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: xml; gutter: false">&lt;plugin&gt;

&lt;/plugin&gt;</pre>
		</div>
</div></div>

<h2><a name="SQLQueryPlugin-Step3DefineserviceElement"></a>Step 3 - Define service Element</h2>
<p>In the sample plugin, the resource under which a custom SQL Query plugin reports metrics is a service. In this step, you create the skeleton of the <tt>&lt;service&gt;</tt>. The <tt>name</tt> attribute defines the resource type of the service.</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: xml; gutter: false">&lt;plugin&gt;
     &lt;service name="HQ Inventory"&gt;

     &lt;/service&gt;
&lt;/plugin}</pre>
		</div>
</div></div>

<p>For more information about <tt>&lt;service&gt;</tt> element usage, see <a href="service.html" title="service">service</a>.</p>

<h2><a name="SQLQueryPlugin-Step4DefineconfigElement"></a>Step 4 - Define config Element</h2>

<p>In this step, you define the configuration schema for the plugin. These properties will appear on the <b>Configuration Properties</b> page for a resource of type "HQ Inventory".</p>

<p>The SQL Query measurement and log tracking classes requires the following database connection data in order to connect to the target database. </p>

<div class='table-wrap'>
<table class='confluenceTable'><tbody>
<tr>
<th class='confluenceTh'> Option/Property </th>
<th class='confluenceTh'>Description  </th>
<th class='confluenceTh'>Notes </th>
</tr>
<tr>
<td class='confluenceTd'>jdbcDriver </td>
<td class='confluenceTd'>JDBC driver class name </td>
<td class='confluenceTd'> <a href="#SQLQueryPlugin-JDBCDrivers">JDBC Drivers</a> shows value for different databases. The example plugin specifes the PostgreSQL driver class.  </td>
</tr>
<tr>
<td class='confluenceTd'>jdbcUrl </td>
<td class='confluenceTd'>Datasbase connection URL </td>
<td class='confluenceTd'> <a href="#SQLQueryPlugin-JDBCDrivers">JDBC Drivers</a> shows the URL formate for different databases. The example plugin specifies the Hyperic database URL, in the PostgreSQL URL format  </td>
</tr>
<tr>
<td class='confluenceTd'>jdbcUser </td>
<td class='confluenceTd'>User to connect as. </td>
<td class='confluenceTd'>The example plugin does not specify the username value. You supply the username when configuring the "HQ Inventory" service.   </td>
</tr>
<tr>
<td class='confluenceTd'>jdbcPassword </td>
<td class='confluenceTd'>Password to connect with </td>
<td class='confluenceTd'>The example plugin does not specify the password value. You supply the password when configuring the "HQ Inventory" service. </td>
</tr>
</tbody></table>
</div>


<p>In this example, the target database is PostgreSQL.</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: xml; gutter: false">&lt;plugin&gt;
     &lt;service name="HQ Inventory"&gt;
          &lt;config&gt;

               &lt;option name="jdbcDriver"
                       description="JDBC Driver Class Name"
                       default="org.postgresql.Driver"/&gt;

               &lt;option name="jdbcUrl"
                       description="JDBC Connection URL"
                       default="jdbc:postgresql://localhost:9432/hqdb"/&gt;

               &lt;option name="jdbcUser"
                       description="JDBC User"/&gt;

               &lt;option name="jdbcPassword" type="secret"
                       optional="true"
                       description="JDBC Password"/&gt;
              
          &lt;/config&gt;     

     &lt;/service&gt;
&lt;/plugin&gt;</pre>
		</div>
</div></div>

<p>For information about <tt>&lt;config&gt;</tt> and <tt>&lt;option&gt;</tt> element usage, see <a href="config.html" title="config">config</a> and <a href="option.html" title="option">option</a>.</p>

<h2><a name="SQLQueryPlugin-Step5DefinemetricElements"></a>Step 5 - Define metric Elements</h2>

<p>In this step, you define the <tt>&lt;metric&gt;</tt> element for each metric to be reported. The key attribute of a  <tt>&lt;metric&gt;</tt> element is <tt>template</tt>, which is an expression that tells the agent how to obtain and report a metric. The steps below illustrate the process of fully specifying the <tt>template</tt> attribute, and then using variables to simplify the metric definitions.</p>

<h3><a name="SQLQueryPlugin-MetricTemplateFormatforSQLQueryPlugins"></a>Metric Template Format for SQL Query Plugins</h3>
<p><a name="SQLQueryPlugin-SqlQueryMetricTemplate"></a></p>

<p>The form of a metric template for a SQL Query plugin is:</p>

<p>sql:<em>Query</em>:<em>MetricName</em></p>

<p>where: </p>

<ul>
	<li>sql &#8212; this string routes metric collection to the <tt>org.hyperic.hq.plugin.sqlquery.SQLQueryMeasurementPlugin</tt> class.</li>
	<li><em>Query</em> &#8212; is the SQL query to execute.</li>
	<li><em>MetricName</em> &#8212; the metric name for the query result, for example, <tt>"Number of Platforms"</tt>.</li>
</ul>


<p>For information about <tt>&lt;metric&gt;</tt> element usage, see <a href="metric.html" title="metric">metric</a> and <a href="Understanding Metric Templates.html" title="Understanding Metric Templates">Understanding Metric Templates</a>.</p>


<h3><a name="SQLQueryPlugin-HardCodethemetricElements"></a>Hard-Code the metric Elements</h3>

<p>The <tt>&lt;metric&gt;</tt> elements added to the plugin descriptor explicitly define the <tt>template</tt> attribute. </p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: xml; gutter: false">&lt;plugin&gt;
     &lt;service name="HQ Inventory"&gt;
          &lt;config&gt;

               &lt;option name="jdbcDriver"
                       description="JDBC Driver Class Name"
                       default="org.postgresql.Driver"/&gt;

               &lt;option name="jdbcUrl"
                       description="JDBC Connection URL"
                       default="jdbc:postgresql://localhost:9432/hqdb"/&gt;

               &lt;option name="jdbcUser"
                       description="JDBC User"/&gt;

               &lt;option name="jdbcPassword" type="secret"
                       optional="true"
                       description="JDBC Password"/&gt;
              
          &lt;/config&gt;     

          &lt;metric name="Availability"
                  template="sql:SELECT COUNT(*) FROM EAM_CONFIG_PROPS WHERE 1=1:Availability"
                  indicator="true"/&gt;

          &lt;metric name="Number of Platforms"
                  template="sql:SELECT COUNT(*) FROM EAM_PLATFORM:Number of Platforms"
                  indicator="true"/&gt;

          &lt;metric name="Number of Servers"
                  template="sql:SELECT COUNT(*) FROM EAM_SERVER:Number of Servers"
                  indicator="true"/&gt;

          &lt;metric name="Number of Services"
                   template="sql:SELECT COUNT(*) FROM EAM_SERVICE:Number of Services"
                   indicator="true"/&gt;
      &lt;/service&gt;
&lt;/plugin&gt;</pre>
		</div>
</div></div>



<h3><a name="SQLQueryPlugin-ParameterizemetricAttributes"></a>Parameterize metric Attributes</h3>

<p>In a typical plugin, you use variables to simplify the definition of the <tt>template</tt> attribute. This step shows one way to parameterize the template definition.  Variables are defined using the <tt>&lt;filter&gt;</tt> element; for <tt>&lt;filter&gt;</tt> element usage, see <a href="filter.html" title="filter">filter</a>.  </p>

<p>For information about <tt>&lt;metric&gt;</tt> element usage, see <a href="metric.html" title="metric">metric</a> and <a href="Understanding Metric Templates.html" title="Understanding Metric Templates">Understanding Metric Templates</a>.</p>


<ol>
	<li>Assign the portion common to each <tt>template</tt> definition to a variable:
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: xml; gutter: false">&lt;filter name="count" 
             value="SELECT COUNT(*) FROM"/&gt;</pre>
		</div>
</div></div></li>
	<li>Update metric elements to use <tt>count</tt>:
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: xml; gutter: false">&lt;metric name="Availability"
                  template="sql:${count} EAM_CONFIG_PROPS WHERE 1=1:Availability"
                  indicator="true"/&gt;
          &lt;metric name="Number of Platforms"
                  template="sql:${count} EAM_PLATFORM:Number of Platforms"
                  indicator="true"/&gt;
          &lt;metric name="Number of Servers"
                  template="sql:${count} EAM_SERVER:Number of Servers"
                  indicator="true"/&gt;
          &lt;metric name="Number of Services"
                  template="sql:${count} EAM_SERVICE:Number of Services"
                  indicator="true"/&gt;</pre>
		</div>
</div></div></li>
	<li>Define unique portion of query in each <tt>&lt;metric&gt;</tt> element's <tt>query</tt> attribute and update metric elements accordingly:
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: xml; gutter: false">&lt;metric name="Availability"
                  query="EAM_CONFIG_PROPS WHERE 1=1"
                  template="sql:${count} ${query}:Availability"
                  indicator="true"/&gt;
          &lt;metric name="Number of Platforms"
                   query="EAM_PLATFORM"
                   template="sql:${count} ${query}:Number of Platforms"
                   indicator="true"/&gt;
           &lt;metric name="Number of Servers"
                   query="EAM_SERVER"
                   template="sql:${count} ${query}:Number of Servers"
                   indicator="true"/&gt;
            &lt;metric name="Number of Services"
                   query="EAM_PLATFORM"
                   template="sql:${count} ${query}:Number of Servers"
                   indicator="true"/&gt;</pre>
		</div>
</div></div></li>
	<li>Create a variable that defines the <tt>template</tt> for each metric in terms of <tt>count</tt>, <tt>query</tt>, and <tt>name</tt>, and remove the <tt>template</tt> attribute from each <tt>&lt;metric&gt;</tt> element.
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: xml; gutter: false">&lt;filter name="template" 
       value=""sql:${count} ${query}:${name}"/&gt;

&lt;metric name="Number of Platforms"
        query="${count} EAM_PLATFORM"
        indicator="true"/&gt;

&lt;metric name="Number of Servers"
        query="${count} EAM_SERVER"
        indicator="true"/&gt;

&lt;metric name="Number of Services"
        template="sql:${count} EAM_SERVICE"
        indicator="true"/&gt;</pre>
		</div>
</div></div></li>
</ol>



<h2><a name="SQLQueryPlugin-Step6ReviewCompleteDescriptor"></a>Step 6 - Review Complete Descriptor</h2>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: xml; gutter: false">&lt;plugin&gt;
  &lt;service name="HQ Inventory"&gt;

    &lt;config&gt;
      &lt;option name="jdbcDriver"
              description="JDBC Driver Class Name"
              default="org.postgresql.Driver"/&gt;
      &lt;option name="jdbcUrl"
              description="JDBC Connection URL"
              default="jdbc:postgresql://localhost:9432/hqdb"/&gt;
      &lt;option name="jdbcUser"
              description="JDBC User"/&gt;
      &lt;option name="jdbcPassword" type="secret"
              optional="true"
              description="JDBC Password"/&gt;
              
     &lt;/config&gt;         

     &lt;filter name="count" 
     		 value="SELECT COUNT(*) FROM"/&gt;
     		
     &lt;filter name="template" 
    		 value="sql:${count} ${query}:${name}"/&gt;


    &lt;metric name="Availability"
            query="EAM_CONFIG_PROPS WHERE 1=1"
            indicator="true"/&gt;

    &lt;metric name="Number of Platforms"
    	query="EAM_PLATFORM"
            indicator="true"/&gt;

    &lt;metric name="Number of Servers"
            query="EAM_SERVER"
            indicator="true"/&gt;

    &lt;metric name="Number of Services"
            query="EAM_SERVICE"
            indicator="true"/&gt;

  &lt;/service&gt;
&lt;/plugin&gt;</pre>
		</div>
</div></div>

<h1><a name="SQLQueryPlugin-TestPlugin"></a>Test Plugin</h1>

<p>Test the plugin by running it at the command line. You supply the value of required configuration properties on the command line:</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">$ java -jar AgentVersion/bundles/AgentBundle/pdk/lib/hq-pdk-VERSION.jar -Dplugins.include=hq-inventory -DjdbcDriver=org.postgresql.Driver -DjdbcUrl=jdbc:postgresql://localhost:9432/hqdb -DjdbcUser=hqadmin -DjdbcPassword=hqadmin -t "HQ Inventory"</pre>
		</div>
</div></div>

<p>Successful results look like this:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">HQ Inventory Availability:

   HQ Inventory:sql:SELECT COUNT(*) FROM EAM_CONFIG_PROPS WHERE 1%3D1:Availability:jdbcDriver=org.postgresql.Driver,jdbcUrl=jdbc%3Apostgresql%3A//localhost%3A9432/hqdb,jdbcUser=hqadmin,jdbcPassword=hqadmin

   =&gt;100.0%&lt;=

HQ Inventory Number of Platforms:

   HQ Inventory:sql:SELECT COUNT(*) FROM EAM_PLATFORM:Number of Platforms:jdbcDriver=org.postgresql.Driver,jdbcUrl=jdbc%3Apostgresql%3A//localhost%3A9432/hqdb,jdbcUser=hqadmin,jdbcPassword=hqadmin

   =&gt;17.0&lt;=

HQ Inventory Number of Servers:

   HQ Inventory:sql:SELECT COUNT(*) FROM EAM_SERVER:Number of Servers:jdbcDriver=org.postgresql.Driver,jdbcUrl=jdbc%3Apostgresql%3A//localhost%3A9432/hqdb,jdbcUser=hqadmin,jdbcPassword=hqadmin

   =&gt;172.0&lt;=

HQ Inventory Number of Services:

   HQ Inventory:sql:SELECT COUNT(*) FROM EAM_SERVICE:Number of Services:jdbcDriver=org.postgresql.Driver,jdbcUrl=jdbc%3Apostgresql%3A//localhost%3A9432/hqdb,jdbcUser=hqadmin,jdbcPassword=hqadmin

   =&gt;1,289.0&lt;=</pre>
		</div>
</div></div>

<h1><a name="SQLQueryPlugin-DeployPlugin"></a>Deploy Plugin</h1>
<p>Deploy the plugin. For instructions, see <a href="Plugin Deployment and Management.html" title="Plugin Deployment and Management">Plugin Deployment and Management</a> in <em>vFabric Hyperic Administration</em>. </p>

<p><tt>AgentHome/bundles/AgentBundle/pdk/lib/jdbc</tt></p>

<h1><a name="SQLQueryPlugin-UsetheDeployedPlugin"></a>Use the Deployed Plugin</h1>

<p>After the plugin is successfully deployed, you can configure a resource of type "HQ Inventory".</p>

<ol>
	<li>In the Hyperic user interface, navigate to the platform upon which the service will appear.</li>
	<li>Click <b>New Platform Service</b> on the <b>Tools</b> menu.
	<ul>
		<li>The <b>New Service</b> page appears.<br/>
<span class="image-wrap" style=""><img src="attachments/79660206/79921916.png" width="750px" style="border: 0px solid black"/></span></li>
	</ul>
	</li>
	<li>On the <b>New Service</b> page:
	<ul>
		<li><b>Name</b> &#8212; Enter a name for the server, for example, "Resource Report".</li>
		<li><b>Service Type</b> &#8212; Select "HQ Inventory" from the selector list.</li>
	</ul>
	</li>
	<li>The <b>Inventory</b> page for the new service appears.<br/>
<span class="image-wrap" style=""><img src="attachments/79660206/79921914.png" width="750px" style="border: 0px solid black"/></span></li>
	<li>Click <b>Edit</b> in the "Configuration Properties" section of the page.
	<ul>
		<li>The <b>Configuration Properties</b> page appears.<br/>
<span class="image-wrap" style=""><img src="attachments/79660206/79921915.png" width="750px" style="border: 0px solid black"/></span></li>
	</ul>
	</li>
	<li>Enter the username and password for connecting to the database in the <b>jdbcUser</b> and <b>jdbcPassword</b> fields, and click <b>OK</b>
	<ul>
		<li>The <b>Indicators</b> page for the new service appears.<br/>
<span class="image-wrap" style=""><img src="attachments/79660206/79921889.png" width="750px" style="border: 0px solid black"/></span></li>
	</ul>
	</li>
</ol>



				    					    <br/>
                        <div class="tabletitle">
                            <a name="attachments">
                                <h2>Attachments:</h2>
                            </a>
                        </div>

                        <div class="greybox" align="left">
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/79659807/79921530.png">ora-sql-config.png</a> (image/png)
                                <br/>
                                                    </div>
				    
                    			    </td>
		    </tr>
	    </table>
	    <table border="0" cellpadding="0" cellspacing="0" width="100%">
			<tr>
				<td height="12" background="http://support.hyperic.com/images/border/border_bottom.gif"><img src="images/border/spacer.gif" width="1" height="1" border="0"/></td>
			</tr>
		    <tr>
			    <td align="center"><font color="grey">Document generated by Confluence on Oct 29, 2012 13:01</font></td>
		    </tr>
	    </table>
    </body>
</html>
