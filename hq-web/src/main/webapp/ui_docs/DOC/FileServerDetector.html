<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
    <head>
        <title>Hyperic 4.6 Documentation : FileServerDetector</title>
	    <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">	    
    </head>

    <body>
	    <table class="pagecontent" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#ffffff">
		    <tr>
			    <td valign="top" class="pagebody">
				    <div class="pageheader">
					    <span class="pagetitle">
                            Hyperic 4.6 Documentation : FileServerDetector
                                                    </span>
				    </div>
				    <div class="pagesubheading">
					    This page last changed on Jun 07, 2011 by <font color="#0050B2">mmcgarry</font>.
				    </div>

				    <p><font color="gray"><em>Topics marked with</em></font> <font color="red">*</font> <font color="gray"><em>relate to features available only in vFabric Hyperic.</em></font></p>


<style type='text/css'>/*<![CDATA[*/
div.rbtoc1307466555232 {margin-left: 1.5em;padding: 0px;}
div.rbtoc1307466555232 ul {list-style: disc;margin-left: 0px;padding-left: 20px;}
div.rbtoc1307466555232 li {margin-left: 0px;padding-left: 0px;}

/*]]>*/</style><div class='rbtoc1307466555232'>
<ul>
    <li><a href='#FileServerDetector-InterfaceHierarchy'>Interface Hierarchy</a></li>
    <li><a href='#FileServerDetector-InterfaceReferences'>Interface References</a></li>
    <li><a href='#FileServerDetector-ImplementingMethods'>Implementing Methods</a></li>
    <li><a href='#FileServerDetector-ExampleUsage'>Example Usage</a></li>
    <li><a href='#FileServerDetector-StandaloneInvocation'>Standalone Invocation</a></li>
</ul></div>


<p>The FileServerDetector interface (<tt>org.hyperic.hq.product.FileServerDetector</tt>) is used to discover server resources based on file system scan. This interface is used if user manually invokes new autodiscovery on platform level. Background scan is getting hints from &lt;scan&gt; tag to match correct file paths. Based on these results this interface is called with every matched result.</p>




<h1><a name="FileServerDetector-InterfaceHierarchy"></a>Interface Hierarchy</h1>

<ul>
	<li>org.hyperic.hq.product.FileServerDetector</li>
</ul>


<h1><a name="FileServerDetector-InterfaceReferences"></a>Interface References</h1>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">package org.hyperic.hq.product;
import java.util.List;
import org.hyperic.util.config.ConfigResponse;</pre>
		</div>
</div></div>

<h1><a name="FileServerDetector-ImplementingMethods"></a>Implementing Methods</h1>

<p>This interface implements following methods:</p>

<p><tt>getServerResources(ConfigResponse,String):List</tt></p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">public List getServerResources(ConfigResponse platformConfig, String path)
throws PluginException;</pre>
		</div>
</div></div>
<p>This method is called if assosiated autodiscovery implementation is implementing this interface. Method is called with every successfully matched result. Return value has to be a List of ServerResource object. See <a href="ServerResource.html" title="ServerResource">ServerResource</a> for more information.</p>

<p><b>Parameters:</b><br/>
<b>&nbsp;&nbsp; platformConfig</b> Configuration for underlying platform.<br/>
<b>&nbsp;&nbsp; path</b> Matched path</p>

<p><b>Returns:</b><br/>
&nbsp;&nbsp; List of <tt>ServerResource</tt> objects.</p>

<p><b>Throws:</b><br/>
&nbsp;&nbsp; org.hyperic.hq.product.PluginException</p>

<h1><a name="FileServerDetector-ExampleUsage"></a>Example Usage</h1>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">package hq.example;

import java.util.ArrayList;
import java.util.List;

import org.hyperic.hq.product.FileServerDetector;
import org.hyperic.hq.product.PluginException;
import org.hyperic.hq.product.ServerDetector;
import org.hyperic.hq.product.ServerResource;
import org.hyperic.util.config.ConfigResponse;

public class CustomFileScanDetector
extends ServerDetector
implements FileServerDetector {

    /** Base PTQL query to find matching processes by full path */
    private static final String PTQL_QUERY = "Exe.Name.ct=";

    public List getServerResources(ConfigResponse platformConfig, String path)
    throws PluginException {
        List servers = new ArrayList();
        ConfigResponse productConfig = new ConfigResponse();

        // alter query to find discovered process
        // this can be later altered through hq gui.
        productConfig.setValue("process.query", PTQL_QUERY + path);
        ServerResource server = createServerResource(path);
        setProductConfig(server, productConfig);
        server.setMeasurementConfig();
        servers.add(server);

        return servers;
	}

}</pre>
		</div>
</div></div>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: xml; gutter: false">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;plugin
   name="filescan-example"
   package="hq.example"&gt;

      &lt;metrics
            name="basic-process-metrics"&gt;
         &lt;metric
               indicator="true"
               units="percentage"
               name="Availability"
               collectionType="dynamic"
               template="sigar:Type=ProcState,Arg=%process.query%:State"
               category="AVAILABILITY"&gt;
         &lt;/metric&gt;
         &lt;metric
               indicator="true"
               units="B"
               name="Process Virtual Memory Size"
               collectionType="dynamic"
               template="sigar:Type=ProcMem,Arg=%process.query%:Size"
               category="UTILIZATION"&gt;
         &lt;/metric&gt;
         &lt;metric
               units="B"
               name="Process Resident Memory Size"
               template="sigar:Type=ProcMem,Arg=%process.query%:Resident"&gt;
         &lt;/metric&gt;
         &lt;metric
               name="Process Page Faults"
               collectionType="trendsup"
               template="sigar:Type=ProcMem,Arg=%process.query%:PageFaults"&gt;
         &lt;/metric&gt;
         &lt;metric
               units="ms"
               name="Process Cpu System Time"
               collectionType="trendsup"
               template="sigar:Type=ProcCpu,Arg=%process.query%:Sys"&gt;
         &lt;/metric&gt;
         &lt;metric
               units="ms"
               name="Process Cpu User Time"
               collectionType="trendsup"
               template="sigar:Type=ProcCpu,Arg=%process.query%:User"&gt;
         &lt;/metric&gt;
         &lt;metric
               units="ms"
               name="Process Cpu Total Time"
               collectionType="trendsup"
               template="sigar:Type=ProcCpu,Arg=%process.query%:Total"&gt;
         &lt;/metric&gt;
         &lt;metric
               indicator="true"
               units="percentage"
               name="Process Cpu Usage"
               template="sigar:Type=ProcCpu,Arg=%process.query%:Percent"&gt;
         &lt;/metric&gt;
         &lt;metric
               units="epoch-millis"
               name="Process Start Time"
               collectionType="static"
               template="sigar:Type=ProcTime,Arg=%process.query%:StartTime"
               category="AVAILABILITY"&gt;
         &lt;/metric&gt;
         &lt;metric
               name="Process Open File Descriptors"
               template="sigar:Type=ProcFd,Arg=%process.query%:Total"&gt;
         &lt;/metric&gt;
         &lt;metric
               name="Process Threads"
               template="sigar:Type=ProcState,Arg=%process.query%:Threads"&gt;
         &lt;/metric&gt;
      &lt;/metrics&gt;

      &lt;server name="filescanserver"&gt;
         &lt;plugin
               type="autoinventory"
               class="CustomFileScanDetector"&gt;
         &lt;/plugin&gt;
         &lt;plugin
               type="measurement"
               class="org.hyperic.hq.product.MeasurementPlugin"&gt;
         &lt;/plugin&gt;
         &lt;scan&gt;
            &lt;include name="/**/firefox.exe"/&gt;
         &lt;/scan&gt;
         &lt;config&gt;
            &lt;option
                  default="Exe.Name.eq=svc"
                  name="process.query"
                  description="Process Query for customserver"&gt;
            &lt;/option&gt;
         &lt;/config&gt;
         &lt;metrics
               include="basic-process-metrics"&gt;
         &lt;/metrics&gt;
      &lt;/server&gt;

&lt;/plugin&gt;</pre>
		</div>
</div></div>


<h1><a name="FileServerDetector-StandaloneInvocation"></a>Standalone Invocation</h1>

<p>Standalone plugin invocation differs slightly how FileServerDetector and AutoServerDetector are executed compared to real agent. If real agent is about to use FileServerDetector it executes that before AutoServerDetector. Standalone invocation executes either one of these but not both of them.</p>

<p>To test FileServerDetector interface make sure that at least one of the following parameters exist:</p>

<div class='table-wrap'>
<table class='confluenceTable'><tbody>
<tr>
<th class='confluenceTh'> Property key </th>
<th class='confluenceTh'> Description </th>
<th class='confluenceTh'> Values </th>
<th class='confluenceTh'> Defaults </th>
</tr>
<tr>
<td class='confluenceTd'> fileScan.scanDirs </td>
<td class='confluenceTd'> Directories to scan </td>
<td class='confluenceTd'> List of directories separated by comma </td>
<td class='confluenceTd'> Win:"C:\" <br class="atl-forced-newline" />
Unix:"/usr", "/opt" </td>
</tr>
<tr>
<td class='confluenceTd'> fileScan.excludeDirs </td>
<td class='confluenceTd'> Directories to exclude from scan </td>
<td class='confluenceTd'> List of directories separated by comma </td>
<td class='confluenceTd'> Win:"\WINNT", "\TEMP", "\TMP","\Documents and Settings", "\Recycled" <br class="atl-forced-newline" />
Unix:"/usr/doc", "/usr/dict", "/usr/lib", "/usr/libexec", "/usr/man", "/usr/tmp", "/usr/include", "/usr/share", "/usr/src","/usr/local/include", "/usr/local/share", "/usr/local/src" </td>
</tr>
<tr>
<td class='confluenceTd'> fileScan.fsTypes </td>
<td class='confluenceTd'> File system types to scan </td>
<td class='confluenceTd'> One of "All disks", "Local disks", "Network-mounted disks" </td>
<td class='confluenceTd'> All disks </td>
</tr>
<tr>
<td class='confluenceTd'> fileScan.depth </td>
<td class='confluenceTd'> How deep (in directory levels) to scan. </td>
<td class='confluenceTd'> 1 or above, use &#45;1 to indicate unlimited depth. </td>
<td class='confluenceTd'> 6 </td>
</tr>
<tr>
<td class='confluenceTd'> fileScan.followSymlinks </td>
<td class='confluenceTd'> Should symlinks be followed? </td>
<td class='confluenceTd'> true or false </td>
<td class='confluenceTd'> false </td>
</tr>
</tbody></table>
</div>


<p>Standalone invocation is done using &#45;m discover and &#45;p &lt;server type name&gt; options.</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false"># java -jar hq-pdk.jar
-Dplugins.include=filescan-example
-Dlog=info
-DfileScan.scanDirs="C:\\Program Files (x86)"
-DfileScan.excludeDirs="\\WINNT,\\TEMP,\\TMP,\\Documents and Settings,\\Recycled"
-DfileScan.fsTypes="Local disks"
-DfileScan.depth=2
-DfileScan.followSymlinks=false
-m discover
-p filescanserver</pre>
		</div>
</div></div>


<div class="scroll-pagebreak"></div>

				    
                    			    </td>
		    </tr>
	    </table>
	    <table border="0" cellpadding="0" cellspacing="0" width="100%">
			<tr>
				<td height="12" background="http://support.hyperic.com/images/border/border_bottom.gif"><img src="images/border/spacer.gif" width="1" height="1" border="0"/></td>
			</tr>
		    <tr>
			    <td align="center"><font color="grey">Document generated by Confluence on Jun 14, 2011 15:09</font></td>
		    </tr>
	    </table>
    </body>
</html>
