<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
    <head>
        <title>vFabric Hyperic 4.6.5 : Java Applications</title>
	    <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">	    
    </head>

    <body>
<b><a href="vFabric Hyperic 4.6.5.html" title="vFabric Hyperic 4.6.5 Documentation Home">vFabric Hyperic 4.6.5 Documentation Home (Internal)</a>
 - <a href="https://www.vmware.com/support/pubs/vfabric-hyperic.html">vFabric Hyperic 4.6.5 Documentation Home (Online)</a>
 -  <a href="https://www.vmware.com/support/vfabric-hyperic/doc/vfabric-hyperic-rn-4.6.5.html">Hyperic 4.6.5 Release Notes</a> </b>
 <p>
 <p>
	    <table class="pagecontent" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#ffffff">
		    <tr>
			    <td valign="top" class="pagebody">
				    <div class="pageheader">
					    <span class="pagetitle">
                            vFabric Hyperic 4.6.5 : Java Applications
                                                    </span>
				    </div>
				    <div class="pagesubheading">
					    This page last changed on Jan 04, 2012 by <font color="#0050B2">mmcgarry</font>.
				    </div>

				    <p><font color="gray"><em>Topics marked with</em></font> <font color="red">*</font> <font color="gray"><em>relate to features available only in vFabric Hyperic.</em></font></p>


<style type='text/css'>/*<![CDATA[*/
div.rbtoc1325699872199 {margin-left: 1.5em;padding: 0px;}
div.rbtoc1325699872199 ul {list-style: disc;margin-left: 0px;padding-left: 20px;}
div.rbtoc1325699872199 li {margin-left: 0px;padding-left: 0px;}

/*]]>*/</style><div class='rbtoc1325699872199'>
<ul>
    <li><a href='#JavaApplications-AutoDiscoveryofCustomMBeans'>Auto-Discovery of Custom MBeans</a></li>
    <li><a href='#JavaApplications-PrerequisitesandSupportedEnvironments'>Prerequisites and Supported Environments</a></li>
<ul>
    <li><a href='#JavaApplications-JavaVersion'>Java Version</a></li>
    <li><a href='#JavaApplications-SupportedContainers'>Supported Containers</a></li>
    <li><a href='#JavaApplications-EnableDiscoveryofaStandAloneInstrumentedJavaApplication'>Enable Discovery of a Stand-Alone Instrumented Java Application</a></li>
    <li><a href='#JavaApplications-MBeanServer'>MBeanServer</a></li>
<ul>
    <li><a href='#JavaApplications-CreateaMBeanServerinTomcat'>Create a MBeanServer in Tomcat</a></li>
    <li><a href='#JavaApplications-CreateanMBeanServerforStandAloneAppsorOtherContainer'>Create an MBeanServer for Stand-Alone Apps or Other Container</a></li>
</ul>
    <li><a href='#JavaApplications-EnableModelMBeanExportinJBossContainers'>Enable ModelMBean Export in JBoss Containers</a></li>
</ul>
    <li><a href='#JavaApplications-Step1SetUpResourcestoExportModelMBeans'>Step 1 - Set Up Resources to Export ModelMBeans</a></li>
    <li><a href='#JavaApplications-Step2VerifyModelMBeanExporttoMBeanServer'>Step 2 - Verify Model MBean Export to MBeanServer</a></li>
    <li><a href='#JavaApplications-Step3VerifyServiceApplicationAutoDiscovery'>Step 3 - Verify Service Application Auto-Discovery</a></li>
<ul>
    <li><a href='#JavaApplications-SolvingProblemswithServiceAutoDiscovery'>Solving Problems with Service Auto-Discovery</a></li>
</ul>
    <li><a href='#JavaApplications-Step4ConfigureAppServicesasanApplicationinHQ'>Step 4 - Configure App Services as an Application in HQ</a></li>
</ul></div>


<h1><a name="JavaApplications-AutoDiscoveryofCustomMBeans"></a>Auto-Discovery of Custom MBeans</h1>

<p>The HQ Agent can auto-discover and manage Java application services via Model MBeans that adhere to a specified ObjectName naming convention and expose a specified set of service data. This enables you to monitor application services along with the hosting application server and its internal services.</p>

<h1><a name="JavaApplications-PrerequisitesandSupportedEnvironments"></a>Prerequisites and Supported Environments</h1>

<p>This section specifies requirements for HQ auto-discovery and management for Java application services.</p>

<h2><a name="JavaApplications-JavaVersion"></a>Java Version</h2>

<p>Auto-discovery of services exposed as ModelMBeans requires a version 1.5 or later JRE or JDK.</p>

<h2><a name="JavaApplications-SupportedContainers"></a>Supported Containers</h2>

<p>The capability is supported for applications running in:</p>
<ul>
	<li>Tomcat v5.5 and later</li>
	<li>WebLogic v9.1 and later</li>
	<li>WebSphere v5.0 and later</li>
	<li>JBoss v3.2 and later.  See <a href="#JavaApplications-EnableModelMBeanExportinJBossContainers">Enable ModelMBean Export in JBoss Containers</a>.</li>
	<li>SpringSource dm Server v1.0 and later</li>
	<li>SpringSource tc Server v6.0 and later</li>
	<li>Other containers that expose a JSR-160 connector. See <a href="#JavaApplications-CreateanMBeanServerforStandAloneAppsorOtherContainer">Create an MBeanServer for Stand&#45;Alone Apps or Other Container</a>.</li>
</ul>


<h2><a name="JavaApplications-EnableDiscoveryofaStandAloneInstrumentedJavaApplication"></a>Enable Discovery of a Stand-Alone Instrumented Java Application</h2>

<p>To enable MBean discovery in a stand-alone Java Application, you must:</p>

<ul>
	<li>Instrument your code as specified in <a href="Model MBean Naming and Descriptor Data.html" title="Model MBean Naming and Descriptor Data">Model MBean Naming and Descriptor Data</a>, or be using Spring Framework instrumented jar files, and</li>
	<li>Start the application with the <tt>spring.managed.application.name</tt> system property. For example:<br/>
<tt>java -Dcom.sun.management.jmxremote -Dspring.managed.application.name="MyApplicationName" com.sample.MyApp</tt></li>
</ul>


<p>The application name will be set as the name of the discovered resource &#8212; in this example, <tt>MyApplicationName</tt>.</p>

<h2><a name="JavaApplications-MBeanServer"></a>MBeanServer</h2>

<p>The application servers listed in <a href="#JavaApplications-SupportedContainers">Supported Containers</a> generally have an existing MBeanServer. If your container does not have an MBeanServer - as is the case with Tomcat if you haven't previously set it up - you must configure one along with a JSR-160 connector. See the directions below.</p>

<h3><a name="JavaApplications-CreateaMBeanServerinTomcat"></a>Create a MBeanServer in Tomcat</h3>

<p>If you wish to monitor applications running on Tomcat, make sure it has a MBeanServer.&nbsp; If it doesn't, you can create an MBeanServer and associated<br/>
connector by setting the appropriate system properties at JVM startup.</p>

<p>You can add the system properties to the Tomcat start script, <tt>$TOMCAT_HOME/bin/catalina.sh</tt>:
<br class="atl-forced-newline" /></p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">[ $1!= "stop" ] &amp;&amp; JAVA_OPTS="-Dcom.sun.management.jmxremote \
-Dcom.sun.management.jmxremote.port=6969 \
-Dcom.sun.management.jmxremote.ssl=false \
-Dcom.sun.management.jmxremote.authenticate=false $JAVA_OPTS"
export JAVA_OPTS</pre>
		</div>
</div></div>
<p>For more information, visit:</p>
<ul>
	<li><a href="http://tomcat.apache.org">http://tomcat.apache.org</a> for&nbsp; information about setting system properties for your version of Tomcat.&nbsp;&nbsp;&nbsp;</li>
	<li><a href="http://download.oracle.com/javase/1.5.0/docs/api/javax/management/remote/package-summary.html">http://download.oracle.com/javase/1.5.0/docs/api/javax/management/remote/package-summary.html</a> for information about system properties that configure remote JMX access.</li>
</ul>


<h3><a name="JavaApplications-CreateanMBeanServerforStandAloneAppsorOtherContainer"></a>Create an MBeanServer for Stand-Alone Apps or Other Container</h3>

<p>To create a MBeanServer for an application than runs stand-alone or a container other than those listed <a href="#JavaApplications-SupportedContainers">Supported Containers</a>, set the JMX remote system properties in the application or container start script. These system properties create a local MBeanServer and remote connector:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">-Dcom.sun.management.jmxremote \
-Dcom.sun.management.jmxremote.port=6969 \
-Dcom.sun.management.jmxremote.ssl=false \
-Dcom.sun.management.jmxremote.authenticate=false \</pre>
		</div>
</div></div>

<h2><a name="JavaApplications-EnableModelMBeanExportinJBossContainers"></a>Enable ModelMBean Export in JBoss Containers</h2>

<p>There is a known issue with HQ discovery of services running in JBoss - when the JBoss interceptor publishes the MBeans for the services, it does not export them as type "Model", preventing HQ from detecting them. You can work around this issue by commenting out the following entry in<br/>
<tt>JBOSS_HOME/server/default/deploy/jmx-invoker-service.xml</tt>:</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">&lt;!-- Interceptor that deals with non-serializable results --&gt;
     &lt;!--&gt;&lt;interceptor code="org.jboss.jmx.connector.invoker.SerializableInterceptor"
      policyClass="StripModelMBeanInfoPolicy"/&gt; --&gt;</pre>
		</div>
</div></div>

<h1><a name="JavaApplications-Step1SetUpResourcestoExportModelMBeans"></a>Step 1 - Set Up Resources to Export ModelMBeans</h1>

<p>Each Java class or service must instantiate Model MBeans that meet the requirements described in <a href="Model MBean Naming and Descriptor Data.html" title="Model MBean Naming and Descriptor Data">Model MBean Naming and Descriptor Data</a>.</p>

<p>There are multiple methods for creating Model MBeans. The process is not documented here. A variety of information is available on the Sun site. Introductory material and examples are available in:</p>
<ul>
	<li><a href="http://docs.sun.com/app/docs/doc/816-4178/6madjde4n?a=view">Chapter 3 "Model MBeans" of the Java Dynamic Management Kit 5.0 Tutorial</a></li>
</ul>


<ul>
	<li><a href="http://blogs.sun.com/jmxetc/entry/dynamicmbeans,_modelmbeans,_and_pojos...">this blog</a></li>
</ul>


<p><b>Note:</b> Redeploy your application after enabling export of Model MBeans.</p>

<div class="panel" style="border-width: 1px;"><div class="panelHeader" style="border-bottom-width: 1px;"><b>Applications with SpringSource Instrumented Jars</b></div><div class="panelContent">
<p>If your applications run with Spring instrumented JARs, they should automatically export Model MBeans with the required name format and descriptors.</p>
</div></div>

<div class="panel" style="border-width: 1px;"><div class="panelHeader" style="border-bottom-width: 1px;"><b>Applications using Spring 3.0 JMX Annotations</b></div><div class="panelContent">
<p>If your applications expose MBeans using the Spring 3.0 JMX annotations (@ManagedResource, @ManagedMetric, @ManagedAttribute, @ManagedOperation), they should automatically be exported with the required descriptors.</p>
</div></div>

<h1><a name="JavaApplications-Step2VerifyModelMBeanExporttoMBeanServer"></a>Step 2 - Verify Model MBean Export to MBeanServer</h1>

<p>To verify that your your application services have instantiated ModelMBeans, you can use a JMX client to browse the MBeanServer.</p>

<h1><a name="JavaApplications-Step3VerifyServiceApplicationAutoDiscovery"></a>Step 3 - Verify Service Application Auto-Discovery</h1>

<p>The HQ Agent managing the server instance where your application runs should discover Model MBeans in the MBeanServer that meet the requirements specified in <a href="Model MBean Naming and Descriptor Data.html" title="Model MBean Naming and Descriptor Data">Model MBean Naming and Descriptor Data</a>.</p>

<p>The server instance that hosts the application will appear in the <b>Auto-Discovery</b> portlet on the Dashboard of the HQ user interface. After you import the new or changed server instance to inventory, you can browse to the application services, which will appear as children of the host server.</p>

<h2><a name="JavaApplications-SolvingProblemswithServiceAutoDiscovery"></a>Solving Problems with Service Auto-Discovery</h2>

<p>If your application services were not discovered, verify that:</p>

<ul>
	<li>The hosting application server is enabled for remote JMX remote access.</li>
</ul>


<ul>
	<li>The JMX properties (the JMX URL, username, and password) for the server were auto-discovered by the HQ Agent, or entered manually, if necessary. If the HQ Agent auto-discovered the JMX properties, they appear on the <b>Configuration Properties</b> page for the server instance. If the agent did not discover the JMX properties, an authorized HQ user must specify them on the server instance's <b>Configuration Properties</b> page.</li>
</ul>


<p>For information on how to configure JMX remote see Sun's website (<a href="hhttp://download.oracle.com/javase/1.5.0/docs/guide/management/agent.html">hhttp://download.oracle.com/javase/1.5.0/docs/guide/management/agent.html</a>).</p>

<h1><a name="JavaApplications-Step4ConfigureAppServicesasanApplicationinHQ"></a>Step 4 - Configure App Services as an Application in HQ</h1>

<p>You may find it useful to configure an HQ application that groups the discovered services for an application.</p>
<ol>
	<li>Click <b>Resources-&gt;Browse</b> in the HQ user interface.</li>
	<li>Select <b>New Application</b> from the <b>Tools</b> menu.</li>
	<li>Enter a name for the application in the <b>Name</b> text box and click <b>OK</b>.</li>
	<li>Click <b>Add to List</b> in the "Services" section of the page.
	<ul>
		<li>The left column on the <b>Edit</b> page for the application lists all of the services in HQ that you have permission to view. The name of a discovered application service contains the name of the application, as specified in the associated ModelMBean's ObjectName. (This is true only if the application name was specified in the ObjectName.)</li>
	</ul>
	</li>
	<li>To filter the list by its application name or another identifying string, enter the string in the <b>Filter By Name</b> text box, and click the green arrow.</li>
	<li>Place a checkmark next to each service that belongs to the application, click the right arrow to move the services into the right column, and click OK to add selected services to the application.</li>
</ol>



				    
                    			    </td>
		    </tr>
	    </table>
	    <table border="0" cellpadding="0" cellspacing="0" width="100%">
			<tr>
				<td height="12" background="http://support.hyperic.com/images/border/border_bottom.gif"><img src="images/border/spacer.gif" width="1" height="1" border="0"/></td>
			</tr>
		    <tr>
			    <td align="center"><font color="grey">Document generated by Confluence on Feb 14, 2012 13:49</font></td>
		    </tr>
	    </table>
    </body>
</html>
