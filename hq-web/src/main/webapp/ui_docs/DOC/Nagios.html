<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
    <head>
        <title>Hyperic 4.6 Documentation : Nagios</title>
	    <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">	    
    </head>

    <body>
	    <table class="pagecontent" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#ffffff">
		    <tr>
			    <td valign="top" class="pagebody">
				    <div class="pageheader">
					    <span class="pagetitle">
                            Hyperic 4.6 Documentation : Nagios
                                                    </span>
				    </div>
				    <div class="pagesubheading">
					    This page last changed on Jun 21, 2011 by <font color="#0050B2">mmcgarry</font>.
				    </div>

				    <p><font color="gray"><em>Topics marked with</em></font> <font color="red">*</font> <font color="gray"><em>relate to features available only in vFabric Hyperic.</em></font></p>


<style type='text/css'>/*<![CDATA[*/
div.rbtoc1308679167154 {margin-left: 1.5em;padding: 0px;}
div.rbtoc1308679167154 ul {list-style: disc;margin-left: 0px;padding-left: 20px;}
div.rbtoc1308679167154 li {margin-left: 0px;padding-left: 0px;}

/*]]>*/</style><div class='rbtoc1308679167154'>
<ul>
    <li><a href='#Nagios-NagiosResourcesandtheHypericInventoryModel'>Nagios Resources and the Hyperic Inventory Model</a></li>
    <li><a href='#Nagios-ManagementFunctions'>Management Functions</a></li>
<ul>
    <li><a href='#Nagios-AutoDiscovery'>Auto-Discovery</a></li>
    <li><a href='#Nagios-MetricCollection'>Metric Collection</a></li>
    <li><a href='#Nagios-LogTracking'>Log Tracking</a></li>
</ul>
    <li><a href='#Nagios-ConfigureNagiosMonitoring'>Configure Nagios Monitoring</a></li>
<ul>
    <li><a href='#Nagios-Prerequisites'>Prerequisites</a></li>
    <li><a href='#Nagios-InstallHypericAgent'>Install Hyperic Agent</a></li>
    <li><a href='#Nagios-CreateandConfigureNagiosServerResourceforMonitoring'>Create and Configure Nagios Server Resource for Monitoring</a></li>
    <li><a href='#Nagios-ConfigureHypericAlertsonNagiosChecks'>Configure Hyperic Alerts on Nagios Checks</a></li>
</ul>
    <li><a href='#Nagios-ViewNagiosResourcesandMetricsinHyperic'>View Nagios Resources and Metrics in Hyperic</a></li>
<ul>
    <li><a href='#Nagios-ViewNagiosServiceDetail'>View Nagios Service Detail</a></li>
    <li><a href='#Nagios-ViewaNagiosCheck'>View a Nagios Check</a></li>
</ul>
</ul></div>


<p>Hyperic has built-in support for integration with Nagios. Hyperic imports your Nagios checks, runs them, and presents the results in the Hyperic user interface. Note that Hyperi runs the Nagios checks independently from Nagios. During the Hyperic implementation process, Nagios users find it useful to run Hyperic and Nagios side-by-side and compare results.</p>

<h1><a name="Nagios-NagiosResourcesandtheHypericInventoryModel"></a>Nagios Resources and the Hyperic Inventory Model</h1>

<p>To understand the configuration process and to interpret the Nagios data presented in the Hyperic user interface, it's helpful to understand how the elements of a Nagios implementation map to the Hyperic inventory model.</p>

<div class='panelMacro'><table class='tipMacro'><colgroup><col width='24'><col></colgroup><tr><td valign='top'><img src="images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>For information about the inventory types in Hyperic, see <a href="Resources, Resource Types and Inventory Types.html" title="Resources, Resource Types and Inventory Types">Resources, Resource Types and Inventory Types</a>.</td></tr></table></div>

<ul>
	<li><b>Nagios server host</b>&#45;--The machine that hosts the Nagios server is a platform in Hyperic. The Hyperic Agent you install on it auto-discovers it, and the platform type. Its name is its fully qualified domain name (FQDN).</li>
</ul>


<ul>
	<li><b>Nagios server</b> &#8212; The Nagios server itself, is a server in Hyperic. Its server type is "Nagios".</li>
</ul>


<ul>
	<li><b>Nagios plugins</b> &#8212; Each Nagios plugin, sometimes referred to as a script, check, or command, is represented by a service of type "Nagios Plugin"in Hyperic.</li>
</ul>



<p>This table summarizes the inventory facts that relate to how Nagios items are represented in Hyperic.</p>
<div class='table-wrap'>
<table class='confluenceTable'><tbody>
<tr>
<td class='confluenceTd'> <b>Nagios item</b> </td>
<td class='confluenceTd'> <b>Hyperic inventory type</b> </td>
<td class='confluenceTd'> <b>Hyperic resource type</b> </td>
<td class='confluenceTd'> <b>name in Hyperic</b> </td>
<td class='confluenceTd'> <b>metric reported in Hyperic</b> </td>
</tr>
<tr>
<td class='confluenceTd'> system that hosts the Nagios server </td>
<td class='confluenceTd'> platform </td>
<td class='confluenceTd'> a supported Hyperic platform type (Linux, </td>
<td class='confluenceTd'> its FQDN </td>
<td class='confluenceTd'> Availability </td>
</tr>
<tr>
<td class='confluenceTd'> the Nagios server </td>
<td class='confluenceTd'> server </td>
<td class='confluenceTd'> Nagios </td>
<td class='confluenceTd'> HypericPlatformName+"Nagios" </td>
<td class='confluenceTd'> availability </td>
</tr>
<tr>
<td class='confluenceTd'> <em>each</em> Nagios plugin </td>
<td class='confluenceTd'> is a service </td>
<td class='confluenceTd'> Nagios Plugin </td>
<td class='confluenceTd'> HypericPlatformName&#43; <br class="atl-forced-newline" />
"NagiosPlugin"&#43; <br class="atl-forced-newline" />
NagiosPluginName&#43; <br class="atl-forced-newline" />
NagiosHost </td>
<td class='confluenceTd'> Execution time <br class="atl-forced-newline" />
Return code </td>
</tr>
<tr>
<td class='confluenceTd'> <em>all</em> Nagios plugins </td>
<td class='confluenceTd'> belong to an autogroup </td>
<td class='confluenceTd'>&nbsp;</td>
<td class='confluenceTd'> "Nagios Plugin" </td>
<td class='confluenceTd'>&nbsp;</td>
</tr>
</tbody></table>
</div>


<h1><a name="Nagios-ManagementFunctions"></a>Management Functions</h1>

<h2><a name="Nagios-AutoDiscovery"></a>Auto-Discovery</h2>

<p>If Nagios is installed in the location that the agent expects, the agent auto-discovers it, and creates a resource whose name is the the concatenation of the host platform's name and the Hyperic server type for the Nagios server "Nagios". For instance:<br/>
<tt>bear Nagios</tt></p>

<p>If auto-discovery of Nagios plugins is enabled for the Nagios server resource in Hyperic, the Hyperic Agent creates a "Nagios Plugin" service for each Nagios plugin defined in the Nagios configuration file. The name of the service in Hyperic is the contcatenation of:</p>
<ul>
	<li>
	<ul>
		<li>The first segment of the FQDN of the platform where the Nagios server runs.</li>
		<li>The string "Nagios Plugin"</li>
		<li>Either the value of the "service_description" property as defined in the Nagios definition of the plugin or the string "check_command",</li>
		<li>The hostname of the monitored resource. &nbsp;For example:<br/>
<tt>bear Nagios Plugin PING patriot.intranet.myco.net</tt> or <br/>
<tt>bear Nagios Plugin check_command patriot.intranet.myco.net</tt></li>
	</ul>
	</li>
</ul>


<p><b>Note:</b> Hyperic creates an autogroup named "Nagios Plugin" that contains all of the Nagios plugins</p>

<h2><a name="Nagios-MetricCollection"></a>Metric Collection</h2>

<p>The following metric are report for each Nagios plugin service.</p>

<ul>
	<li><b>Availability</b> &#8212; Reflects the availability of the Nagios check itself, rather than the service it is monitoring. The value is derived from the Nagios plugin's return code:
	<ul>
		<li>0 == <span class="image-wrap" style=""><img src="attachments/77463561/77660601.gif" style="border: 0px solid black"/></span> OK</li>
		<li>1 == <span class="image-wrap" style=""><img src="attachments/77463561/77660604.gif" style="border: 0px solid black"/></span> Warning</li>
		<li>2 == <span class="image-wrap" style=""><img src="attachments/77463561/77660603.gif" style="border: 0px solid black"/></span> Critical</li>
		<li>3 == <span class="image-wrap" style=""><img src="attachments/77463561/77660602.gif" style="border: 0px solid black"/></span> Unknown</li>
		<li>other == <span class="image-wrap" style=""><img src="attachments/77463561/77660603.gif" style="border: 0px solid black"/></span> Unknown</li>
	</ul>
	</li>
	<li><b>Execution Time</b> &#8212; time to execute the Ngios check.</li>
	<li><b>Result Value</b> &#8212; Result value, if one is returned by the plugin.</li>
	<li><b>Return Code</b> &#8212; The numerical values of the Nagios return code.</li>
</ul>


<h2><a name="Nagios-LogTracking"></a>Log Tracking</h2>

<p>Log tracking is enabled by default for Nagios plugin services. The plugin output is used as the log message and exit codes are mapped to Hyperic log levels as follows:</p>
<ul>
	<li>0 - Info (OK)</li>
	<li>1 - Warn (Warning)</li>
	<li>2 - Error (Critical)</li>
	<li>3 - Error (Unknown)</li>
	<li>other - Error (Unknown)</li>
</ul>


<h1><a name="Nagios-ConfigureNagiosMonitoring"></a>Configure Nagios Monitoring</h1>

<h2><a name="Nagios-Prerequisites"></a>Prerequisites</h2>

<p>To enable Nagios integration, you install an Hyperic Agent on the system that hosts your Nagios server. The agent must run under an account with permission to execute the Nagios plugins.</p>

<h2><a name="Nagios-InstallHypericAgent"></a>Install Hyperic Agent</h2>

<ol>
	<li>Install the Hyperic Agent on the Nagios server host.</li>
	<li>Start the Hyperic Agent on the Nagios server host.
	<ul>
		<li>If Nagios was installed from source in <tt>/usr/local/nagios</tt>, Hyperic will parse the <tt>nagios.cfg</tt> file and create an service in Hyperic of type "Nagios Plugin" for each nagios service definition in the configuration file.</li>
	</ul>
	</li>
</ol>


<p><b>Note</b>: If the Hyperic Agent on the Nagios platform does not find the <tt>nagios.cfg</tt> file, follow the instructions in <a href="#Nagios-CreateandConfigureNagiosServerResourceforMonitoring">Create and Configure Nagios Server Resource for Monitoring</a>.</p>

<h2><a name="Nagios-CreateandConfigureNagiosServerResourceforMonitoring"></a>Create and Configure Nagios Server Resource for Monitoring</h2>

<p>Perform these steps if the Hyperic Agent on the Nagios platform does not find the <tt>nagios.cfg</tt> file, and hence does not create a "Nagios Plugin" service resource for each Nagios plugin.</p>

<ol>
	<li>In the Hyperic user interface, browse to platform where the Nagios server runs.</li>
	<li>From the <b>Tools</b> menu, select the <b>New Server</b> option.</li>
	<li>On the <b>New Server</b> page, enter required properties and click <b>OK</b>:
	<ul>
		<li><b>Name</b> &#8212; Enter a name for the new server.</li>
		<li><b>Owner</b> &#8212; Defaults to the Hyperic account under which the server is being created.</li>
		<li><b>Description</b> &#8212; (Optional) Enter a description of the server.</li>
		<li><b>Server Type</b> &#8212; Select "Nagios" from the pulldown.</li>
		<li><b>Host Platform</b> &#8212; Defaults to the platform on which you created the server.</li>
		<li><b>Install Path</b> &#8212; Enter the path to your Nagios installation.</li>
	</ul>
	</li>
	<li>The <b>Inventory</b> page for the new server appears, and displays this message:<br/>
<tt>This resource has not been configured. Please set its</tt> <tt><b>Configuration Properties</b></tt>.</li>
	<li>Click the blue <b>Configuration Properties</b> link in the message.
	<ul>
		<li>The <b>Configuration Properties</b> page appears.<br/>
<span class="image-wrap" style=""><img src="attachments/77463605/77660206.png" width="750px" style="border: 0px solid black"/></span></li>
	</ul>
	</li>
	<li>On the <b>Configuration Properties</b> page:
	<ul>
		<li><b>nagios.cfg</b> &#8212; This property defaults to <tt>etc/nagious.cfg</tt>. Enter the correct path the the Nagios configuration file.</li>
		<li><b>Auto-Discover Plugins?</b> &#8212; By default, this property is checked. Leave plugin auto-discovery enabled if you want all Nagios plugins to be discovered. If you wish to integrate selected plugins, you can do so by manually creating a service of type "Nagios Plugin" on the Nagios server resource for each Nagios plugin whose data you wish to integrate into Hyperic.</li>
	</ul>
	</li>
</ol>


<h2><a name="Nagios-ConfigureHypericAlertsonNagiosChecks"></a>Configure Hyperic Alerts on Nagios Checks</h2>

<p>You can define a metric threshold alert to fire based on the Return Code metric for a Nagios check, so that you, or other responsible parties are notified when a check script exits with an unacceptable value.</p>

<p>You define such alerts at the service level, in Hyperic inventory terms. A Nagios check's name in Hyperic contains the name of the monitored host, so you can tell which host triggered the alert.</p>

<h1><a name="Nagios-ViewNagiosResourcesandMetricsinHyperic"></a>View Nagios Resources and Metrics in Hyperic</h1>

<ul>
	<li><a href="#Nagios-ViewNagiosServiceDetail">View Nagios Service Detail</a></li>
	<li><a href="#Nagios-ViewaNagiosCheck">View a Nagios Check</a></li>
</ul>


<div class="scroll-pagebreak"></div>

<h2><a name="Nagios-ViewNagiosServiceDetail"></a>View Nagios Service Detail</h2>

<p>Select <b>Nagios Availability</b> from the <b>Resources</b> tab in the masthead.</p>

<p>The page displays the most recent results of the Nagios checks. This is the same information that is displayed on the Nagios Service Details page.</p>
<ul>
	<li><b>Host</b>--- The host that the Nagios check is monitoring</li>
	<li><b>Service</b> &#8212; The Nagios plugin used to perform the check</li>
	<li><b>Status</b> &#8212; The Return Code from execution of the check</li>
	<li><b>Last Check</b> &#8212; When the check was last run</li>
	<li><b>Event Log</b> &#8212; Output of the plugin</li>
</ul>


<p>Each line is color-coded:</p>
<ul>
	<li><b>Pink</b> &#8212; monitored service is down.</li>
	<li><b>Yellow</b> &#8212; monitored service has triggered an alert, based on the threshold defined in Nagios.</li>
	<li><b>Green</b> &#8212; monitored service is OK.</li>
</ul>


<p><span class="image-wrap" style=""><img src="attachments/77463605/77660413.png" style="border: 0px solid black"/></span></p>

<div class="scroll-pagebreak"></div>


<h2><a name="Nagios-ViewaNagiosCheck"></a>View a Nagios Check</h2>

<p>To view a Nagios check in the Hyperic User Interface</p>

<ol>
	<li>Browse the the Nagios server resource using <b>Resources &gt; Browse &gt; Servers &gt; Nagios</b>.</li>
	<li>Choose the Nagios server from the list of servers.
	<ul>
		<li>The <b>Indicators</b> tab for the Nagios server appears.<br/>
<span class="image-wrap" style=""><img src="attachments/77463605/77660404.png" style="border: 0px solid black"/></span></li>
	</ul>
	</li>
	<li>In the <b>Resources</b> mintab, click the autogroup called "Nagios Plugin", which contains the Nagios checks.</li>
	<li>The first chart on the <b>Indicators</b> tab shows the average execution time for the all of the checks in the group.
	<ul>
		<li>Note: (Charts of average Result Values and Return Codes are also presented, but this data is not meaningful for a group.)<br/>
<span class="image-wrap" style=""><img src="attachments/77463605/77660403.png" style="border: 0px solid black"/></span></li>
	</ul>
	</li>
	<li>Click on a specific check in the <b>Group Members</b> list.
	<ul>
		<li>The <b>Indicators</b> tab for the Nagios service appears.<br/>
<span class="image-wrap" style=""><img src="attachments/77463605/77660414.png" style="border: 0px solid black"/></span></li>
	</ul>
	</li>
	<li>To view log messages output by the check, click the blue icons above the time range bar at the bottom of the page.</li>
</ol>




				    
                    			    </td>
		    </tr>
	    </table>
	    <table border="0" cellpadding="0" cellspacing="0" width="100%">
			<tr>
				<td height="12" background="http://support.hyperic.com/images/border/border_bottom.gif"><img src="images/border/spacer.gif" width="1" height="1" border="0"/></td>
			</tr>
		    <tr>
			    <td align="center"><font color="grey">Document generated by Confluence on Jun 22, 2011 15:14</font></td>
		    </tr>
	    </table>
    </body>
</html>
