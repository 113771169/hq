<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
    <head>
        <title>vFabric Hyperic 5.0 : RegistryServerDetector</title>
	    <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">	    
    </head>

    <body>
<b><a href="vFabric Hyperic 5.0.html" title="vFabric Hyperic 5.0 Documentation Home">vFabric Hyperic 5.0 Documentation Home (Internal)</a>
 - <a href="https://www.vmware.com/support/pubs/vfabric-hyperic.html">vFabric Hyperic Documentation Home (Online)</a>
 -  <a href="https://www.vmware.com/support/vfabric-hyperic/doc/vfabric-hyperic-rn-5.0.html">Hyperic 5.0 Release Notes</a> </b>
 <p>
 <p>
	    <table class="pagecontent" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#ffffff">
		    <tr>
			    <td valign="top" class="pagebody">
				    <div class="pageheader">
					    <span class="pagetitle">
                            vFabric Hyperic 5.0 : RegistryServerDetector
                                                    </span>
				    </div>
				    <div class="pagesubheading">
					    This page last changed on Jan 04, 2012 by <font color="#0050B2">mmcgarry</font>.
				    </div>

				    <p><font color="gray"><em>Topics marked with</em></font> <font color="red">*</font> <font color="gray"><em>relate to features available only in vFabric Hyperic.</em></font></p>


<style type='text/css'>/*<![CDATA[*/
div.rbtoc1325699778002 {margin-left: 1.5em;padding: 0px;}
div.rbtoc1325699778002 ul {list-style: disc;margin-left: 0px;padding-left: 20px;}
div.rbtoc1325699778002 li {margin-left: 0px;padding-left: 0px;}

/*]] >*/</style><div class='rbtoc1325699778002'>
<ul>
    <li><a href='#RegistryServerDetector-Overview'>Overview</a></li>
    <li><a href='#RegistryServerDetector-InterfaceHierarchy'>Interface Hierarchy</a></li>
    <li><a href='#RegistryServerDetector-InterfaceReferences'>Interface References</a></li>
    <li><a href='#RegistryServerDetector-ImplementingMethods'>Implementing Methods</a></li>
    <li><a href='#RegistryServerDetector-ExampleUsage'>Example Usage</a></li>
    <li><a href='#RegistryServerDetector-StandaloneInvocation'>Standalone Invocation</a></li>
</ul></div>

<h1><a name="RegistryServerDetector-Overview"></a>Overview</h1>

<p>The <tt>RegistryServerDetector</tt> interface (<tt>org.hyperic.hq.product.RegistryServerDetector</tt>) is used to discover server resources found by scanning the Windows registry. </p>

<p>Scan criteria are specified in a <tt>&lt;scan&gt;</tt> element in the plugin descriptor. These element attributes define where in the registry to search and what registry to key to look for:  </p>

<ul>
	<li><tt>registry</tt> &#8212; This attribute specifies a registry path in the Windows registry. Subkeys of the specified path will be scanned. You can designate several search roots by appending the path with an aserisk <img class="emoticon" src="images/icons/emoticons/star_yellow.gif" height="16" width="16" align="absmiddle" alt="" border="0"/>.</li>
</ul>


<ul>
	<li><tt>include</tt> &#8212; This attribute specifies the name of a key in the Windows registry. A <tt>&lt;scan&gt;</tt> element can contain multiple <tt>include</tt> attributes. Note that the registry scan does not support wildcards in the registry key name.</li>
</ul>


<p>This <tt>&lt;scan&gt;</tt> element will result in a scan for a subkey of "SOFTWARE\Microsoft\Internet Explorer" whose name is </p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: xml; gutter: false">&lt;scan registry="SOFTWARE\Microsoft\Internet Explorer"&gt;
  &lt;include name="AppName"/&gt;
&lt;/scan&gt;</pre>
		</div>
</div></div>


<p><tt>RegistryServerDetector</tt> is called for each resource in the Windows registry that matches the scan criteria</p>


<p>It's possible to extend search to multiple root keys by ending key name with "<b>". For example "SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\MySQL</b>" only dig into subkeys of "...\Uninstall" that startWith "MySQL".</p>

<h1><a name="RegistryServerDetector-InterfaceHierarchy"></a>Interface Hierarchy</h1>

<ul>
	<li>org.hyperic.hq.product.RegistryServerDetector</li>
</ul>


<h1><a name="RegistryServerDetector-InterfaceReferences"></a>Interface References</h1>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">package org.hyperic.hq.product;
import java.util.List;
import org.hyperic.sigar.win32.RegistryKey;
import org.hyperic.util.config.ConfigResponse;</pre>
		</div>
</div></div>

<h1><a name="RegistryServerDetector-ImplementingMethods"></a>Implementing Methods</h1>

<p>This interface implements following methods:</p>

<p><b>getServerResources(ConfigResponse):List</b></p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">public List getServerResources(ConfigResponse platformConfig, String path, RegistryKey current)
throws PluginException;</pre>
		</div>
</div></div>
<p>This method is called if assosiated autodiscovery implementation is implementing this interface.</p>

<p><b>Parameters:</b><br/>
<b>&nbsp;&nbsp; platformConfig</b> Configuration for underlying platform.<br/>
<b>&nbsp;&nbsp; path</b> Value of the matched key<br/>
<b>&nbsp;&nbsp; current</b> Current registry object.</p>


<p><b>Returns:</b><br/>
&nbsp;&nbsp; List of <tt>ServerResource</tt> objects.</p>

<p><b>Throws:</b><br/>
&nbsp;&nbsp; org.hyperic.hq.product.PluginException</p>

<p><b>getRegistryScanKeys():List</b></p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">public List getRegistryScanKeys();</pre>
		</div>
</div></div>
<p>This method returns list of registry keys to scan. ServerDetector contains default implementation for this function which is requesting keys from plugin descriptor file. Example xml used in this document would result single list member "SOFTWARE\Microsoft\Internet Explorer".</p>

<p>User can implement/overwrite this method and return list of keys directly from this method.</p>

<p><b>Returns:</b><br/>
&nbsp;&nbsp; List of registry keys.</p>

<h1><a name="RegistryServerDetector-ExampleUsage"></a>Example Usage</h1>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">package hq.example;

import java.util.ArrayList;
import java.util.List;

import org.hyperic.hq.product.PluginException;
import org.hyperic.hq.product.RegistryServerDetector;
import org.hyperic.hq.product.ServerDetector;
import org.hyperic.hq.product.ServerResource;
import org.hyperic.sigar.win32.RegistryKey;
import org.hyperic.util.config.ConfigResponse;

public class CustomRegistryScanDetector
extends ServerDetector
implements RegistryServerDetector {

    /** Base PTQL query to find matching processes by full path */
    private static final String PTQL_QUERY = "State.Name.eq=iexplore";

	public List getServerResources(ConfigResponse platformConfig, String path, RegistryKey current)
			throws PluginException {
        List servers = new ArrayList();

        ConfigResponse productConfig = new ConfigResponse();

        productConfig.setValue("process.query", PTQL_QUERY);
        ServerResource server = createServerResource(path);
        setProductConfig(server, productConfig);
        server.setMeasurementConfig();
        servers.add(server);

        return servers;

	}

}</pre>
		</div>
</div></div>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: xml; gutter: false">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;plugin
   name="registryscan-example"
   package="hq.training"&gt;

      &lt;metrics
            name="multi-process-metrics"&gt;
         &lt;metric
               indicator="true"
               units="percentage"
               name="Availability"
               collectionType="dynamic"
               template="sigar:Type=MultiProcCpu,Arg=%process.query%:Availability"
               category="AVAILABILITY"&gt;
         &lt;/metric&gt;
         &lt;metric
               units="none"
               name="Number of Processes"
               alias="NumProcesses"
               collectionType="dynamic"
               template="sigar:Type=MultiProcCpu,Arg=%process.query%:Processes"
               category="UTILIZATION"&gt;
         &lt;/metric&gt;
         &lt;metric
               units="B"
               name="Memory Size"
               alias="MemSize"
               collectionType="dynamic"
               template="sigar:Type=MultiProcMem,Arg=%process.query%:Size"
               category="UTILIZATION"&gt;
         &lt;/metric&gt;
         &lt;metric
               units="B"
               name="Resident Memory Size"
               alias="ResidentMemSize"
               collectionType="dynamic"
               template="sigar:Type=MultiProcMem,Arg=%process.query%:Resident"
               category="UTILIZATION"&gt;
         &lt;/metric&gt;
         &lt;metric
               units="ms"
               name="Cpu System Time"
               alias="SystemTime"
               collectionType="trendsup"
               template="sigar:Type=MultiProcCpu,Arg=%process.query%:Sys"
               category="UTILIZATION"&gt;
         &lt;/metric&gt;
         &lt;metric
               units="ms"
               name="Cpu User Time"
               alias="UserTime"
               collectionType="trendsup"
               template="sigar:Type=MultiProcCpu,Arg=%process.query%:User"
               category="UTILIZATION"&gt;
         &lt;/metric&gt;
         &lt;metric
               units="ms"
               name="Cpu Total Time"
               alias="TotalTime"
               collectionType="trendsup"
               template="sigar:Type=MultiProcCpu,Arg=%process.query%:Total"
               category="UTILIZATION"&gt;
         &lt;/metric&gt;
         &lt;metric
               indicator="true"
               units="percentage"
               name="Cpu Usage"
               alias="Usage"
               collectionType="dynamic"
               template="sigar:Type=MultiProcCpu,Arg=%process.query%:Percent"
               category="UTILIZATION"&gt;
         &lt;/metric&gt;
      &lt;/metrics&gt;


      &lt;server name="registryscanserver"&gt;
         &lt;plugin
               type="autoinventory"
               class="CustomRegistryScanDetector"&gt;
         &lt;/plugin&gt;
         &lt;plugin
               type="measurement"
               class="org.hyperic.hq.product.MeasurementPlugin"&gt;
         &lt;/plugin&gt;
         &lt;scan registry="SOFTWARE\Microsoft\Internet Explorer"&gt;
            &lt;include name="AppName"/&gt;
         &lt;/scan&gt;
         &lt;config&gt;
            &lt;option
                  default="State.Name.eq=iexplore"
                  name="process.query"
                  description="Process Query for customserver"&gt;
            &lt;/option&gt;
         &lt;/config&gt;
         &lt;metrics
               include="multi-process-metrics"&gt;
         &lt;/metrics&gt;
      &lt;/server&gt;

&lt;/plugin&gt;</pre>
		</div>
</div></div>

<h1><a name="RegistryServerDetector-StandaloneInvocation"></a>Standalone Invocation</h1>

<p>Standalone invocation is done using &#45;m discover and &#45;p &lt;server type name&gt; options.</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false"># java -jar hq-pdk.jar
-Dplugins.include=registryscan-example
-Dlog=info
-m discover
-p registryscanserver</pre>
		</div>
</div></div>



				    
                    			    </td>
		    </tr>
	    </table>
	    <table border="0" cellpadding="0" cellspacing="0" width="100%">
			<tr>
				<td height="12" background="http://support.hyperic.com/images/border/border_bottom.gif"><img src="images/border/spacer.gif" width="1" height="1" border="0"/></td>
			</tr>
		    <tr>
			    <td align="center"><font color="grey">Document generated by Confluence on Jul 10, 2012 14:25</font></td>
		    </tr>
	    </table>
    </body>
</html>
