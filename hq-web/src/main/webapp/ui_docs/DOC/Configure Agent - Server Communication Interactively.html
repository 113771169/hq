<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <b><a href="vFabric Hyperic 4.6.html" title="vFabric Hyperic 4.6 Documentation Home">vFabric Hyperic 4.6 Documentation Home (Internal)</a> - <a href="https://www.vmware.com/support/pubs/vfabric-hyperic.html">vFabric Hyperic 4.6 Documentation Home (Online)</a> -  <a href="https://www.vmware.com/support/vfabric-hyperic/doc/vfabric-hyperic-rn-4.6.0.html">Hyperic 4.6 Release Notes</a> </b>
<p>      
<p>
        <title>vFabric Hyperic 4.6 : Configure Agent - Server Communication Interactively</title>
	    <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">	    
    </head>

    <body>
	    <table class="pagecontent" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#ffffff">
		    <tr>
			    <td valign="top" class="pagebody">
				    <div class="pageheader">
					    <span class="pagetitle">
                            vFabric Hyperic 4.6 : Configure Agent - Server Communication Interactively
                                                    </span>
				    </div>
				    <div class="pagesubheading">
					    This page last changed on Jul 28, 2011 by <font color="#0050B2">mmcgarry</font>.
				    </div>

				    <style type='text/css'>/*<![CDATA[*/
div.rbtoc1311874668778 {margin-left: 1.5em;padding: 0px;}
div.rbtoc1311874668778 ul {list-style: disc;margin-left: 0px;padding-left: 20px;}
div.rbtoc1311874668778 li {margin-left: 0px;padding-left: 0px;}

/*]]>*/</style><div class='rbtoc1311874668778'>
<ul>
    <li><a href='#ConfigureAgent-ServerCommunicationInteractively-SSLSetup'>SSL Setup</a></li>
    <li><a href='#ConfigureAgent-ServerCommunicationInteractively-StarttheHypericAgent'>Start the Hyperic Agent</a></li>
    <li><a href='#ConfigureAgent-ServerCommunicationInteractively-ConfigurationPrompts'>Configuration Prompts</a></li>
    <li><a href='#ConfigureAgent-ServerCommunicationInteractively-AboutSSLVerification'>About SSL Verification</a></li>
</ul></div>

<p>These are instructions for supplying agent configuration settings interactively the first time you start the agent.</p>

<div class='panelMacro'><table class='tipMacro'><colgroup><col width='24'><col></colgroup><tr><td valign='top'><img src="images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td><b>Agent can be configured in agent.properties file</b><br />Instead of configuring agent - server configuration properties interactively, you can specify them in the <tt>agent.properties</tt> file, as described in <a href="Configure Agent - Server Communication in Properties File.html" title="Configure Agent - Server Communication in Properties File">Configure Agent - Server Communication in Properties File</a> &#8212; preferable when you deploy a large number of agents.</td></tr></table></div>

<div class='panelMacro'><table class='warningMacro'><colgroup><col width='24'><col></colgroup><tr><td valign='top'><img src="images/icons/emoticons/forbidden.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td><b>Agent features that can <em>only</em> be configured in properties file</b><br /><ul>
	<li>You <b>must</b> configure Hyperic Agents that will manage VMware vSphere components in <tt>agent.properties</tt>; do not configure such agents interactively. For more information, see <a href="vSphere.html" title="vSphere">vSphere</a>.</li>
	<li>To configure an agent for a user-managed keystore, you <b>must</b> configure the path and password for the keystore in the agent's <tt>agent.properties</tt> file.</li>
</ul>
</td></tr></table></div>

<h1><a name="ConfigureAgent-ServerCommunicationInteractively-SSLSetup"></a>SSL Setup</h1>

<p>If you are going to configure the agent for a user-managed keystore, make sure you have completed the configuration described in <a href="Before You Start.html" title="ssl">SSL Setup</a>.</p>

<p>If you are going to configure the agent for unidirectional communications, </p>

<h1><a name="ConfigureAgent-ServerCommunicationInteractively-StarttheHypericAgent"></a>Start the Hyperic Agent</h1>

<ol>
	<li>Make sure that the Hyperic Server to which the Agent will connect is running.</li>
	<li>Start the agent from the command line under your user account.
	<ul>
		<li>On Windows, install the Hyperic Agent service, and then start it with these commands:
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">hq-agent.bat install
hq-agent.bat start</pre>
		</div>
</div></div></li>
		<li>On Unix-like platforms, assuming you have already installed, or unpacked the agent into its installation directory, enter:
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">AgentInstallationDirectory/bin/hq-agent.sh start</pre>
		</div>
</div></div></li>
	</ul>
	</li>
</ol>


<h1><a name="ConfigureAgent-ServerCommunicationInteractively-ConfigurationPrompts"></a>Configuration Prompts</h1>

<p>When the Hyperic Agent starts for the first time, it issues the prompts that follow so that it can establish communications with the Hyperic Server.</p>
<ol>
	<li><em>Should Agent communications to HQ be unidirectional [default=no]</em>
	<ul>
		<li>This prompt only appears if you are installing vFabric Hyperic. To understand this option, see <a href="Configure Unidirectional Agent - Server Communication.html" title="Configure Unidirectional Agent - Server Communication">Configure Unidirectional Agent - Server Communication</a>.</li>
	</ul>
	</li>
	<li><em>What is the HQ server IP address</em>
	<ul>
		<li>Enter the listen address of your HQ Server. The server must be running. If the server is on the same machine as the agent, you can enter localhost.</li>
		<li>If there is a firewall blocking traffic from the agent to the server, specify the address of the firewall.</li>
	</ul>
	</li>
	<li><em>Should Agent communications to HQ always be secure [default=yes]</em>.
	<ul>
		<li>Accept the default to configure Hyperic to use SSL for agent-to-server communication. (SSL configuration is strongly recommended, and <b>required</b> if you configured unidirectional communications in Step 1.)</li>
		<li>To configure Hyperic to use plain HTTP for agent-to-server communication, enter "no".</li>
	</ul>
	</li>
	<li>Next you are prompted to identify the server port where the Hyperic server listens for agent communication. Depending on whether you selected SSL in the previous step, one of the following prompts appears:
	<ul>
		<li><em>What is the secure HQ server port [default=7443]</em> &#8212; If the Hyperic Server is configured to listen for SSL communications on the default SSL port of 7443, press <b>Return</b>.</li>
		<li><em>What is the HQ server port [default=7080]</em> &#8212; If the Hyperic Server is configured to listen on the default port of 7080, press <b>Return</b>. If there is a firewall blocking traffic from the agent to the server, configure it to forward traffic on TCP port 7080 (or 7443) to the host running the Hyperic Server.</li>
	</ul>
	</li>
	<li><em>What is your HQ login [default=hqadmin]:</em>
	<ul>
		<li>By default, the Hyperic server is initially configured with an administrative account with username hqadmin. Unless you have configured a different Hyperic user account for agent-server communications, accept the default.</li>
	</ul>
	</li>
	<li><em>What is your HQ password</em>
	<ul>
		<li>Enter the password for the username you supplied at the previous prompt. If you accepted the default admin user password when installing the Hyperic Server, the password is <tt>hqadmin</tt>.</li>
	</ul>
	</li>
	<li><em>What IP should HQ use to contact the agent [default=n.n.n.n]</em>
	<ul>
		<li>The prompt will show default that is the IP address the agent detected on the host.</li>
		<li>If there is another IP address on the host you prefer to use, enter it.</li>
		<li>If there is a firewall blocking traffic from the server to the agent, enter the IP address of the firewall, and configure the firewall to forward traffic intended for the Hyperic Agent to the listen address of the agent host.</li>
	</ul>
	</li>
	<li><em>What port should HQ use to contact the agent [default=2144]</em>
	<ul>
		<li>Enter the agent port the Hyperic Server should use when it initiates contact with the agent. The value you supply to this prompt should be the port that the agent binds to at startup, which by default is 2144.</li>
		<li>If youe have previously edited <tt>agent.properties</tt> to explicitly define a different listen port, using the optional <tt>agent.listenPort</tt> property, that is the value you should supply to this prompt.</li>
		<li>If there is a firewall blocking traffic from the server to the agent, configure the device to forward traffic on TCP port 2144 to the Hyperic Agent.</li>
	</ul>
	</li>
</ol>


<p>Messages similar to the following are displayed upon successful startup of an agent.</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">Received temporary auth token from agent
Registering agent with HQ
HQ gave us the following agent token
1215038691323-8570363106994871928-8259195015465958356
Informing agent of new HQ server
Validating
Successfully setup agent</pre>
		</div>
</div></div>
<h1><a name="ConfigureAgent-ServerCommunicationInteractively-AboutSSLVerification"></a>About SSL Verification </h1>
<p><a name="ConfigureAgent-ServerCommunicationInteractively-verification"></a></p>

<p>When the Hyperic 4.6 server and Hyperic 4.6 Agents communicate over SSL, each component validates the other's SSL certificate.</p>

<p>The first time an agent initiates a connection to the Hyperic Server (the first time you start the agent after installation), the server presents its SSL certificate to the agent. If the agent trusts the certificate that the server presented, the agent imports the server's certificate into its own keystore.</p>

<div class='panelMacro'><table class='infoMacro'><colgroup><col width='24'><col></colgroup><tr><td valign='top'><img src="images/icons/emoticons/information.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td><b>How the Agent Decides to Trust the Server's Certificate</b><br />The agent trusts a server certificate:
<ul>
	<li>if that certificate already exists in the agent's keystore, or</li>
	<li>if the certificate has the same CA as the agent's certificate.</li>
</ul>
</td></tr></table></div>

<p>By default, if the agent does not trust the certificate presented by the server, the agent issues this warning:  </p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">The authenticity of host 'ServerHost' can't be established. Are you sure you want to continue connecting? [default=no]:</pre>
		</div>
</div></div>

<p>If this warning is issued, for strongest security, press <b>Return</b> to terminate the agent configuration process. Before re-starting the agent configuration process, obtain an SSL certificate for the agent, and one for the server, both signed by the same trusted CA. Then follow the instructions in <a href="Before You Start.html#BeforeYouStart-ssl">SSL Setup</a></p>

<p>If, instead of terminating the agent-server connection process, you enter "yes" to continue the agent configuration process, the agent will import the untrusted certificate presented by the Hyperic Server.*</p>

<div class='panelMacro'><table class='warningMacro'><colgroup><col width='24'><col></colgroup><tr><td valign='top'><img src="images/icons/emoticons/forbidden.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td><b>Are Server and Agent Configured to Accept Untrusted Certs?</b><br />By default, the Hyperic Server and the Hyperic Agent do not import untrusted certificates unless you explicitly respond yes to the warning prompt described above. Note, however that both components can be configured to accept untrusted certificates automatically, with no warning. For security reasons, this practice is strongly discouraged. Check the values of <tt>agent.setup.acceptUnverifiedCertificate</tt> (in <tt>AgentHome/conf/agent.properties</tt>) and <tt>accept.unverified.certificates</tt> in {{ServerHome/conf/hq-server.conf)) :</td></tr></table></div>



<p>If you configured SSL with self-signed certs, the following message appears:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">The server to agent communication channel is using a self-signed certificate and could not be verified
Are you sure you want to continue connecting? [default=no]: yes</pre>
		</div>
</div></div>
<p><font color=""></font></p>

				    
                    			    </td>
		    </tr>
	    </table>
	    <table border="0" cellpadding="0" cellspacing="0" width="100%">
			<tr>
				<td height="12" background="http://support.hyperic.com/images/border/border_bottom.gif"><img src="images/border/spacer.gif" width="1" height="1" border="0"/></td>
			</tr>
		    <tr>
			    <td align="center"><font color="grey">Document generated by Confluence on Jul 29, 2011 14:43</font></td>
		    </tr>
	    </table>
    </body>
</html>
