<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
    <head>
        <title>vFabric Hyperic 4.6.5 : HQApi maintenance command</title>
	    <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">	    
    </head>

    <body>
	    <table class="pagecontent" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#ffffff">
		    <tr>
			    <td valign="top" class="pagebody">
				    <div class="pageheader">
					    <span class="pagetitle">
                            vFabric Hyperic 4.6.5 : HQApi maintenance command
                                                    </span>
				    </div>
				    <div class="pagesubheading">
					    This page last changed on Jan 04, 2012 by <font color="#0050B2">mmcgarry</font>.
				    </div>

				    <p><font color="gray"><em>Topics marked with</em></font> <font color="red">*</font> <font color="gray"><em>relate to features available only in vFabric Hyperic.</em></font></p>


<style type='text/css'>/*<![CDATA[*/
div.rbtoc1325699167261 {margin-left: 1.5em;padding: 0px;}
div.rbtoc1325699167261 ul {list-style: disc;margin-left: 0px;padding-left: 20px;}
div.rbtoc1325699167261 li {margin-left: 0px;padding-left: 0px;}

/*]]>*/</style><div class='rbtoc1325699167261'>
<ul>
    <li><a href='#HQApimaintenancecommand-Functionality'>Functionality</a></li>
    <li><a href='#HQApimaintenancecommand-maintenanceCommandOptions'>maintenance Command Options</a></li>
<ul>
    <li><a href='#HQApimaintenancecommand-maintenanceschedule'>maintenance schedule</a></li>
    <li><a href='#HQApimaintenancecommand-maintenanceunschedule'>maintenance unschedule</a></li>
    <li><a href='#HQApimaintenancecommand-maintenanceget'>maintenance get</a></li>
</ul>
    <li><a href='#HQApimaintenancecommand-Examples'>Examples</a></li>
<ul>
    <li><a href='#HQApimaintenancecommand-maintenanceschedule'>maintenance schedule</a></li>
    <li><a href='#HQApimaintenancecommand-maintenanceget'>maintenance get</a></li>
    <li><a href='#HQApimaintenancecommand-maintenanceunschedule'>maintenance unschedule</a></li>
</ul>
    <li><a href='#HQApimaintenancecommand-SampleScriptforSchedulingRecurringMaintenance'>Sample Script for Scheduling Recurring Maintenance</a></li>
<ul>
    <li><a href='#HQApimaintenancecommand-Usinggroupmaintenanceapi.pl'>Using group_maintenance_api.pl</a></li>
<ul>
    <li><a href='#HQApimaintenancecommand-SetEnvironmentVariables'>Set Environment Variables</a></li>
    <li><a href='#HQApimaintenancecommand-ScheduleMaintenanceforaGroup'>Schedule Maintenance for a Group</a></li>
    <li><a href='#HQApimaintenancecommand-CheckMaintenanceSchedule'>Check Maintenance Schedule</a></li>
    <li><a href='#HQApimaintenancecommand-CancelaMaintenanceSchedule'>Cancel a Maintenance Schedule</a></li>
</ul>
    <li><a href='#HQApimaintenancecommand-SetUpaRecurringMaintenanceSchedule'>Set Up a Recurring Maintenance Schedule</a></li>
<ul>
    <li><a href='#HQApimaintenancecommand-UseTimeOnlyforStartandEndArguments'>Use Time Only for Start and End Arguments</a></li>
    <li><a href='#HQApimaintenancecommand-TipWraptheScriptInvocation'>Tip - Wrap the Script Invocation</a></li>
</ul>
</ul>
</ul></div>

<div class='panelMacro'><table class='tipMacro'><colgroup><col width='24'><col></colgroup><tr><td valign='top'><img src="images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td><b>Related Topics</b><br />This page provides information for running an HQ API from the command line. Related topics include: 
<ul>
	<li><a href="vFabric Hyperic Web Services API.html" title="vFabric Hyperic Web Services API">vFabric Hyperic Web Services API</a> - brief introduction to the API.</li>
	<li><a href="HQApi Command-Line Tools.html" title="HQApi Command-Line Tools">HQApi Command&#45;Line Tools</a> - how to get started with the command line tools.</li>
	<li><a href="HQApi Java API.html" title="HQApi Java API">HQApi Java API</a> - about accessing the APIs programmatically.</li>
</ul>
</td></tr></table></div> 



<h1><a name="HQApimaintenancecommand-Functionality"></a>Functionality</h1>

<p>You can use the <b>maintenance</b> command to schedule downtime for a resource or a group of resources &#8212; it is the command line equivalent of vFabric Hyperic's <b>Schedule Downtime</b> feature, available in the <b>Tools</b> menu when a resource or a group is selected. At the start of the downtime period, currently active alert definitions for the specified resource(s) in the group are disabled. At the end of the period, those alert definitions are re-enabled.</p>

<p><b>Note:</b> Only a Hyperic user with the Super User role may schedule downtime.<font color=""></font></p>

<h1><a name="HQApimaintenancecommand-maintenanceCommandOptions"></a>maintenance Command Options</h1>

<h2><a name="HQApimaintenancecommand-maintenanceschedule"></a>maintenance schedule</h2>

<p>The <b>maintenance schedule</b> command defines a period of downtime for a specified resource or resource group. Command qualifiers include:</p>
<div class='table-wrap'>
<table class='confluenceTable'><tbody>
<tr>
<th class='confluenceTh'> Qualifier </th>
<th class='confluenceTh'> <b>Description</b> </th>
<th class='confluenceTh'> <b>Required</b> </th>
</tr>
<tr>
<td class='confluenceTd'> &#45;-groupId </td>
<td class='confluenceTd'> Specifies the internal ID for the group for which maintenance is being scheduled, for example, <tt>&#45;-groupId="10007"</tt> </td>
<td class='confluenceTd'>Required if <tt>--resourceId</tt> is not specified.</td>
</tr>
<tr>
<td class='confluenceTd'>--resourceId </td>
<td class='confluenceTd'>Specifies the internal ID of the resource for which maintenance is being scheduled. </td>
<td class='confluenceTd'> Required if <tt>--groupId</tt>  is not specified.</td>
</tr>
<tr>
<td class='confluenceTd'> &#45;-start </td>
<td class='confluenceTd'> Specifies the start date and time for the downtime window, for example, <tt>start="8/20/09 3:00 PM"</tt> </td>
<td class='confluenceTd'>yes </td>
</tr>
<tr>
<td class='confluenceTd'> &#45;-end </td>
<td class='confluenceTd'> Specifies the end date and time for the downtime window, for example, <tt>end="8/20/09 4:00 PM"</tt> </td>
<td class='confluenceTd'>yes </td>
</tr>
</tbody></table>
</div>


<h2><a name="HQApimaintenancecommand-maintenanceunschedule"></a>maintenance unschedule</h2>

<p>The <b>maintenance unschedule</b> command removes the currently scheduled downtime for a specified resource or resource group. </p>
<div class='table-wrap'>
<table class='confluenceTable'><tbody>
<tr>
<th class='confluenceTh'> Qualifier </th>
<th class='confluenceTh'> <b>Description</b> </th>
<th class='confluenceTh'> <b>Required</b> </th>
</tr>
<tr>
<td class='confluenceTd'> &#45;-groupId </td>
<td class='confluenceTd'> Specifies the internal ID for the group, for example, <tt>&#45;-groupId="10007"</tt> </td>
<td class='confluenceTd'> Required if <tt>--resourceId</tt>  is not specified.</td>
</tr>
<tr>
<td class='confluenceTd'>--resourceId </td>
<td class='confluenceTd'>Specifies the internal ID of the resource for which maintenance is being unscheduled. </td>
<td class='confluenceTd'> Required if <tt>--groupId</tt>  is not specified.</td>
</tr>
</tbody></table>
</div>


<h2><a name="HQApimaintenancecommand-maintenanceget"></a>maintenance get</h2>

<p>The <b>maintenance get</b> command returns a downtime schedule for a resource, a resource group, or all resources and resource groups. You must supply one of the following command qualifiers:</p>
<div class='table-wrap'>
<table class='confluenceTable'><tbody>
<tr>
<th class='confluenceTh'> Qualifier </th>
<th class='confluenceTh'> <b>Description</b> </th>
</tr>
<tr>
<td class='confluenceTd'> &#45;-all </td>
<td class='confluenceTd'> Returns all maintenance schedulesSpecifies the internal ID for the resource</td>
</tr>
<tr>
<td class='confluenceTd'> &#45;-groupId </td>
<td class='confluenceTd'> Specifies the internal ID for the group, for example, <tt>&#45;-groupId="10007"</tt> </td>
</tr>
<tr>
<td class='confluenceTd'> &#45;-resourceId </td>
<td class='confluenceTd'> Specifies the internal ID for the resource</td>
</tr>
</tbody></table>
</div>


<p>Results are returned in this form:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">Maintenance schedule for group 10007
State: new
Start Time: 8/20/09 3:00 PM
End Time: 8/20/09 4:30 PM</pre>
		</div>
</div></div>

<h1><a name="HQApimaintenancecommand-Examples"></a>Examples</h1>


<h2><a name="HQApimaintenancecommand-maintenanceschedule"></a>maintenance schedule</h2>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">$ sh hqapi.sh maintenance schedule --groupId="10007" --start="8/20/09 3:00 PM" --end="8/20/09 4:30 PM"
Maintenance scheduled for group 10007</pre>
		</div>
</div></div>

<h2><a name="HQApimaintenancecommand-maintenanceget"></a>maintenance get</h2>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">$ sh hqapi.sh maintenance get --groupId="10007"
Maintenance scheudle for group 10007
State: new
Start Time: 8/20/09 3:00 PM
End Time: 8/20/09 4:30 PM</pre>
		</div>
</div></div>

<h2><a name="HQApimaintenancecommand-maintenanceunschedule"></a>maintenance unschedule</h2>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">$ sh hqapi.sh maintenance unschedule --groupId="10007"
Maintenance for group 10007 unscheduled.</pre>
		</div>
</div></div>

<h1><a name="HQApimaintenancecommand-SampleScriptforSchedulingRecurringMaintenance"></a>Sample Script for Scheduling Recurring Maintenance</h1>
<p><a name="HQApimaintenancecommand-restful"></a></p>

<p>If you need to perform an API function multiple times to automate a task, you can call it programmatically rather than using its command line interface.  You can use a program to directly invoke the API's Java methods directly or invoke GET/POST methods against the RESTful web service that exposes the API on the Hyperic Server.</p>

<p>The script attached to this page, <tt><a href="attachments/79036955/79134752.pl">group_maintenance_api.pl</a></tt>, is an example of the latter method. This script accesses the web service that exposes the <tt>maintenance</tt> API to set a maintenance window for a group.</p>

<p>Perl was chosen for the example for its multi-platform support and flexibility in working with XML. Other scripting languages might also be used to solve the same problem.</p>

<h2><a name="HQApimaintenancecommand-Usinggroupmaintenanceapi.pl"></a>Using group_maintenance_api.pl</h2>

<p>You can use the <tt>group_maintenance_api.pl</tt> script to schedule, check, and delete a maintenance schedule for a group of resources.</p>

<h3><a name="HQApimaintenancecommand-SetEnvironmentVariables"></a>Set Environment Variables</h3>

<p>Edit <tt>group_maintenance_api.pl</tt> to set the values of the following variables to match your environment.</p>

<ul>
	<li><tt>$hq_server</tt></li>
	<li><tt>$username</tt></li>
	<li><tt>$password</tt></li>
</ul>


<h3><a name="HQApimaintenancecommand-ScheduleMaintenanceforaGroup"></a>Schedule Maintenance for a Group</h3>

<p>The command syntax to schedule a maintenance interval for a group of resources is:</p>

<p><tt>group_maintenance_api.pl set "GroupName" "Start" "End"</tt></p>

<p>where:</p>

<ul>
	<li><tt>GroupName</tt> is the name of the group as it appears in the Hyperic user interface.</li>
	<li><tt>Start</tt> is a time, or a date and time in standard date format. If you set <tt>Start</tt> to a time, without specifying a date, the date defaults to the date following the the current one.</li>
	<li><tt>End</tt> is a time, or a date and time in standard date form. If you set <tt>Start</tt> to a time, without specifying a date, the date defaults to the date following the the current one.</li>
</ul>


<p>The following invocation, which specifies date <b>and</b> time for the start and end of the maintenance interval, schedules a maintenance window from 3 PM to 4 PM on 10/20/09, for the resources in the group named "HQ Agents":</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">group_maintenance_api.pl set "HQ Agents" "10/20/09 3:00 PM" "10/20/09 4:00 PM"</pre>
		</div>
</div></div>

<p>When the script is run with <b>only</b> time for the the start and end of the maintenance interval, the maintenance window is scheduled for 3 PM to 4 PM on the following day:</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">group_maintenance_api.pl set "HQ Agents" "3:00 PM" "4:00 PM"</pre>
		</div>
</div></div>

<h3><a name="HQApimaintenancecommand-CheckMaintenanceSchedule"></a>Check Maintenance Schedule</h3>

<p>The command syntax to check the currently scheduled maintenance interval for a group of resources is:</p>

<p><tt>group_maintenance_api.pl get "GroupName"</tt></p>

<p>For example, this command:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">group_maintenance_api.pl get "HQ Agents"</pre>
		</div>
</div></div>

<p>returns:</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">Status: Success
Start time: Wed Oct 20 15:00:00 2009
End time: Wed Oct 28 16:00:00 2009</pre>
		</div>
</div></div>

<h3><a name="HQApimaintenancecommand-CancelaMaintenanceSchedule"></a>Cancel a Maintenance Schedule</h3>

<p>The command syntax to cancel the currently scheduled maintenance interval for a group of resources is:</p>

<p><tt>group_maintenance_api.pl unset "GroupName"</tt></p>

<p>Where <tt>GroupName</tt> is the name of a group.</p>

<h2><a name="HQApimaintenancecommand-SetUpaRecurringMaintenanceSchedule"></a>Set Up a Recurring Maintenance Schedule</h2>

<p>The examples in the previous section schedule a single maintenance window. To schedule a recurring maintenance interval - daily, weekly, or monthly - use your operating system's scheduling facility to run <tt>group_maintenance_api.pl</tt> on a periodic basis.</p>

<h3><a name="HQApimaintenancecommand-UseTimeOnlyforStartandEndArguments"></a>Use Time Only for Start and End Arguments</h3>

<p>A scheduled invocation of <tt>group_maintenance_api.pl</tt> should use time, but no date, for the start and end of the maintenance interval. When you run <tt>group_maintenance_api.pl</tt> with time only, the maintenance date is the following day (the day after the command was run).</p>

<p>For example, to set a maintenance window for the "HQ Agents" group for every Sunday from 12 PM to 2 PM, schedule this command to run every Saturday:</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">group_maintenance_api.pl set "HQ Agents" "12:00 PM" "2:00 PM"</pre>
		</div>
</div></div>

<h3><a name="HQApimaintenancecommand-TipWraptheScriptInvocation"></a>Tip - Wrap the Script Invocation</h3>

<p>Because <tt>group_maintenance_api.pl</tt> takes arguments in quotation signs, you may find it more convenient and robust to wrap the command invocation in another script, and schedule that script for periodic execution.</p>

<p>For example, you can put the command in a batch script like this:</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">REM============================================================================
@ECHO OFF
PATH_TO_SCRIPT\group_maintenance_api.pl set "HQ Agents" "12:00 PM" "2:00 PM"
REM============================================================================</pre>
		</div>
</div></div>

<p><b>Note:</b> Using a wrapper is simply a method to ensure quotation marks survive the scheduling process. Some schedulers break commands by stripping quotation marks (") from them upon scheduling.</p>

				    					    <br/>
                        <div class="tabletitle">
                            <a name="attachments">
                                <h2>Attachments:</h2>
                            </a>
                        </div>

                        <div class="greybox" align="left">
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/79036955/79134752.pl">group_maintenance_api.pl</a> (text/x-perl-script)
                                <br/>
                                                    </div>
				    
                    			    </td>
		    </tr>
	    </table>
	    <table border="0" cellpadding="0" cellspacing="0" width="100%">
			<tr>
				<td height="12" background="http://support.hyperic.com/images/border/border_bottom.gif"><img src="images/border/spacer.gif" width="1" height="1" border="0"/></td>
			</tr>
		    <tr>
			    <td align="center"><font color="grey">Document generated by Confluence on Jan 24, 2012 14:51</font></td>
		    </tr>
	    </table>
    </body>
</html>
