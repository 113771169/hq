<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
    <head>
        <title>Hyperic 4.6 Documentation : Agent Launcher and Agent Startup</title>
	    <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">	    
    </head>

    <body>
	    <table class="pagecontent" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#ffffff">
		    <tr>
			    <td valign="top" class="pagebody">
				    <div class="pageheader">
					    <span class="pagetitle">
                            Hyperic 4.6 Documentation : Agent Launcher and Agent Startup
                                                    </span>
				    </div>
				    <div class="pagesubheading">
					    This page last changed on Jun 07, 2011 by <font color="#0050B2">mmcgarry</font>.
				    </div>

				    <style type='text/css'>/*<![CDATA[*/
div.rbtoc1307466640863 {margin-left: 1.5em;padding: 0px;}
div.rbtoc1307466640863 ul {list-style: disc;margin-left: 0px;padding-left: 20px;}
div.rbtoc1307466640863 li {margin-left: 0px;padding-left: 0px;}

/*]] >*/</style><div class='rbtoc1307466640863'>
<ul>
    <li><a href='#AgentLauncherandAgentStartup-AgentLauncher'>Agent Launcher</a></li>
    <li><a href='#AgentLauncherandAgentStartup-WhatHappensWhenanAgentStartsUp'>What Happens When an Agent Starts Up</a></li>
    <li><a href='#AgentLauncherandAgentStartup-AutomaticRestartBehavior'>Automatic Restart Behavior</a></li>
</ul></div> 
<p>This section describes the HQ Agent launcher and the agent startup process. </p>

<div class='panelMacro'><table class='tipMacro'><colgroup><col width='24'><col></colgroup><tr><td valign='top'><img src="images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td><b>Don't Need the Background Explanation?</b><br />See:
<ul>
	<li><a href="Start, Stop, and Other Agent Operations.html" title="Start, Stop, and Other Agent Operations">Start, Stop, and Other Agent Operations</a></li>
	<li><a href="Configure Agent - Server Communication.html" title="Configure Agent - Server Communication">Configure Agent &#45; Server Communication</a></li>
</ul>
</td></tr></table></div> 

<h1><a name="AgentLauncherandAgentStartup-AgentLauncher"></a>Agent Launcher </h1>

<p>The HQ Agent launcher is based on the Java Service Wrapper (JSW), a configurable tool that allows Java applications to be run as an NT service or Unix daemon process. It includes fault correction software to automatically restart crashed or frozen JVMs. </p>

<p>JSW runs as a native executable; it invokes and monitors the HQ Agent's JVM, based on configuration information provided to the wrapper at startup. In this way, the wrapper supports restarts of the JVM process without stopping the wrapper process itself. The JSW process acts as a watchdog for the JVM process, periodically pinging it for availability. </p>

<p>For more information about the features of the Java Services Wrapper, and how to configure its behavior, see <a href="http://wrapper.tanukisoftware.org/doc/english/download.jsp">http://wrapper.tanukisoftware.org/doc/english/download.jsp</a>.</p>


<h1><a name="AgentLauncherandAgentStartup-WhatHappensWhenanAgentStartsUp"></a>What Happens When an Agent Starts Up </h1>

<p>An HQ Agent needs to know how to connect to the HQ Server, and the HQ Server needs to know how to connect to the HQ Agent &#8212; each component needs the IP address and listen port (and other connection properties) to use to establish a connection with the other. You must provide this information the first time an agent starts up after installation. </p>

<p>There are two ways to provide the agent-server connection properties:</p>

<ul>
	<li>In <tt>agent.properties</tt> &#8212; Before starting the agent for the first time, configure the HQ Server connection properties in the <tt>agent.properties</tt> for the agent, as described in <a href="Configure Agent - Server Communication in Properties File.html" title="Configure Agent - Server Communication in Properties File">Configure Agent &#45; Server Communication in Properties File</a>. When you start the agent, it will read the connection data from <tt>agent.properties</tt>. This configuration method is preferable if you have many agents to install, as it speeds the process and reduces the chance of error.</li>
</ul>


<ul>
	<li>Interactively &#8212; If you do not configure the HQ Server connection properties in the <tt>agent.properties</tt> for the agent, upon startup, the agent prompt for the properties in the command shell, as described in <a href="Configure Agent - Server Communication Interactively.html" title="Configure Agent - Server Communication Interactively">Configure Agent &#45; Server Communication Interactively</a>.</li>
</ul>


<p>When you start an HQ Agent: </p>

<ol>
	<li>The agent checks to see if there is a <tt>/data</tt> directory that contains the HQ Server's connection properties.
	<ul>
		<li>At first startup, the <tt>/data</tt> directory will not exist &#8212; it is created after the first successful connection between agent and server is established.</li>
		<li>If the agent finds the connection properties, it tries to connect to the HQ Server - see step 5 below.</li>
	</ul>
	</li>
	<li>If the agent did not find the <tt>/data</tt> directory, it looks for an <tt>agent.properties</tt> file in a hidden directory named <tt>.hq</tt> in the home directory of the user that runs the agent.
	<ul>
		<li>This directory will not exist unless you have previously created it. This location for the properties file is supported to ensure configuration data is not lost in the event that the complete agent installation is overwritten in an upgrade.</li>
		<li>If the agent finds the connection properties, it tries to connect to the HQ Server - see step 5 below.</li>
	</ul>
	</li>
	<li>If the agent did not find the agent-server connection properties in an <tt>agent.properties</tt> file in the hidden <tt>/.hq</tt> directory, it looks at the <tt>agent.properties</tt> file in its <tt>/conf</tt> directory.
	<ul>
		<li>If the agent finds the connection properties, it tries to connect to the HQ Server - see step 5 below.</li>
	</ul>
	</li>
	<li>If the agent did not find connection properties in the{{agent.properties}} file in its <tt>/conf</tt> directory, it prompts for the properties to be supplied interactively in the command shell.</li>
	<li>Upon obtaining the agent-server connection properties, the agent attempts to connect to the HQ Server.</li>
	<li>Once communications between agent and server have been succesfully established:
	<ul>
		<li>The agent saves the HQ Server connection settings in <tt>AgentHome/data</tt>.</li>
		<li>The HQ Server saves the HQ Agent's connection settings in the HQ database.</li>
	</ul>
	</li>
</ol>


<h1><a name="AgentLauncherandAgentStartup-AutomaticRestartBehavior"></a>Automatic Restart Behavior </h1>

<p>As described above, JSW process periodically pings the agent JVM process. </p>

<p>If the JVM process exits with a non-zero exit code, indicating the JVM is hung or crashed, the JSW will restarts the JVM process. Messages in the Agent and JSW logs indicate that the JSW has restarted the Agent.I f the JSW cannot restart the JVM process, it will try again, up to a total of five times. You can configure different actions for the JSW, including the action it takes upon a particular JVM process exit code, and the number of times that it will attempt to restart the process. </p>

<div class="scroll-pagebreak"></div>

				    
                    			    </td>
		    </tr>
	    </table>
	    <table border="0" cellpadding="0" cellspacing="0" width="100%">
			<tr>
				<td height="12" background="http://support.hyperic.com/images/border/border_bottom.gif"><img src="images/border/spacer.gif" width="1" height="1" border="0"/></td>
			</tr>
		    <tr>
			    <td align="center"><font color="grey">Document generated by Confluence on Jun 22, 2011 15:14</font></td>
		    </tr>
	    </table>
    </body>
</html>
