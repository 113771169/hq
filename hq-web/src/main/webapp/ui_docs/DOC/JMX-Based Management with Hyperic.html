<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
    <head>
        <title>vFabric Hyperic 5.7 : JMX-Based Management with Hyperic</title>
	    <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">	    
    </head>

    <body>
<b><a href="vFabric Hyperic 5.7.html" title="vFabric Hyperic 5.7 Documentation Home">vFabric Hyperic 5.7 Documentation Home (Internal)</a>
 - <a href="https://www.vmware.com/support/pubs/vfabric-hyperic.html">vFabric Hyperic 5.7 Documentation Home (Online)</a>
 -  <a href="https://www.vmware.com/support/vfabric-hyperic/doc/vfabric-hyperic-rn-5.7.html">Hyperic 5.7 Release Notes</a> </b>
 <p>
 <p>
	    <table class="pagecontent" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#ffffff">
		    <tr>
			    <td valign="top" class="pagebody">
				    <div class="pageheader">
					    <span class="pagetitle">
                            vFabric Hyperic 5.7 : JMX-Based Management with Hyperic
                                                    </span>
				    </div>
				    <div class="pagesubheading">
					    This page last changed on Feb 16, 2012 by <font color="#0050B2">mmcgarry</font>.
				    </div>

				    <style type='text/css'>/*<![CDATA[*/
div.rbtoc1329434122854 {margin-left: 1.5em;padding: 0px;}
div.rbtoc1329434122854 ul {list-style: disc;margin-left: 0px;padding-left: 20px;}
div.rbtoc1329434122854 li {margin-left: 0px;padding-left: 0px;}

/*]] >*/</style><div class='rbtoc1329434122854'>
<ul>
    <li><a href='#JMX-BasedManagementwithHyperic-Introduction'>Introduction</a></li>
    <li><a href='#JMX-BasedManagementwithHyperic-JMXResourcesantheHypericInventoryModel'>JMX Resources an the Hyperic Inventory Model</a></li>
    <li><a href='#JMX-BasedManagementwithHyperic-AutoDiscoveryofJMXResources'>Auto-Discovery of JMX Resources</a></li>
    <li><a href='#JMX-BasedManagementwithHyperic-IdentifyTargetMBeansandAttributes'>Identify Target MBeans and Attributes</a></li>
    <li><a href='#JMX-BasedManagementwithHyperic-ConfigurationPropertiesRequiredforJMXMonitoring'>Configuration Properties Required for JMX Monitoring</a></li>
    <li><a href='#JMX-BasedManagementwithHyperic-CreateaCustomJMXPlugin'>Create a Custom JMX Plugin</a></li>
<ul>
    <li><a href='#JMX-BasedManagementwithHyperic-DefiningServiceTypestoProvideManagementviaCustomMBeans'>Defining Service Types to Provide Management via Custom MBeans</a></li>
    <li><a href='#JMX-BasedManagementwithHyperic-DefininganObjectNametoAccessCustomMBeans'>Defining an ObjectName to Access Custom MBeans</a></li>
    <li><a href='#JMX-BasedManagementwithHyperic-DefiningConfigurationPropertiestoBeDisplayedintheUI'>Defining Configuration Properties to Be Displayed in the UI</a></li>
    <li><a href='#JMX-BasedManagementwithHyperic-DefiningandGatheringMetrics'>Defining and Gathering Metrics</a></li>
    <li><a href='#JMX-BasedManagementwithHyperic-SpecifyingAvailabilityMetricforMBeans'>Specifying Availability Metric for MBeans</a></li>
    <li><a href='#JMX-BasedManagementwithHyperic-ImplementingControlActions'>Implementing Control Actions</a></li>
    <li><a href='#JMX-BasedManagementwithHyperic-DefineServerAutoInventoryElement'>Define Server Auto-Inventory Element</a></li>
<ul>
    <li><a href='#JMX-BasedManagementwithHyperic-DiscoveringCustomProperties'>Discovering Custom Properties</a></li>
</ul>
    <li><a href='#JMX-BasedManagementwithHyperic-ImplementingLogandConfigTracking'>Implementing Log and Config Tracking</a></li>
</ul>
    <li><a href='#JMX-BasedManagementwithHyperic-ExampleCustomMBeanPlugins'>Example Custom MBean Plugins</a></li>
</ul></div>

<h1><a name="JMX-BasedManagementwithHyperic-Introduction"></a>Introduction </h1>

<p>This page has information about the Hyperic PDK's support for managing and monitoring JMX-enabled applications. Hyperic has a number of built-in plugins that monitor specific JMX products, including   </p>

<ul>
	<li>Sun JVM 1.5</li>
	<li>ActiveMQ 4.0</li>
	<li>Geronimo 1.0</li>
	<li>Resin 3.0</li>
	<li>JOnAS 4.7</li>
</ul>


<p>Hyperic uses the remote API (<a href="http://www.jcp.org/en/jsr/detail?id=160">http://www.jcp.org/en/jsr/detail?id=160</a>) specified by JSR-160 to manage products that support JMX 1.2/JSR-160, including the ones listed above. For JMX-enabled servers that do not support JSR-160, Hyperic uses vendor-specific connectors.  </p>

<p>Hyperic's JMX support classes enable auto-discovery of MBean servers and MBeans, collection of MBean attributes, and execution of MBean operations. </p>

<p>To enable monitoring, you must configure the target JMX-enabled to accept remote connections. In many cases, the remote connector enabled by default, otherwise, you must configure it for remote access.</p>

<ul>
	<li>J2SE 1.5 &#8212; <a href="http://download.oracle.com/javase/1.5.0/docs/api/javax/management/remote/package-summary.html">http://download.oracle.com/javase/1.5.0/docs/api/javax/management/remote/package-summary.html</a></li>
	<li>MX4J &#8212; <a href="http://mx4j.sourceforge.net/docs/ch03.html">http://mx4j.sourceforge.net/docs/ch03.html</a></li>
	<li>ActiveMQ &#8212; <a href="http://activemq.apache.org/jmx.html">http://activemq.apache.org/jmx.html</a></li>
	<li>JOnAS &#8212; See <a href="http://jonas.objectweb.org/current/doc/doc-en/integrated/howto/JSR160_support.html#JSR160_support">http://jonas.objectweb.org/current/doc/doc-en/integrated/howto/JSR160_support.html#JSR160_support</a></li>
	<li>ServiceMix &#8212; See <a href="http://servicemix.apache.org/jmx-console.html">http://servicemix.apache.org/jmx-console.html</a></li>
</ul>



<h1><a name="JMX-BasedManagementwithHyperic-JMXResourcesantheHypericInventoryModel"></a>JMX Resources an the Hyperic Inventory Model</h1>

<p>A JMX-compliant application or server is represented as a server type in terms of the Hyperic Inventory Model. An MBean is represented as a service type.</p>

<h1><a name="JMX-BasedManagementwithHyperic-AutoDiscoveryofJMXResources"></a>Auto-Discovery of JMX Resources</h1>

<p>Hyperic discovers a JMX application or server using a Sigar process query. MBeans are discovered by querying the MBean Server for MBeans whose names match those configured in the plguin descripter.  connecting to the  by successfully connecting the JMX URL configured for the target instanceuses Sigar process queries and file scans to dicover JMX servers. Services are discovered via MBean Server queries (<tt>MBeanServer.queryMBeans()</tt>) </p>

<ul>
	<li>Measurement &#8212;  <tt>MxMeasurement</tt> uses Sigar queries for process metrics. Metrics that map to MBean attributes are obtained via MBean query (<tt>MBeanServer.getAttribute()</tt>).</li>
</ul>


<ul>
	<li>Control &#8212;  <tt>MxControl</tt> uses  <tt>MBeanServer.invoke()</tt>, <tt>MBeanServer.setAttribute()</tt>, scripts, SCM</li>
</ul>




<p><b>Note:</b>  <b>Sun JVM 1.5</b> type applies to any of the above and any other JMX-enable server running under a Sun 1.5 JVM but has its own set of metrics and control actions.  Unlike the other server types, <b>Sun JVM 1.5</b> instances are not currently auto-discovered.</p>


<h1><a name="JMX-BasedManagementwithHyperic-IdentifyTargetMBeansandAttributes"></a>Identify Target MBeans and Attributes</h1>
<p><a name="JMX-BasedManagementwithHyperic-attributes"></a><br/>
Identify the MBeans you want to manage. The target MBeans will be represented in Hyperic by a services that are children of the server resource that represents the monitored JMX application. </p>

<p>You can use an MBean browser, such as JConsole (<a href="http://download.oracle.com/javase/1.5.0/docs/guide/management/jconsole.html">http://download.oracle.com/javase/1.5.0/docs/guide/management/jconsole.html</a>) or MC4J (<a href="http://sourceforge.net/projects/mc4j/">http://sourceforge.net/projects/mc4j/</a>).</p>

<p>Hyperic JMX support classes also provide a command line tool to dump MBeans in text format:</p>

<div class="preformatted panel" style="border-width: 1px;"><div class="preformattedContent panelContent">
<pre>java -Duser=system -Dpass=manager -Dplugins.include=jmx -jar pdk/lib/hq-pdk.jar \
jmx MBeanDumper service:jmx:rmi:///jndi/rmi://localhost:1099/jmxrmi
</pre>
</div></div>

<p>Example output snippet:</p>
<div class="preformatted panel" style="border-width: 1px;"><div class="preformattedContent panelContent">
<pre>...

MBean: org.apache.commons.modeler.BaseModelMBean
Name:  Catalina:type=StringCache
        0. Attribute: modelerType = org.apache.tomcat.util.buf.StringCache (rw)
        1. Attribute: trainThreshold = 20000 (rw)
        2. Attribute: byteEnabled = true (rw)
        3. Attribute: hitCount = 0 (r)
        4. Attribute: accessCount = 0 (r)
        5. Attribute: charEnabled = false (rw)
        6. Attribute: cacheSize = 200 (rw)

         Operation: void reset []

MBean: org.apache.commons.modeler.BaseModelMBean
Name:  Catalina:type=Cache,host=localhost,path=/jsp-examples
        0. Attribute: modelerType = org.apache.naming.resources.ResourceCache (rw)
        1. Attribute: accessCount = 20 (r)
        2. Attribute: cacheMaxSize = 10240 (rw)
        3. Attribute: hitsCount = 8 (r)
        4. Attribute: maxAllocateIterations = 20 (rw)
        5. Attribute: spareNotFoundEntries = 500 (rw)
        6. Attribute: cacheSize = 36 (r)
        7. Attribute: desiredEntryAccessRatio = 3 (rw)
         Operation: boolean unload [java.lang.String]

         Operation: void load [org.apache.naming.resources.CacheEntry]
         Operation: org.apache.naming.resources.CacheEntry lookup [java.lang.String]
...
</pre>
</div></div>

<p>Each of the attribute names given above (for example, modelerType or accessCount) can be used as the metric <tt>alias</tt> in the plugin when defining the metrics to be collected.</p>

<h1><a name="JMX-BasedManagementwithHyperic-ConfigurationPropertiesRequiredforJMXMonitoring"></a>Configuration Properties Required for JMX Monitoring</h1>

<p>Hyperic's JMX support classes require the JMX URL and JMX user credentials in order to connect to a remote MBean server. </p>

<ul>
	<li>jmx.url - The JMX Service URL. For more information, see <a href="http://download.oracle.com/javase/1.5.0/docs/api/javax/management/remote/JMXServiceURL.html">http://download.oracle.com/javase/1.5.0/docs/api/javax/management/remote/JMXServiceURL.html</a></li>
	<li>jmx.username - Username if authentication is required</li>
	<li>jmx.password - Password if authentication is required</li>
</ul>


<p>Configuration options that a user can configure are defined in an &lt;config&gt; element in a plugin descriptor. The PDK includes a global configuration schema named <tt>jmx</tt> that contains the required configuration option definitions, shown below:  </p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: xml; gutter: false">&lt;config&gt;
&lt;option name="jmx.url" description="JMX URL to MBeanServer" default="service:jmx:rmi:///jndi/rmi://localhost:6969/jmxrmi"/&gt;
&lt;option name="jmx.username" description="JMX username" optional="true" default=""/&gt;
&lt;option name="jmx.password" description="JMX password" optional="true" default="" type="secret"/&gt;</pre>
		</div>
</div></div>

<p>You can reference the <tt>jmx</tt> schema in a plugin descriptor like this:</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: xml; gutter: false">&lt;config include="jmx"/&gt;</pre>
		</div>
</div></div>


<h1><a name="JMX-BasedManagementwithHyperic-CreateaCustomJMXPlugin"></a>Create a Custom JMX Plugin</h1>

<p>A JMX plugin consists solely of an XML descriptor. This section explains the components you can include in the descriptor.</p>

<h2><a name="JMX-BasedManagementwithHyperic-DefiningServiceTypestoProvideManagementviaCustomMBeans"></a>Defining Service Types to Provide Management via Custom MBeans</h2>

<p>Each server type defines several service types such as EJBs, Connection Pools and JMS Queues. Custom plugins define additional service types to provide management via custom MBeans.  The <tt>service</tt> element defines a service type, for example:</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: xml; gutter: false">&lt;service name="String Cache"
         server="Sun JVM"
         version="1.5"&gt;
&lt;/service&gt;</pre>
		</div>
</div></div>

<p>The <b>server</b> attribute must be <em>Sun JVM</em> and <b>version</b> attribute must be <em>1.5</em>, or any of the other supported server+version combinations.  The <b>name</b> attribute is the choice of the plugin implementor.  These services will become part of the HQ inventory model, displayed along with the built-in <b>server</b> service types throughout the UI and shell.  Service extensions will also inherit the server's configuration properties used to connect to the <tt>MBeanServer</tt>:</p>

<ul>
	<li>jmx.url</li>
	<li>jmx.username</li>
	<li>jmx.password</li>
</ul>


<p><a name="JMX-BasedManagementwithHyperic-objectname"></a></p>

<h2><a name="JMX-BasedManagementwithHyperic-DefininganObjectNametoAccessCustomMBeans"></a>Defining an ObjectName to Access Custom MBeans</h2>

<p>In order to access custom MBeans, the plugin must define its JMX ObjectName to be used with various <tt>MBeanServer</tt> interface methods.  Only one <tt>ObjectName</tt> is defined per-service type using the <b>property</b> tag within the <b>service</b> tag:</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: xml; gutter: false">&lt;property name="OBJECT_NAME"
          value="Catalina:type=StringCache"/&gt;</pre>
		</div>
</div></div>

<h2><a name="JMX-BasedManagementwithHyperic-DefiningConfigurationPropertiestoBeDisplayedintheUI"></a>Defining Configuration Properties to Be Displayed in the UI</h2>

<p>All the configuration properties for a JMX plugin, as for all other plugins, are displayed in the "<a href="ui-Inventory.Configuration.html" title="ui-Inventory.Configuration">Resource Configuration</a>" screen for the resource. The default values for each of these options can be specified in the plugin, but users can change the values on that screen.</p>

<p>In the example above, the <tt>OBJECT_NAME</tt> is hard-coded since there is only one instance of the String Cache.  Configuration Properties are used to support multiple instances that follow the same <tt>ObjectName</tt> pattern.  For example, the <em>WebApp Cache</em> plugin uses an <tt>ObjectName</tt> with the following pattern:</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: xml; gutter: false">&lt;property name="OBJECT_NAME"
          value="Catalina:type=Cache,host=*,path=*"/&gt;</pre>
		</div>
</div></div>

<p>Where the <tt>ObjectName</tt> <b>Domain</b> is always <em>Catalina</em> and <b>type</b> attribute value is always <em>Cache</em>, but the <b>host</b> and <b>path</b> attributes will be different for each instance of the MBean.  The <em>WebApp Cache</em> plugin defines config options for each of the instance properties:</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: xml; gutter: false">&lt;config&gt;
  &lt;option name="host"
          description="Host name"
          default="localhost"/&gt;

  &lt;option name="path"
          description="Path"
          default="/jsp-examples"/&gt;

&lt;/config&gt;</pre>
		</div>
</div></div>
<p>The values of the instance attributes within the <tt>OBJECT_NAME</tt> is replaced with the value of the configuration property when used by the plugin, for example:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">"Catalina:type=Cache,host=localhost,path=/jsp-examples"</pre>
		</div>
</div></div>

<h2><a name="JMX-BasedManagementwithHyperic-DefiningandGatheringMetrics"></a>Defining and Gathering Metrics</h2>

<p>Metrics are defined just as they are with other plugins, but in the case of custom MBean services the <b>OBJECT_NAME</b> property is used to compose the metric <b>template</b> attribute:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: xml; gutter: false">&lt;metric name="Access Count"
        template="${OBJECT_NAME}:accessCount"
        category="THROUGHPUT"
        indicator="true"
        collectionType="trendsup"/&gt;</pre>
		</div>
</div></div>

<p>This results in the <b>template</b> being expanded, for example, to:</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">template="Catalina:type=Cache,host=localhost,path=/jsp-examples:accessCount"</pre>
		</div>
</div></div>

<p>Where <em>accessCount</em> is an attribute of the MBean and can be collected internally using the <tt>MBeanServer</tt> interface like this:</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">ObjectName name = new ObjectName("Catalina:type=Cache,host=localhost,path=/jsp-examples");

return MBeanServer.getAttribute(name, "accessCount");</pre>
		</div>
</div></div>

<p>The MBean interface attributes collected by <a href="tomcat-webapp-cache-plugin.xml.html" title="tomcat-webapp-cache-plugin.xml">tomcat-webapp-cache-plugin.xml</a> as metrics are as follows:</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">public interface WebAppCacheMBean {
    public int getAccessCount();
    public int getHitCount();
    public int getCacheSize();
}</pre>
		</div>
</div></div>

<p>Learn more about <a href="Measurement Plugin.html" title="Measurement Plugin">measurement plugins</a>.</p>

<p><a name="JMX-BasedManagementwithHyperic-availability"></a></p>
<h2><a name="JMX-BasedManagementwithHyperic-SpecifyingAvailabilityMetricforMBeans"></a>Specifying Availability Metric for MBeans</h2>

<p>Hyperic's JMX plugins typically query for an MBean's "Availability" attribute to determine whether the MBean is available. If the MBean server returns "1", the MBean is considered available; if the return value is "0", the MBean is considered unavailable. (Other values will cause availability to display incorrectly.) </p>

<p>Note that, because many MBeans do not have an "Availability" attribute, Hyperic's JMX plugins also consider an Mbean to be available if the query returns an <tt>AttributeNotFoundException</tt>, assuming that the MBean is in fact available to report that the attribute does not exist. If the MBean server returns any exception other than <tt>AttributeNotFoundException</tt>, the MBean is considered to be unavailable. </p>

<p><a name="JMX-BasedManagementwithHyperic-control"></a></p>

<h2><a name="JMX-BasedManagementwithHyperic-ImplementingControlActions"></a>Implementing Control Actions</h2>

<p>With the <b>OBJECT_NAME</b> property defined, MBean operations can be exposed as HQ control actions simply by adding the list of method names:</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: xml; gutter: false">&lt;actions include="reset"/&gt;</pre>
		</div>
</div></div>

<p>The plugin must also define the control implementation class (resides in <em>hq-jmx.jar</em>):</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: xml; gutter: false">&lt;plugin type="control"
        class="org.hyperic.hq.product.jmx.MxControlPlugin"/&gt;</pre>
		</div>
</div></div>
<p>The control actions will then be invoked as MBean operations by the plugin like so:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">ObjectName name = new ObjectName("Catalina:type=StringCache");

return MbeanServer.invoke(name, "reset", new Object[0], new String[0]);</pre>
		</div>
</div></div>

<p>Which maps to the following MBean operation:</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">public interface StringCacheMBean {

    public void reset();
}</pre>
		</div>
</div></div>

<p>If an MBean operation requires arguments, they can be passed in using the HQ control UI.</p>

<p>The <em>WebApp Cache</em> example provides the following control actions:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: xml; gutter: false">&lt;actions include="unload,lookup,allocate"/&gt;</pre>
		</div>
</div></div>
<p>Which map to the following MBean operations:</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">public interface WebAppCacheMBean {
    public boolean unload(String name);
    public CacheEntry lookup(String name);
    public boolean allocate(int value);
}</pre>
		</div>
</div></div>

<p>Learn more about <a href="Control Plugin.html" title="Control Plugin">control plugins</a>.</p>



<h2><a name="JMX-BasedManagementwithHyperic-DefineServerAutoInventoryElement"></a>Define Server Auto-Inventory Element</h2>

<p>To implement auto-discovery at the server level, you must invoke an autoinventory plugin with a specific class &#8212; <tt>MxServerDetector</tt> &#8212; within the server tag:</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: xml; gutter: false">&lt;server name="Java Server Name" version ="version #"&gt;
...

&lt;plugin type="autoinventory" class="org.hyperic.hq.product.jmx.MxServerDetector"/&gt;
...

&lt;/server&gt;</pre>
		</div>
</div></div>
<p>In the case of service, auto-discovery is supported for custom MBean services, again driven by the <tt>OBJECT_NAME</tt> property.  To implement auto-discovery at the service level, invoke the autoinventory plugin, leaving out the class attribute, within a service tag:</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: xml; gutter: false">&lt;service name="Java Service Name"&gt;
...

&lt;plugin type="autoinventory"/&gt;

...
&lt;/service&gt;</pre>
		</div>
</div></div>
<p>The JMX plugin uses the <tt>MBeanServer.queryNames</tt> method to discover a service for each MBean instance.  In the case where the <tt>OBJECT_NAME</tt> contains configuration properties, the properties will be auto-configured.</p>

<p>By default, auto-discovered service names will be composed using the hosting-server name, configuration properties, and service type name. For example:</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: xml; gutter: false">"myhost Sun JVM 1.5 localhost /jsp-examples WebApp String Cache"</pre>
		</div>
</div></div>
<p>The naming can be overridden using the <tt>AUTOINVENTORY_NAME</tt> property:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: xml; gutter: false">&lt;property name="AUTOINVENTORY_NAME"
             value="%platform.name% %path% Tomcat WebApp String Cache"/&gt;</pre>
		</div>
</div></div>
<p>Configuration properties from the platform, hosting server, and the service itself can be used in the <tt>%replacement%</tt> strings, resulting in a name like so:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: xml; gutter: false">"myhost /jsp-examples Tomcat WebApp String Cache"</pre>
		</div>
</div></div>


<p><a name="JMX-BasedManagementwithHyperic-custom"></a></p>

<h4><a name="JMX-BasedManagementwithHyperic-DiscoveringCustomProperties"></a>Discovering Custom Properties</h4>

<p>Discovery of Custom Properties is supported, again using the <b>OBJECT_NAME</b> and <tt>MBeanServer.getAttribute</tt>.  Simply define a <b>properties</b> tag with any number of <b>property</b> tags where the <b>name</b> attribute value is that of an MBean attribute:</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: xml; gutter: false">&lt;properties&gt;
  &lt;property name="cacheMaxSize"
            description="Maximum Cache Size"/&gt;
&lt;/properties&gt;</pre>
		</div>
</div></div>

<p>Which maps to the following MBean interface method:</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: java; gutter: false">public interface WebAppCacheMBean {
    public int getCacheMaxSize();
}</pre>
		</div>
</div></div>

<h2><a name="JMX-BasedManagementwithHyperic-ImplementingLogandConfigTracking"></a>Implementing Log and Config Tracking</h2>

<p>All log and config tracking data is displayed in the Hyperic user interface <b>Monitor</b> tab for a resource. For more information see <a href="ui-Monitor.CurrentHealth.html#ui-Monitor.CurrentHealth-events">ui-Monitor.CurrentHealth</a> in <em>vFabric Hyperic User Interface</em>.</p>

<p>Should your plugin wish to track log and/or config files, simply use the generic classes which are included in <b>pdk/lib/hq-pdk.jar</b> and available for use by all plugins. As you can see in the following code, these classes require that files be in Log4J format (which most will be).</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: xml; gutter: false">&lt;property name="DEFAULT_LOG_FILE"
          value="log/mybean.log"/&gt;

&lt;plugin type="log_track"
        class="org.hyperic.hq.product.Log4JLogTrackPlugin"/&gt;

&lt;property name="DEFAULT_CONFIG_FILE"
          value="conf/mybean-service.xml,conf/mybean.policy"/&gt;

&lt;plugin type="config_track"
        class="org.hyperic.hq.product.ConfigFileTrackPlugin"/&gt;</pre>
		</div>
</div></div>

<p><b>Tracking an MBeanLog</b></p>

<p>You can also easily implement log tracking for a specific MBean. Invoke the <tt>log_track</tt> plugin with the class <tt>MxNotificationPlugin</tt> before declaring the metric for the desired MBean (in this example, Threading MBeans, which we'll just pretend were enumerated earlier).</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: xml; gutter: false">&lt;plugin type="log_track"
     class="org.hyperic.hq.product.jmx.MxNotificationPlugin"/&gt;

&lt;property name="OBJECT_NAME"
     value="java.lang:type=Threading"/&gt;

&lt;metrics
     include="Threading"/&gt;</pre>
		</div>
</div></div>

<h1><a name="JMX-BasedManagementwithHyperic-ExampleCustomMBeanPlugins"></a>Example Custom MBean Plugins</h1>

<ul>
	<li><a href="tomcat-string-cache-plugin.xml.html" title="tomcat-string-cache-plugin.xml">tomcat-string-cache-plugin.xml</a></li>
	<li><a href="tomcat-webapp-cache-plugin.xml.html" title="tomcat-webapp-cache-plugin.xml">tomcat-webapp-cache-plugin.xml</a></li>
</ul>


				    
                    			    </td>
		    </tr>
	    </table>
	    <table border="0" cellpadding="0" cellspacing="0" width="100%">
			<tr>
				<td height="12" background="http://support.hyperic.com/images/border/border_bottom.gif"><img src="images/border/spacer.gif" width="1" height="1" border="0"/></td>
			</tr>
		    <tr>
			    <td align="center"><font color="grey">Document generated by Confluence on Oct 29, 2012 13:01</font></td>
		    </tr>
	    </table>
    </body>
</html>
