<%@ page pageEncoding="UTF-8"%>
<%@ page language="java" contentType="text/html; charset=UTF-8" %>
<%@ page errorPage="/common/Error.jsp" %>
<%@ taglib uri="http://java.sun.com/jsp/jstl/fmt" prefix="fmt" %>
<%@ taglib uri="http://struts.apache.org/tags-html-el" prefix="html" %>
<%@ taglib uri="http://struts.apache.org/tags-tiles" prefix="tiles" %>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %>
<%@ taglib uri="/WEB-INF/tld/hq.tld" prefix="hq" %>

<%--
  NOTE: This copyright does *not* cover user programs that use HQ
  program services by normal system calls through the application
  program interfaces provided as part of the Hyperic Plug-in Development
  Kit or the Hyperic Client Development Kit - this is merely considered
  normal use of the program, and does *not* fall under the heading of
  "derived work".
  
  Copyright (C) [2004-2009], Hyperic, Inc.
  This file is part of HQ.
  
  HQ is free software; you can redistribute it and/or modify
  it under the terms version 2 of the GNU General Public License as
  published by the Free Software Foundation. This program is distributed
  in the hope that it will be useful, but WITHOUT ANY WARRANTY; without
  even the implied warranty of MERCHANTABILITY or FITNESS FOR A
  PARTICULAR PURPOSE. See the GNU General Public License for more
  details.
  
  You should have received a copy of the GNU General Public License
  along with this program; if not, write to the Free Software
  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307
  USA.
 --%>

<script type="text/javascript">
    function getUpdateStatus(opt) {
        if (opt == "<fmt:message key="header.Acknowledge"/>") {
        	var postData = { update: true};
            var updateUrl = 'Dashboard.do?';
            dojo11.xhrPost({
         	 	url: updateUrl,
         	 	content: postData,
         	 	load: function(data) {
         	 	dojo11.style("updateLink", "display", "none");
         	 	updateDialog.hide();
        		}
       		});
        }
      
    }
    var resourceURL = '<html:rewrite action="/Resource" />';
	var userURL = '<html:rewrite action="/admin/user/UserAdmin" />';
    var searchWidget = new hyperic.widget.search({search:'/app/search'}, 3, {keyCode: 83, ctrl: true});
    dojo.require("dojo.lfx.html");
    dojo.event.connect(window, "onload",function(){ 
        activateHeaderTab();
        searchWidget.create();
        //Connect the events for the box, cancel and search buttons
        dojo.event.connect(searchWidget.searchBox, "onkeypress", searchWidget, "search");
        dojo.event.connect(searchWidget.nodeCancel, "onclick", searchWidget, "toggleSearchBox");
        dojo.event.connect(searchWidget.nodeSearchButton, "onclick", searchWidget,  "toggleSearchBox");
        // What should the hot-keys do?
        dojo11.subscribe('enter', searchWidget, "search");
        dojo.event.topic.subscribe('search', searchWidget, "toggleSearchBox");
        dojo.event.topic.subscribe('escape', searchWidget, "toggleSearchBox");
        // Render Search Tooltip
        if (dojo.render.os.mac) {
            dojo.byId('headerSearch').title = "<fmt:message key="header.searchTip.mac"/>";
        } else if (dojo.render.os.win) {
            dojo.byId('headerSearch').title = "<fmt:message key="header.searchTip.win"/>";
        }
    });
    
    <!--
    var refreshCount = 0;
                                                                                  
    function refreshAlerts() {
      refreshCount++;

      new Ajax.Request('<html:rewrite page="/common/RecentAlerts.jsp"/>',
                       {method: 'get', onSuccess:showRecentAlertResponse});
    }

    function showRecentAlertResponse(originalRequest) {
      if (originalRequest.responseText.indexOf('recentAlertsText') > 0) {
        $('headerAlerts').style.display = '';
        $('recentAlerts').innerHTML = originalRequest.responseText;
      }
      else {
        refreshCount = 31;
      }

      if (refreshCount < 30) {
        setTimeout( "refreshAlerts()", 60*1000 );
      } else if (autoLogout) {
    	  top.location.href = "<html:rewrite action="/j_spring_security_logout"/>";
      }
    }

    onloads.push( refreshAlerts );

    var useBreadcrumbHrefIfAvailable = function(link) {
		var browseInput = dojo.byId("browseUrlInput"); // Generated by bread crumb tag

		if (browseInput != null) {
			 var url = browseInput.value;

			 if (url != null && url.length > 0) {
				 link.href = url;
			 }		 
		}
    }
    
    //-->
      </script>
    <div id="header">
    <div id="headerLogo" title="Home" onclick="location.href='<html:rewrite action="/Dashboard" />'">&nbsp;</div>
    <div id="navTabContainer">
        <c:set var="pageURL" value="${requestURL}"/>
        <ul class="adxm mainMenu" style="position: absolute; z-index: 10">
            <li id="dashTab"><a href="/Dashboard.do"><fmt:message key="header.dashboard"/></a></li>
            <li id="resTab"><a href="<html:rewrite page="/ResourceHub.do"/>" onclick="useBreadcrumbHrefIfAvailable(this);"><fmt:message key="header.resources"/></a>
              <div>
              <ul>
                <li><a href="<html:rewrite page="/ResourceHub.do"/>" onclick="useBreadcrumbHrefIfAvailable(this);"><fmt:message key="header.Browse"/></a></li>
                <tiles:insert definition=".header.optional.tabs">
                  <tiles:put name="location" value="resources"/>
                </tiles:insert>
                <li class="hasSubmenu"><a href=""><fmt:message key=".dashContent.recentResources"/></a>
                  <div>
                  <ul>
                    <tiles:insert definition=".toolbar.recentResources"/>
                  </ul>
                  </div>
                </li>
              </ul>
              </div>
            </li>
            <li id="analyzeTab"><a href="#"><fmt:message key="header.analyze"/></a>
              <div>
              <ul>
              <tiles:insert definition=".header.optional.tabs">
                  <tiles:put name="location" value="tracking"/>
              </tiles:insert>
              </ul>
              </div>
            </li>
            <li id="adminTab"><a href="/Admin.do"><fmt:message key="header.admin"/></a></li>
        </ul>
    </div>
    <div class="ajaxLoading" style="display:none;" id="loading">
        <html:img page="/images/4.0/icons/ajax-loader.gif" border="0" width="16" height="16"/>
    </div>
    <div id="headerAlerts" style="display:none;">
      <div class="headAlertWrapper">
        <div class="recentText">
          <fmt:message key="header.RecentAlerts"/>
        </div>
        <div id="recentAlerts"></div>
      </div>
    </div>
    <div id="headerLinks">
 	 	<c:if test="${not empty HQUpdateReport}">
 	 	<div id="update" class="dialog" style="display: none;">
 	 	<c:out value="${HQUpdateReport}" escapeXml="false"/>
 	 
 	 	<form name="updateForm" action="">
 	 		<div style="text-align:right;">
 	 			<input type="button" class="button42" value="<fmt:message key="header.Acknowledge"/>" onclick="getUpdateStatus(this.value);">
 	 		</div>
 	 	</form>
 	</div>
	<script type="text/javascript">
 	 	dojo11.require("dijit.Dialog");
 	 		
 	 	var updateDialog = null;
 	 		
 	 	dojo11.addOnLoad(function(){
 	 	updateDialog = new dijit11.Dialog({
 	 	 	id: 'update_popup',
 	 		refocus: true,
 	 		autofocus: false,
 	 		opacity: 0,
 	 		title: "<fmt:message key="header.dialog.title.update" />"
 			}, dojo11.byId('update'));
 	 	});
 	</script>
 	<a id="updateLink" href="javascript:updateDialog.show()">
 		<img src="<html:rewrite page="/images/transmit2.gif" />" align="absMiddle" border="0" />                        
 	</a>
	</c:if>	
        <fmt:message key="header.Welcome"/>
         <c:choose>
            <c:when test="${useroperations['viewSubject']}">
                <html:link page="/admin/user/UserAdmin.do?mode=view&u=${sessionScope.webUser.id}">
                    <c:out value="${sessionScope.webUser.firstName}"/>
                </html:link>
            </c:when>
            <c:otherwise>
                <c:out value="${sessionScope.webUser.firstName}"/>
            </c:otherwise>
        </c:choose>
         <span><a href="<html:rewrite page="/j_spring_security_logout" />"><fmt:message key="header.SignOut"/></a></span>
        <span><html:link href="javascript:void(0)" onclick="tutorialWin=window.open('http://www.hyperic.com/demo/screencasts.html','tutorials','width=800,height=650,scrollbars=yes,toolbar=yes,left=80,top=80,resizable=yes');tutorialWin.focus();return false;"><fmt:message key="header.Screencasts"/></html:link></span>
        <span><a href="javascript:void(0)" onclick="helpWin=window.open((typeof help != 'undefined' ? help : '<hq:help/>'),'help','width=800,height=650,scrollbars=yes,toolbar=yes,left=80,top=80,resizable=yes');helpWin.focus();return false;"><fmt:message key="header.Help"/></a></span>
    </div>
    <div id="headerSearch"><fmt:message key="header.Search"/></div>
        <div id="headerSearchBox" style="display:none">
            <div style="float:left;margin:3px 0px 3px 5px;">
            <input type="text" id="searchBox" value=""/>
        </div>
    </div>
    <div id="headerSearchResults" style="display:none">
        <div id="searchClose" class="cancelButton right"></div>
        <!--
        <a class="all left" href="/resource/Hub.html"><fmt:message key="header.SearchShowAll"/></a>
        <div class="clear">&nbsp;</div>
        -->
        <div class="resultsGroup">
            <div class="category"><fmt:message key="header.Resources"/> (<span id="resourceResultsCount"></span>)</div>
            <ul id="resourceResults">
                <li></li>
            </ul>
        </div>
        <div class="resultsGroup">
            <div class="category"><fmt:message key="header.users"/> (<span id="usersResultsCount"></span>)</div>
            <ul id="usersResults">
                <li></li>
            </ul>
        </div>
        <!--
        <div class="resultsGroup">
            <div class="category"><fmt:message key="header.Alerts"/> (0)</div>
            <ul>
                <li></li>
            </ul>
        </div>
        <div class="resultsGroup">
            <div class="category"><fmt:message key="header.Events"/> (0)</div>
            <ul>
                <li></li>
            </ul>
        </div>
        -->
    </div>     
</div>

