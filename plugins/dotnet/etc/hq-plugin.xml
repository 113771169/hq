<?xml version="1.0"?>
<!--
  NOTE: This copyright does *not* cover user programs that use HQ
  program services by normal system calls through the application
  program interfaces provided as part of the Hyperic Plug-in Development
  Kit or the Hyperic Client Development Kit - this is merely considered
  normal use of the program, and does *not* fall under the heading of
  "derived work".
  
  Copyright (C) [2004, 2005, 2006], Hyperic, Inc.
  This file is part of HQ.
  
  HQ is free software; you can redistribute it and/or modify
  it under the terms version 2 of the GNU General Public License as
  published by the Free Software Foundation. This program is distributed
  in the hope that it will be useful, but WITHOUT ANY WARRANTY; without
  even the implied warranty of MERCHANTABILITY or FITNESS FOR A
  PARTICULAR PURPOSE. See the GNU General Public License for more
  details.
  
  You should have received a copy of the GNU General Public License
  along with this program; if not, write to the Free Software
  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307
  USA.
 -->

<plugin package="org.hyperic.hq.plugin.dotnet">
  <filter name="data.domain"
          value=".NET CLR Data"/>

  <filter name="mem.domain"
          value=".NET CLR Memory(${app.name})"/>

  <filter name="loading.domain"
          value=".NET CLR Loading(${app.name})"/>

  <filter name="ex.domain"
          value=".NET CLR Exceptions(${app.name})"/>

  <filter name="interop.domain"
          value=".NET CLR Interop(${app.name})"/>

  <filter name="jit.domain"
          value=".NET CLR Jit(${app.name})"/>

  <filter name="thread.domain"
          value=".NET CLR LocksAndThreads(${app.name})"/>

  <filter name="net.domain"
          value=".NET CLR Networking"/>

  <filter name="remote.domain"
          value=".NET CLR Remoting(${app.name})"/>

  <filter name="security.domain"
          value=".NET CLR Security(${app.name})"/>

  <!-- XXX must be something better for avail -->
  <metrics name="dotnet-avail">
    <metric name="Availability"
            alias="Availability"
            template="${loading.domain}:Type=Availability:Total Assemblies"
            category="AVAILABILITY"
            group="Reliability"
            indicator="true"
            collectionType="dynamic"
            units="percentage"/>
  </metrics>

  <metrics name="clr-memory">
    <metric name="Gen 0 Collections"
            alias="Gen0Collections"
            template="${mem.domain}:Platform=Win32:# Gen 0 Collections"
            category="UTILIZATION"
            group="Garbage Collection"
            collectionType="dynamic"
            units="none"/>

    <metric name="Gen 1 Collections"
            alias="Gen1Collections"
            template="${mem.domain}:Platform=Win32:# Gen 1 Collections"
            category="UTILIZATION"
            group="Garbage Collection"
            collectionType="dynamic"
            units="none"/>

    <metric name="Gen 2 Collections"
            alias="Gen2Collections"
            template="${mem.domain}:Platform=Win32:# Gen 2 Collections"
            category="UTILIZATION"
            group="Garbage Collection"
            collectionType="dynamic"
            units="none"/>

    <metric name="Promoted Memory From Gen 0"
            alias="PromotedMemFromGen0"
            template="${mem.domain}:Platform=Win32:Promoted Memory from Gen 0"
            category="UTILIZATION"
            group="Garbage Collection"
            collectionType="dynamic"
            units="B"/>

    <metric name="Promoted Memory From Gen 1"
            alias="PromotedMemFromGen1"
            template="${mem.domain}:Platform=Win32:Promoted Memory from Gen 1"
            category="UTILIZATION"
            group="Garbage Collection"
            collectionType="dynamic"
            units="B"/>

    <metric name="Gen 0 Promoted Bytes"
            alias="Gen0PromotedBytes"
            template="${mem.domain}:Platform=Win32:Gen 0 Promoted Bytes/Sec"
            category="UTILIZATION"
            group="Garbage Collection"
            collectionType="trendsup"
            units="B"/>

    <metric name="Gen 1 Promoted Bytes"
            alias="Gen1PromotedBytes"
            template="${mem.domain}:Platform=Win32:Gen 1 Promoted Bytes/Sec"
            category="UTILIZATION"
            group="Garbage Collection"
            collectionType="trendsup"
            units="B"/>

    <metric name="Promoted Finalization Memory From Gen 0"
            alias="PromotedFinalMemFromGen0"
            template="${mem.domain}:Platform=Win32:Promoted Finalization-Memory from Gen 0"
            category="UTILIZATION"
            group="Garbage Collection"
            collectionType="dynamic"
            units="B"/>

    <metric name="Promoted Finalization Memory From Gen 1"
            alias="PromotedFinalMemFromGen1"
            template="${mem.domain}:Platform=Win32:Promoted Finalization-Memory from Gen 1"
            category="UTILIZATION"
            group="Garbage Collection"
            collectionType="dynamic"
            units="B"/>

    <metric name="Gen 0 Heap Size"
            alias="Gen0HeapSize"
            template="${mem.domain}:Platform=Win32:Gen 0 heap size"
            category="UTILIZATION"
            group="Garbage Collection"
            collectionType="dynamic"
            units="B"/>

    <metric name="Gen 1 Heap Size"
            alias="Gen1HeapSize"
            template="${mem.domain}:Platform=Win32:Gen 1 heap size"
            category="UTILIZATION"
            group="Garbage Collection"
            collectionType="dynamic"
            units="B"/>

    <metric name="Gen 2 Heap Size"
            alias="Gen2HeapSize"
            template="${mem.domain}:Platform=Win32:Gen 2 heap size"
            category="UTILIZATION"
            group="Garbage Collection"
            collectionType="dynamic"
            units="B"/>

    <metric name="Large Object Heap Size"
            alias="LargeObjHeapSize"
            template="${mem.domain}:Platform=Win32:Large Object Heap size"
            category="UTILIZATION"
            group="Common Language Runtime"
            collectionType="dynamic"
            units="B"/>

    <metric name="Finalization Survivors"
            alias="FinalizationSurvivors"
            template="${mem.domain}:Platform=Win32:Finalization Survivors"
            category="UTILIZATION"
            group="Common Language Runtime"
            collectionType="dynamic"
            units="none"/>

    <metric name="GC Handles"
            alias="GCHandles"
            template="${mem.domain}:Platform=Win32:# GC Handles"
            category="UTILIZATION"
            group="Garbage Collection"
            collectionType="dynamic"
            units="none"/>

    <metric name="Allocated Bytes"
            alias="AllocBytes"
            template="${mem.domain}:Platform=Win32:Allocated Bytes/sec"
            category="UTILIZATION"
            group="Common Language Runtime"
            collectionType="trendsup"
            units="B"/>

    <metric name="Number of Induced GC"
            alias="NumInducedGC"
            template="${mem.domain}:Platform=Win32:# Induced GC"
            category="UTILIZATION"
            group="Garbage Collection"
            collectionType="dynamic"
            units="none"/>

    <metric name="Percent Time in GC"
            alias="PercTimeGC"
            template="${mem.domain}:Platform=Win32:__percent__ Time in GC"
            category="UTILIZATION"
            group="Garbage Collection"
            collectionType="dynamic"
            units="percentage"/>

    <!-- sum of Gen 0,1,2 and Large Object Heap Size -->
    <metric name="Bytes in all Heaps"
            alias="BytesInAllHeaps"
            template="${mem.domain}:Platform=Win32:# Bytes in all Heaps"
            category="UTILIZATION"
            group="Common Language Runtime"
            indicator="true"
            collectionType="dynamic"
            units="B"/>

    <metric name="Total Committed Bytes"
            alias="TotalCommittedBytes"
            template="${mem.domain}:Platform=Win32:# Total committed Bytes"
            category="UTILIZATION"
            group="Common Language Runtime"
            collectionType="dynamic"
            units="B"/>

    <metric name="Total Reserved Bytes"
            alias="TotalReservedBytes"
            template="${mem.domain}:Platform=Win32:# Total reserved Bytes"
            category="UTILIZATION"
            group="Common Language Runtime"
            collectionType="dynamic"
            units="B"/>

    <metric name="Pinned Objects"
            alias="PinnedObjects"
            template="${mem.domain}:Platform=Win32:# of Pinned Objects"
            category="UTILIZATION"
            group="Common Language Runtime"
            collectionType="dynamic"
            units="none"/>

    <metric name="Sink Blocks in Use"
            alias="SinkBlocksInUse"
            template="${mem.domain}:Platform=Win32:# of Sink Blocks in use"
            category="UTILIZATION"
            group="Common Language Runtime"
            collectionType="dynamic"
            units="none"/>
  </metrics>

  <metrics name="clr-loading">
    <metric name="Current Classes Loaded"
            alias="CurrentClassesLoaded"
            template="${loading.domain}:Platform=Win32:Current Classes Loaded"
            category="UTILIZATION"
            group="CLR Loader"
            collectionType="dynamic"
            units="none"/>

    <metric name="Total Classes Loaded"
            alias="TotalClassesLoaded"
            template="${loading.domain}:Platform=Win32:Total Classes Loaded"
            category="UTILIZATION"
            group="CLR Loader"
            collectionType="trendsup"
            units="none"/>
    <!-- XXX wtf is rate here? -->
    <metric name="Rate of Classes Loaded"
            alias="RateOfClassesLoaded"
            template="${loading.domain}:Type=Formatted:Rate of Classes Loaded"
            category="UTILIZATION"
            group="CLR Loader"
            collectionType="dynamic"
            units="none"/>

    <metric name="Current Application Domains"
            alias="CurrentAppDomains"
            template="${loading.domain}:Platform=Win32:Current appdomains"
            category="UTILIZATION"
            group="CLR Loader"
            collectionType="dynamic"
            units="none"/>

    <metric name="Total Application Domains"
            alias="TotalAppDomains"
            template="${loading.domain}:Platform=Win32:Total Appdomains"
            category="UTILIZATION"
            group="CLR Loader"
            collectionType="trendsup"
            units="none"/>
    <!-- XXX wtf is rate here? -->
    <metric name="Rate of Application Domains"
            alias="RateOfAppDomains"
            template="${loading.domain}:Type=Formatted:Rate of appdomains"
            category="UTILIZATION"
            group="CLR Loader"
            collectionType="dynamic"
            units="none"/>

    <metric name="Current Assemblies"
            alias="CurrentAssemblies"
            template="${loading.domain}:Platform=Win32:Current Assemblies"
            category="UTILIZATION"
            group="CLR Loader"
            collectionType="dynamic"
            units="none"/>

    <metric name="Total Assemblies"
            alias="TotalAssemblies"
            template="${loading.domain}:Platform=Win32:Total Assemblies"
            category="UTILIZATION"
            group="CLR Loader"
            collectionType="trendsup"
            units="none"/>
    <!-- XXX wtf is rate here? -->
    <metric name="Rate of Assemblies"
            alias="RateOfAssemblies"
            template="${loading.domain}:Type=Formatted:Rate of Assemblies"
            category="UTILIZATION"
            group="CLR Loader"
            collectionType="dynamic"
            units="none"/>

    <metric name="Time Loading"
            alias="TimeLoading"
            template="${loading.domain}:Platform=Win32:__percent__ Time Loading"
            category="UTILIZATION"
            group="CLR Loader"
            collectionType="dynamic"
            units="percentage"/>

    <metric name="Assembly Search Length"
            alias="AssemblySearchLength"
            template="${loading.domain}:Platform=Win32:Assembly Search Length"
            category="UTILIZATION"
            group="CLR Loader"
            collectionType="dynamic"
            units="none"/>

    <metric name="Total Load Failures"
            alias="TotalLoadFailures"
            template="${loading.domain}:Platform=Win32:Total # of Load Failures"
            category="UTILIZATION"
            group="CLR Loader"
            collectionType="trendsup"
            units="none"/>
    <!-- XXX wtf is rate here? -->
    <metric name="Rate of Load Failures"
            alias="RateOfLoadFailures"
            template="${loading.domain}:Type=Formatted:Rate of Load Failures"
            category="UTILIZATION"
            group="CLR Loader"
            collectionType="dynamic"
            units="none"/>

    <metric name="Bytes in Loader Heap"
            alias="BytesInLoaderHeap"
            template="${loading.domain}:Platform=Win32:Bytes in Loader Heap"
            category="UTILIZATION"
            group="CLR Loader"
            collectionType="dynamic"
            units="B"/>

    <metric name="Total Application Domains Unloaded"
            alias="TotalAppDomainsUnloaded"
            template="${loading.domain}:Platform=Win32:Total appdomains unloaded"
            category="UTILIZATION"
            group="CLR Loader"
            collectionType="trendsup"
            units="none"/>
    <!-- XXX wtf is rate here? -->
    <metric name="Rate of Application Domains Unloaded"
            alias="RateOfAppDomainsUnloaded"
            template="${loading.domain}:Type=Formatted:Rate of appdomains unloaded"
            category="UTILIZATION"
            group="CLR Loader"
            collectionType="dynamic"
            units="none"/>
  </metrics>

  <metrics name="clr-ex">
    <metric name="Exceptions Thrown"
            alias="ExThrown"
            template="${ex.domain}:Platform=Win32:# of Exceps Thrown"
            category="UTILIZATION"
            group="Common Language Runtime"
            indicator="true"
            collectionType="trendsup"
            units="none"/>

    <metric name="Filters"
            alias="Filters"
            template="${ex.domain}:Platform=Win32:# of Filters / sec"
            category="UTILIZATION"
            group="Common Language Runtime"
            collectionType="trendsup"
            units="none"/>

    <metric name="Finallys"
            alias="Finallys"
            template="${ex.domain}:Platform=Win32:# of Finallys / sec"
            category="UTILIZATION"
            group="Common Language Runtime"
            collectionType="trendsup"
            units="none"/>

    <metric name="Throw To Catch Depth"
            alias="ThrowToCatchDepth"
            template="${ex.domain}:Platform=Win32:Throw To Catch Depth / sec"
            category="UTILIZATION"
            group="Common Language Runtime"
            collectionType="dynamic"
            units="none"/>
  </metrics>

  <!-- XXX no sure how useful these are; currently not included -->
  <metrics name="clr-interop">
    <metric name="COM Callable Wrapper Calls"
            alias="CCWs"
            template="${interop.domain}:Platform=Win32:# of CCWs"
            category="UTILIZATION"
            group="Common Language Runtime"
            collectionType="dynamic"
            units="none"/>

    <metric name="Number of Stubs"
            alias="NumStubs"
            template="${interop.domain}:Platform=Win32:# of Stubs"
            category="UTILIZATION"
            group="Common Language Runtime"
            collectionType="dynamic"
            units="none"/>

    <metric name="Number of Marshalling"
            alias="NumMarshalling"
            template="${interop.domain}:Platform=Win32:# of marshalling"
            category="UTILIZATION"
            group="Common Language Runtime"
            collectionType="dynamic"
            units="none"/>

    <metric name="Type Library Imports"
            alias="TLBimports"
            template="${interop.domain}:Platform=Win32:# of TLB imports / sec"
            category="UTILIZATION"
            group="Common Language Runtime"
            collectionType="trendsup"
            units="none"/>

    <metric name="Type Library Exports"
            alias="TLBexports"
            template="${interop.domain}:Platform=Win32:# of TLB exports / sec"
            category="UTILIZATION"
            group="Common Language Runtime"
            collectionType="trendsup"
            units="none"/>
  </metrics>

  <metrics name="clr-jit">
    <metric name="Methods Jitted"
            alias="MethodsJitted"
            template="${jit.domain}:Platform=Win32:# of Methods Jitted"
            category="UTILIZATION"
            group="JIT Compiler"
            collectionType="trendsup"
            units="none"/>

    <metric name="IL Bytes Jitted"
            alias="ILBytesJitted"
            template="${jit.domain}:Platform=Win32:# of IL Bytes Jitted"
            category="UTILIZATION"
            group="JIT Compiler"
            collectionType="dynamic"
            units="B"/>

    <metric name="Total IL Bytes Jitted"
            alias="TotalILBytesJitted"
            template="${jit.domain}:Platform=Win32:Total # of IL Bytes Jitted"
            category="UTILIZATION"
            group="JIT Compiler"
            collectionType="trendsup"
            units="none"/>

    <metric name="Standard Jit Failures"
            alias="StandardJitFailures"
            template="${jit.domain}:Platform=Win32:Standard Jit Failures"
            category="UTILIZATION"
            group="JIT Compiler"
            collectionType="trendsup"
            units="none"/>

    <metric name="Percent Time in Jit"
            alias="TimeInJit"
            template="${jit.domain}:Platform=Win32:__percent__ Time in Jit"
            category="UTILIZATION"
            group="JIT Compiler"
            collectionType="dynamic"
            units="percentage"/>
  </metrics>

  <metrics name="clr-threads">
    <metric name="Total Contentions"
            alias="TotalContentions"
            template="${thread.domain}:Platform=Win32:Total # of Contentions"
            category="UTILIZATION"
            group="Common Language Runtime"
            collectionType="trendsup"
            units="none"/>

    <metric name="Current Queue Length"
            alias="CurrentQueueLength"
            template="${thread.domain}:Platform=Win32:Current Queue Length"
            category="UTILIZATION"
            group="Common Language Runtime"
            collectionType="dynamic"
            units="none"/>

    <metric name="Queue Length"
            alias="QueueLength"
            template="${thread.domain}:Platform=Win32:Queue Length / sec"
            category="UTILIZATION"
            group="Common Language Runtime"
            collectionType="trendsup"
            units="none"/>

    <metric name="Current Logical Threads"
            alias="CurrentLogicalThreads"
            template="${thread.domain}:Platform=Win32:# of current logical Threads"
            category="UTILIZATION"
            group="Thread"
            collectionType="dynamic"
            units="none"/>

    <metric name="Current Physical Threads"
            alias="CurrentPhysicalThreads"
            template="${thread.domain}:Platform=Win32:# of current physical Threads"
            category="UTILIZATION"
            group="Thread"
            collectionType="dynamic"
            units="none"/>

    <metric name="Current Recognized Threads"
            alias="CurrentRecognizedThreads"
            template="${thread.domain}:Platform=Win32:# of current recognized threads"
            category="UTILIZATION"
            group="Thread"
            collectionType="dynamic"
            units="none"/>

    <metric name="Total Recognized Threads"
            alias="TotalRecognizedThreads"
            template="${thread.domain}:Platform=Win32:# of total recognized threads"
            category="UTILIZATION"
            group="Thread"
            collectionType="trendsup"
            units="none"/>
  </metrics>

  <!-- clr-net metrics are runtime only; no application metrics -->
  <metrics name="clr-net">
    <metric name="Connections Established"
            alias="ConnectionsEstablished"
            template="${net.domain}:Platform=Win32:Connections Established"
            category="THROUGHPUT"
            group="Connection"
            collectionType="trendsup"
            units="none"/>

    <metric name="Bytes Received"
            alias="BytesReceived"
            template="${net.domain}:Platform=Win32:Bytes Received"
            category="THROUGHPUT"
            group="Throughput"
            collectionType="trendsup"
            units="B"/>

    <metric name="Bytes Sent"
            alias="BytesSent"
            template="${net.domain}:Platform=Win32:Bytes Sent"
            category="THROUGHPUT"
            group="Throughput"
            indicator="true"
            collectionType="trendsup"
            units="B"/>

    <metric name="Datagrams Received"
            alias="DatagramsReceived"
            template="${net.domain}:Platform=Win32:Datagrams Received"
            category="THROUGHPUT"
            group="Throughput"
            collectionType="trendsup"
            units="none"/>

    <metric name="Datagrams Sent"
            alias="DatagramsSent"
            template="${net.domain}:Platform=Win32:Datagrams Sent"
            category="THROUGHPUT"
            group="Throughput"
            collectionType="trendsup"
            units="none"/>

  </metrics>

  <!-- clr-data metrics are runtime only; no application metrics -->
  <metrics name="clr-data">
    <metric name="Current Connections"
            alias="CurrentConnections"
            template="${data.domain}:Platform=Win32:Current # pooled and nonpooled connections"
            category="UTILIZATION"
            group="Connection"
            collectionType="dynamic"
            units="none"/>

    <metric name="Current Pooled Connections"
            alias="CurrentPooledConnections"
            template="${data.domain}:Platform=Win32:Current # pooled connections"
            category="UTILIZATION"
            group="Connection"
            collectionType="dynamic"
            units="none"/>

    <metric name="Connection Pools"
            alias="ConnectionPools"
            template="${data.domain}:Platform=Win32:Current # connection pools"
            category="UTILIZATION"
            group="Connection"
            collectionType="dynamic"
            units="none"/>

    <metric name="Failed Connects"
            alias="FailedConnects"
            template="${data.domain}:Platform=Win32:Total # failed connects"
            category="UTILIZATION"
            group="Connection"
            collectionType="dynamic"
            units="none"/>

    <metric name="Failed Commands"
            alias="FailedCommands"
            template="${data.domain}:Platform=Win32:Total # failed commands"
            category="UTILIZATION"
            group="Common Language Runtime"
            collectionType="dynamic"
            units="none"/>
  </metrics>

  <metrics name="clr-security">
    <metric name="Runtime Checks"
            alias="RuntimeChecks"
            template="${security.domain}:Platform=Win32:Total Runtime Checks"
            category="UTILIZATION"
            group="Common Language Runtime"
            collectionType="trendsup"
            units="none"/>

    <metric name="Time Signature Authenticating"
            alias="TimeSigAuth"
            template="${security.domain}:Platform=Win32:__percent__ Time Sig. Authenticating"
            category="UTILIZATION"
            group="Common Language Runtime"
            collectionType="dynamic"
            units="none"/>

    <metric name="Link Time Checks"
            alias="LinkTimeChecks"
            template="${security.domain}:Platform=Win32:# Link Time Checks"
            category="UTILIZATION"
            group="Common Language Runtime"
            collectionType="trendsup"
            units="none"/>

    <metric name="Time in RT checks"
            alias="TimeRTchecks"
            template="${security.domain}:Platform=Win32:__percent__ Time in RT checks"
            category="UTILIZATION"
            group="Common Language Runtime"
            collectionType="dynamic"
            units="none"/>

    <metric name="Stack Walk Depth"
            alias="StackWalkDepth"
            template="${security.domain}:Platform=Win32:Stack Walk Depth"
            category="UTILIZATION"
            group="Common Language Runtime"
            collectionType="dynamic"
            units="none"/>
  </metrics>

  <metrics name="clr-remote">
    <metric name="Total Remote Calls"
            alias="TotalRemoteCalls"
            template="${remote.domain}:Platform=Win32:Total Remote Calls"
            category="UTILIZATION"
            group="Common Language Runtime"
            collectionType="trendsup"
            units="none"/>

    <metric name="Channels"
            alias="Channels"
            template="${remote.domain}:Platform=Win32:Channels"
            category="UTILIZATION"
            group="Common Language Runtime"
            collectionType="dynamic"
            units="none"/>

    <metric name="Context Proxies"
            alias="ContextProxies"
            template="${remote.domain}:Platform=Win32:Context Proxies"
            category="UTILIZATION"
            group="Context"
            collectionType="dynamic"
            units="none"/>

    <metric name="Context Bound Classes Loaded"
            alias="ContextBoundClassesLoaded"
            template="${remote.domain}:Platform=Win32:Context-Bound Classes Loaded"
            category="UTILIZATION"
            group="Context"
            collectionType="dynamic"
            units="none"/>

    <metric name="Contexts"
            alias="Contexts"
            template="${remote.domain}:Platform=Win32:Contexts"
            category="UTILIZATION"
            group="Context"
            collectionType="dynamic"
            units="none"/>
  </metrics>

  <server name=".NET"
          version="1.1"
          platforms="Win32">

    <plugin type="measurement"
            class="DotNetMeasurementPlugin"/>

    <plugin type="autoinventory"
            class="DotNetDetector"/>

    <scan registry="SOFTWARE\Microsoft\.NETFramework">
      <include name="InstallRoot"/>
    </scan>

    <metrics>
      <include name="dotnet-avail"/>
      <include name="clr-memory"/>
      <include name="clr-loading"/>
      <include name="clr-ex"/>
      <include name="clr-jit"/>
      <include name="clr-threads"/>
      <include name="clr-security"/>
      <include name="clr-remote"/>
      <!-- server only -->
      <include name="clr-net"/>
      <include name="clr-data"/>
    </metrics>

    <service name="Application">
      <metrics>
        <include name="dotnet-avail"/>
        <include name="clr-memory"/>
        <include name="clr-loading"/>
        <include name="clr-ex"/>
        <include name="clr-jit"/>
        <include name="clr-threads"/>
        <include name="clr-security"/>
        <include name="clr-remote"/>
      </metrics>

      <config>
        <option name="app.name"
                description="Application name"
                default="PerfBrowser"/>
      </config>
    </service>
  </server>
</plugin>
