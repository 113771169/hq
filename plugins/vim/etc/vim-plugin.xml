<plugin>

  <config name="vi">
    <option name="url"
            description="VI sdk url"
            default="https://esx/sdk"/>

    <option name="user"
            description="Username"/>

    <option name="pass"
            type="secret"
            description="Password"/>

    <option name="hostname"
            description="ESX host name"/>
  </config>

  <config name="vm">
    <option name="vm"
            description="Virtual Machine name"/>
  </config>

  <config name="pool">
    <option name="pool"
            description="Resource Pool name"/>
  </config>

  <platform name="VMware VI3 Host">

    <plugin type="autoinventory" class="org.hyperic.hq.plugin.vim.VimHostDetector"/>
    <plugin type="measurement" class="org.hyperic.hq.product.MeasurementPlugin"/>
    <plugin type="collector" class="org.hyperic.hq.plugin.vim.VimHostCollector"/>

    <config include="vi"/>
    <properties>
      <property name="version"
                description="VMware Version"/>

      <property name="build"
                description="Build"/>
    </properties>

    <property name="template" value="${vi.template}:${alias}"/>

    <metric name="Availability" indicator="true"/>

    <metric name="Uptime"
            alias="sys.uptime.latest"
            units="sec"
            category="AVAILABILITY"/>

    <!-- units=MHz -->
    <metric name="CPU Reserved Capacity"
            alias="cpu.reservedCapacity.average"/>

    <metric name="CPU Throttled (1 min. Average)"
            alias="rescpu.maxLimited1.latest"
            units="percent"/>

    <metric name="CPU Throttled (5 min. Average)"
            alias="rescpu.maxLimited5.latest"
            units="percent"/>

    <metric name="CPU Throttled (15 min. Average)"
            alias="rescpu.maxLimited15.latest"
            units="percent"/>

    <metric name="CPU Running (1 min. Average)"
            alias="rescpu.runav1.latest"
            units="percent"/>

    <metric name="CPU Running (5 min. Average)"
            alias="rescpu.runav5.latest"
            units="percent"/>

    <metric name="CPU Running (15 min. Average)"
            alias="rescpu.runav15.latest"
            units="percent"/>

    <metric name="CPU Active (1 min. Average)"
            alias="rescpu.actav1.latest"
            units="percent"/>

    <metric name="CPU Active (5 min. Average)"
            indicator="true"
            alias="rescpu.actav5.latest"
            units="percent"/>

    <metric name="CPU Active (15 min. Average)"
            alias="rescpu.actav15.latest"
            units="percent"/>

    <metric name="Memory Swap In"
            alias="mem.swapin.average"
            units="KB"/>

    <metric name="Memory Swap Out"
            alias="mem.swapout.average"
            units="KB"/>

    <metric name="Memory Swap Used"
            alias="mem.swapused.average"
            units="KB"/>

    <metric name="Memory Balloon"
            indicator="true"
            alias="mem.vmmemctl.average"
            units="KB"/>

    <metric name="Memory Unreserved"
            alias="mem.unreserved.average"
            units="KB"/>

    <metric name="Memory Usage"
            alias="mem.usage.average"
            units="percent"/>

    <metric name="Memory Heap"
            alias="mem.heap.average"
            units="KB"/>

    <metric name="Memory Heap Free"
            alias="mem.heapfree.average"
            units="KB"/>

    <metric name="Memory Overhead"
            alias="mem.overhead.average"
            units="KB"/>

    <metric name="Memory Zero"
            alias="mem.zero.average"
            units="KB"/>

    <metric name="Memory Reserved Capacity"
            alias="mem.reservedCapacity.average"
            units="MB"/>

    <metric name="Memory Active"
            indicator="true"
            alias="mem.active.average"
            units="KB"/>

    <metric name="Memory Shared"
            indicator="true"
            alias="mem.shared.average"
            units="KB"/>

    <metric name="Memory Granted"
            alias="mem.granted.average"
            units="KB"/>

    <metric name="Memory Consumed"
            alias="mem.consumed.average"
            units="KB"/>

    <metric name="Memory State"
            alias="mem.state.latest"/>

    <metric name="Memory Shared Common"
            alias="mem.sharedcommon.average"
            units="KB"/>

    <metric name="Memory Used by vmkernel"
            alias="mem.sysUsage.average"
            units="KB"/>

    <server name="VMware VI3 Resource Pool">
      <plugin type="measurement" class="org.hyperic.hq.product.MeasurementPlugin"/>
      <plugin type="collector" class="org.hyperic.hq.plugin.vim.VimPoolCollector"/>

      <property name="template" value="${vi.template},${pool.config}:${alias}"/>

      <metric name="Availability" indicator="true"/>

      <!-- units=MHz -->
      <metric name="CPU Usage"
              indicator="true"
              alias="cpu.usagemhz.average"
              units="none"/>
  
      <metric name="Memory Balloon"
              indicator="true"
              alias="mem.vmmemctl.average"
              units="KB"/>
  
      <metric name="Memory Overhead"
              alias="mem.overhead.average"
              units="KB"/>
  
      <metric name="Memory Zero"
              alias="mem.zero.average"
              units="KB"/>
  
      <metric name="Memory Active"
              indicator="true"
              alias="mem.active.average"
              units="KB"/>
  
      <metric name="Memory Shared"
              indicator="true"
              alias="mem.shared.average"
              units="KB"/>
  
      <metric name="Memory Granted"
              alias="mem.granted.average"
              units="KB"/>
  
      <metric name="Memory Swapped"
              alias="mem.swapped.average"
              units="KB"/>
    </server>

    <server name="VMware VI3 VM">
      <plugin type="autoinventory" class="org.hyperic.hq.plugin.vim.VimVmDetector"/>
      <plugin type="measurement" class="org.hyperic.hq.product.MeasurementPlugin"/>
      <plugin type="collector" class="org.hyperic.hq.plugin.vim.VimVmCollector"/>
      <plugin type="control" class="org.hyperic.hq.plugin.vim.VimVmControlPlugin"/>

      <actions>
        <include name="createSnapshot"/>
        <include name="removeAllSnapshots"/>
        <include name="revertToSnapshot"/>
        <include name="stop"/>
        <include name="start"/>
        <include name="reset"/>
        <include name="suspend"/>
        <include name="rebootGuest"/>
        <include name="standbyGuest"/>
        <include name="guestHeartbeatStatus"/>
      </actions>

      <config include="vm"/>

      <properties>
         <property name="guestOS"
                   description="Guest OS"/>

         <property name="ip"
                   description="IP Address"/>

         <property name="macAddress"
                   description="MAC Address"/>

         <property name="hostName"
                   description="Hostname"/>

         <property name="pool"
                   description="Resource Pool"/>

         <property name="memsize"
                   description="Memory Size"/>

         <property name="numvcpus"
                   description="Virtual CPUs"/>

         <property name="toolsVersion"
                   description="Tools Version"/>
      </properties>

      <property name="template" value="${vi.template},${vm.config}:${alias}"/>

      <metric name="Availability" indicator="true"/>
  
      <metric name="Uptime"
              alias="sys.uptime.latest"
              units="sec"
              category="AVAILABILITY"/>

      <metric name="CPU Throttled (1 min. Average)"
              alias="rescpu.maxLimited1.latest"
              units="percent"/>
  
      <metric name="CPU Throttled (15 min. Average)"
              alias="rescpu.maxLimited15.latest"
              units="percent"/>
  
      <metric name="CPU Throttled (5 min. Average)"
              alias="rescpu.maxLimited5.latest"
              units="percent"/>
  
      <metric name="CPU Running (1 min. Average)"
              alias="rescpu.runav1.latest"
              units="percent"/>
  
      <metric name="CPU Running (5 min. Average)"
              alias="rescpu.runav5.latest"
              units="percent"/>
  
      <metric name="CPU Running (15 min. Average)"
              alias="rescpu.runav15.latest"
              units="percent"/>

      <metric name="CPU Active (1 min. Average)"
              alias="rescpu.actav1.latest"
              units="percent"/>
  
      <metric name="CPU Active (5 min. Average)"
              indicator="true"
              alias="rescpu.actav5.latest"
              units="percent"/>
  
      <metric name="CPU Active (15 min. Average)"
              alias="rescpu.actav15.latest"
              units="percent"/>
  
      <metric name="Memory Swap Out"
              alias="mem.swapout.average"
              units="KB"/>
  
      <metric name="Memory Swap In"
              alias="mem.swapin.average"
              units="KB"/>
  
      <metric name="Memory Swap Target"
              alias="mem.swaptarget.average"
              units="KB"/>
  
      <metric name="Memory Swapped"
              alias="mem.swapped.average"
              units="KB"/>

      <metric name="Memory Usage"
              alias="mem.usage.average"
              units="percent"/>
  
      <metric name="Memory Overhead"
              alias="mem.overhead.average"
              units="KB"/>
  
      <metric name="Memory Balloon"
              indicator="true"
              alias="mem.vmmemctl.average"
              units="KB"/>
  
      <metric name="Memory Balloon Target"
              alias="mem.vmmemctltarget.average"
              units="KB"/>
  
      <metric name="Memory Zero"
              alias="mem.zero.average"
              units="KB"/>
  
      <metric name="Memory Active"
              alias="mem.active.average"
              units="KB"/>
  
      <metric name="Memory Shared"
              alias="mem.shared.average"
              units="KB"/>
  
      <metric name="Memory Granted"
              alias="mem.granted.average"
              units="KB"/>
  
      <metric name="Memory Consumed"
              indicator="true"
              alias="mem.consumed.average"
              units="KB"/>
    </server>
  </platform>
</plugin>
