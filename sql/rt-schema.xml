<?xml version="1.0" encoding="UTF-8"?>
<Covalent.DBSetup name="rt-schema.xml" notice="DBSetup, Copyright (C) 2002, Covalent Technologies, Inc., All Rights Reserved.">

    <table name="EAM_SERVICE_REQUEST">
        <column name="ID" default="sequence-only" initial="10001"
                primarykey="true" required="true" type="INTEGER"/>
        <column name="SERVICEID" required="true" type="INTEGER"/>
        <column name="URL" required="true" type="VARCHAR2" size="3072"/>

        <index name="SERVICE_REQUEST_SVCID" unique="false">
            <field ref="SERVICEID"/>
        </index>

        <index name="SERVICE_REQUEST_URL" unique="false">
            <field ref="URL"/>
        </index>

        <index name="SERVICE_REQUEST_SVCID_URL" unique="true">
            <field ref="SERVICEID"/>
            <field ref="URL"/>
        </index>
    
    </table>

    <table name="EAM_REQUEST_STAT" tablespace="@@@LG_DATA@@@"
        storage-options="freelists 5" cache="true" logging="false">
        <column name="ID" default="sequence-only" initial="10001"
                primarykey="true" required="true" type="INTEGER"/>
        <column name="SVCREQ_ID" required="false" type="INTEGER"
                references="EAM_SERVICE_REQUEST(ID)"/>

        <!-- EVIDENT. -->
        <column name="IPADDR" required="true" type="VARCHAR2" SIZE="20"/>

        <column name="MIN" required="true" type="DOUBLE"/>
        <column name="MAX" required="true" type="DOUBLE"/>
        <column name="TOTAL" required="true" type="DOUBLE"/>
        <column name="COUNT" required="true" type="INTEGER"/>
        <column name="BEGINTIME" required="true" type="LONG"/>
        <column name="ENDTIME" required="true" type="LONG"/>
        <column name="SVCTYPE" required="true" type="INTEGER"/>

        <!-- EVIDENT.  We'll need this index for queries -->
        <index name="REQSTAT_IDX_CLIENTIP" unique="false" tablespace="@@@LG_IDX@@@">
            <field ref="IPADDR"/>
        </index>

        <index name="SERVICE_ID" unique="false" tablespace="@@@LG_IDX@@@">
            <field ref="SVCREQ_ID"/>
        </index>
        <index name="REQSTAT_IDX_BEGINTIME" unique="false" 
            tablespace="@@@LG_IDX@@@">
            <field ref="BEGINTIME"/>
        </index>
        <index name="REQSTAT_IDX_ENDTIME" unique="false" 
            tablespace="@@@LG_IDX@@@">
            <field ref="ENDTIME"/>
        </index>
        <index name="REQSTAT_IDX_SVCTYPE" unique="false" 
            tablespace="@@@LG_IDX@@@">
            <field ref="SVCTYPE"/>
        </index>
    </table>
    
    <table name="EAM_ERROR_CODE">
        <column name="ID" default="sequence-only" initial="10001"
                primarykey="true" required="true" type="INTEGER"/>
        <column name="CODE" required="true" type="INTEGER"/>
        <column name="DESCRIPTION" required="true" type="VARCHAR2" size="64"/> 

        <index name="ERROR_CODE" unique="true">
            <field ref="CODE"/>
        </index>
    </table>

    <table name="EAM_STAT_ERRORS" tablespace="@@@LG_DATA@@@"
        storage-options="freelists 5" cache="true" logging="false">
        <column name="ID" default="sequence-only" initial="10001"
                primarykey="true" required="true" type="INTEGER"/>
        <column name="ERROR_ID" required="false" type="INTEGER"
                references="EAM_ERROR_CODE(ID)"/>
        <column name="COUNT" required="true" type="INTEGER"/>
        <column name="REQSTAT_ID" required="false" type="INTEGER"
                references="EAM_REQUEST_STAT(ID)"/>

        <constraint name="RT_ERRS_FK_RSTAT">
          <foreignKey local="REQSTAT_ID"
                      references="EAM_REQUEST_STAT(ID)"
                      ondelete="cascade"/>
        </constraint>

        <index name="STAT_ERRORS_REQSTAT" 
            tablespace="@@@LG_IDX@@@">
            <field ref="REQSTAT_ID"/>
        </index>
    </table>

</Covalent.DBSetup>
