<?xml version="1.0" encoding="UTF-8"?>

<Covalent.DBSetup name="authz-schema.xml" notice="DBSetup, Copyright (C) 2002, Covalent Technologies, Inc., All Rights Reserved.">

    <table name="EAM_RESOURCE_TYPE">
        <column name="ID" default="sequence-only" initial="10001" 
                primarykey="true" required="true" type="INTEGER"/>
        <column name="CID" type="INTEGER"/>
        <column name="NAME" required="true" size="100" type="VARCHAR2"/>
        <column name="RESOURCE_ID" type="INTEGER"/>
        <column name="FSYSTEM" type="BOOLEAN" default="FALSE"/>

        <index name="EAM_RESOURCE_TYPE_RESOURCE_KEY" unique="true">
            <field ref="RESOURCE_ID" />
        </index>
        <index name="EAM_RES_TYPE_NAME_KEY" unique="true">
            <field ref="NAME" />
        </index>
        <index name="EAM_RESOURCE_TYPE_CID_IDX">
            <field ref="CID"/>
        </index>
    </table>
    
    <table name="EAM_OPERATION">
        <column name="ID" default="sequence-only" initial="10001" 
                primarykey="true" required="true" type="INTEGER"/>
        <column name="CID" type="INTEGER"/>
        <column name="NAME" required="true" size="100" type="VARCHAR2"/>
        <column name="RESOURCE_TYPE_ID" type="INTEGER"
                references="EAM_RESOURCE_TYPE" />

        <index name="EAM_OPERATION_CID_IDX">
            <field ref="CID"/>
        </index>
        <index name="EAM_OPNAME_RES_TYPE_IDX" unique="true">
            <field ref="NAME"/>
            <field ref="RESOURCE_TYPE_ID"/>
        </index>
        <index name="EAM_OPNAME_IDX">
            <field ref="NAME"/>
        </index>
    </table>

    <table name="EAM_RESOURCE" tablespace="@@@LG_DATA@@@" cache="true"
        storage-options="freelists 5">
        <column name="ID" default="sequence-only" initial="10001" 
                primarykey="true" required="true" type="INTEGER"/>
        <column name="CID" type="INTEGER"/>
        <column name="INSTANCE_ID" type="INTEGER"/>
        <column name="RESOURCE_TYPE_ID" type="INTEGER"
                references="EAM_RESOURCE_TYPE" />
        <column name="SUBJECT_ID" type="INTEGER"/>
        <column name="NAME" type="VARCHAR2" size="200"/>
        <column name="SORT_NAME" type="VARCHAR2" size="200"/>
        <column name="FSYSTEM" type="BOOLEAN" default="FALSE"/>
        <index name="EAM_RESOURCE_INSTANCE_KEY" unique="true"
            tablespace="@@@LG_IDX@@@">
            <field ref="RESOURCE_TYPE_ID"/>
            <field ref="INSTANCE_ID"/>
        </index>
        <index name="EAM_RESOURCE_IDX_TYPE" unique="false" tablespace="@@@LG_IDX@@@">
            <field ref="RESOURCE_TYPE_ID"/>
        </index>
        <index name="EAM_RESOURCE_INSTANCE_ID" 
            tablespace="@@@LG_IDX@@@">
            <field ref="INSTANCE_ID"/>
        </index>
        <index name="EAM_RESOURCE_OWNER_ID"
            tablespace="@@@LG_IDX@@@">
            <field ref="SUBJECT_ID"/>
        </index>
    </table>

    <table name="EAM_RESOURCE_GROUP">
        <column name="ID" default="sequence-only" initial="10001" 
                primarykey="true" required="true" type="INTEGER"/>
        <column name="CID" type="INTEGER"/>
        <column name="NAME" required="true" size="100" type="VARCHAR2"/>
        <column name="SORT_NAME" size="100" type="VARCHAR2"/>
        <column name="DESCRIPTION" size="100" type="VARCHAR2"/>
        <column name="LOCATION" required="false" size="100" type="VARCHAR2"/>
        <column name="RESOURCE_ID" type="INTEGER" references="EAM_RESOURCE"/>
        <column name="FSYSTEM" type="BOOLEAN" default="FALSE"/>
        <column name="GROUPTYPE" type="INTEGER" default="11"/>
        <column name="GROUP_ENT_TYPE" type="INTEGER" default="-1"/>
        <column name="GROUP_ENT_RES_TYPE" type="INTEGER" default="-1"/>
        <column name="CLUSTER_ID" type="INTEGER" default="-1"/>
        <column name="CTIME" type="LONG"/>
        <column name="MTIME" type="LONG"/>
        <column name="MODIFIED_BY" required="false" size="100" type="VARCHAR2"/>
        <index name="EAM_RES_GROUP_RES_KEY">
            <field ref="RESOURCE_ID"/>
        </index>
        <index name="EAM_RES_GROUP_CID_IDX">
            <field ref="CID"/>
        </index>
        <index name="EAM_RES_GROUP_NAME" unique="true">
            <field ref="NAME"/>
        </index> 
    </table>

    <table name="EAM_RES_GRP_RES_MAP">
        <column name="RESOURCE_ID" required="true" type="INTEGER"
                references="EAM_RESOURCE"/>
        <column name="RESOURCE_GROUP_ID" required="true" type="INTEGER"
                references="EAM_RESOURCE_GROUP"/>
        <column name="CID" type="INTEGER"/>

        <!-- not using full words to fit index name length -->
        <constraint name="EAM_RES_GROUP_RES_MAPPING_KEY">
          <primaryKey>
            <field ref="RESOURCE_ID"/>
            <field ref="RESOURCE_GROUP_ID"/>
          </primaryKey>
        </constraint>

        <!-- not using full words to fit index name length -->
        <index name="EAM_RESGRP_RESMAP_CID_IDX">
            <field ref="CID"/>
        </index>
    </table>

    <table name="EAM_ROLE">
        <column name="ID" default="sequence-only" initial="10001" 
                primarykey="true" required="true" type="INTEGER"/>
        <column name="CID" type="INTEGER"/>
        <column name="NAME" required="true" size="100" type="VARCHAR2"/>
        <column name="SORT_NAME" size="100" type="VARCHAR2"/>
        <column name="DESCRIPTION" size="100" type="VARCHAR2"/>
        <column name="RESOURCE_ID" type="INTEGER" references="EAM_RESOURCE"/>
        <column name="FSYSTEM" type="BOOLEAN" default="FALSE"/>

        <index name="EAM_ROLE_NAME_KEY" unique="true">
            <field ref="NAME" />
        </index>
        <index name="EAM_ROLE_CID_IDX">
            <field ref="CID"/>
        </index>
    </table>

    <table name="EAM_ROLE_RESOURCE_GROUP_MAP">
        <column name="ROLE_ID" required="true" type="INTEGER"
                references="EAM_ROLE"/>
        <column name="RESOURCE_GROUP_ID" required="true" type="INTEGER"
                references="EAM_RESOURCE_GROUP"/>
        <column name="CID" type="INTEGER"/>

        <constraint name="EAM_ROLE_RES_GROUP_MAP_KEY">
          <primaryKey>
            <field ref="ROLE_ID"/>
            <field ref="RESOURCE_GROUP_ID"/>
          </primaryKey>
        </constraint>

        <index name="EAM_ROLE_RES_GRP_MAP_CID_IDX">
            <field ref="CID"/>
        </index>
    </table>

    <table name="EAM_ROLE_OPERATION_MAP">
        <column name="ROLE_ID" required="true" type="INTEGER"
                references="EAM_ROLE"/>
        <column name="OPERATION_ID" required="true" type="INTEGER"
                references="EAM_OPERATION"/>
        <column name="CID" type="INTEGER"/>

        <constraint name="EAM_ROLE_OPERATION_MAP_KEY">
          <primaryKey>
            <field ref="ROLE_ID"/>
            <field ref="OPERATION_ID"/>
          </primaryKey>
        </constraint>

        <index name="EAM_ROLE_OPER_MAP_CID_IDX">
            <field ref="CID"/>
        </index>
    </table>

    <table name="EAM_SUBJECT">
        <column name="ID" default="sequence-only" initial="10001" 
                primarykey="true" required="true" type="INTEGER"/>
        <column name="CID" type="INTEGER"/>
        <column name="NAME" required="true" size="100" type="VARCHAR2"/>
        <column name="SORT_NAME" size="100" type="VARCHAR2"/>
        <column name="DSN" required="true" size="100" type="VARCHAR2"/>
        <column name="RESOURCE_ID" type="INTEGER" references="EAM_RESOURCE"/>
        <column name="FIRST_NAME" required="false" size="100" type="VARCHAR2"/>
        <column name="LAST_NAME" required="false" size="100" type="VARCHAR2"/>
        <column name="EMAIL_ADDRESS" size="100" type="VARCHAR2"/>
        <column name="SMS_ADDRESS" size="100" type="VARCHAR2"/>
        <column name="PHONE_NUMBER" size="100" type="VARCHAR2"/>
        <column name="DEPARTMENT" size="100" type="VARCHAR2"/>
        <column name="FACTIVE" required="true" type="BOOLEAN" default="TRUE" />
        <column name="FSYSTEM" required="true" type="BOOLEAN" default="FALSE" />

        <index name="EAM_SUBJECT_RESOURCE_KEY">
            <field ref="RESOURCE_ID"/>
        </index>

        <index name="EAM_SUBJECT_AUTH_KEY" unique="true">
            <field ref="NAME"/>
            <field ref="DSN"/>
        </index>
        <index name="EAM_SUBJECT_CID_IDX">
            <field ref="CID"/>
        </index>
    </table>

    <table name="EAM_SUBJECT_ROLE_MAP">
        <column name="SUBJECT_ID" required="true" type="INTEGER"
                references="EAM_SUBJECT"/>
        <column name="ROLE_ID" required="true" type="INTEGER"
                references="EAM_ROLE"/>
        <column name="CID" type="INTEGER"/>

        <constraint name="EAM_SUBJECT_ROLE_MAPPING_KEY">
          <primaryKey>
            <field ref="SUBJECT_ID"/>
            <field ref="ROLE_ID"/>
          </primaryKey>
        </constraint>

        <index name="EAM_SUBJ_ROLE_MAP_CID_IDX">
            <field ref="CID"/>
        </index>
    </table>

    <table name="EAM_USER_CONFIG_RESP">
        <column name="ID" default="sequence-only" initial="10001"
            primarykey="true" required="true" type="INTEGER"/>
        <column name="SUBJECT_ID" type="INTEGER" references="EAM_SUBJECT"/>
        <column name="PREF_RESPONSE" type="BYTES"/>
        <index name="EAM_USER_CONFIG_RESP_USER_IDX">
            <field ref="SUBJECT_ID"/>
        </index>
    </table>

</Covalent.DBSetup>
